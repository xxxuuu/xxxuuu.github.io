<!DOCTYPE html><html data-astro-cid-pjvcz6dw lang=zh-CN><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><link href="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F49b4570c-b2f0-457b-81b7-b68e2693a471%2Favatar.png?table=collection&id=0bb2e606-8d0c-4f7c-aca9-70986e90c055" rel=icon><link href=https://xxxuuu.me/post/coroutine/ rel=canonical><link href=/rss/feed.xml rel=alternate title=x³u³ type=application/rss+xml><link href=/sitemap-index.xml rel=sitemap><title>浅谈协程 | x³u³</title><meta content="最近经常被各种人问到一些关于协程的事情，例如 xx 语言的 xx 是不是协程，xx 语言和 xx 语言的协程有什么区别，我不得不一次次 share 出我的文章，索性直接发到 blog 上吧" name=description><meta content=website property=og:type><meta content=https://xxxuuu.me/post/coroutine/ property=og:url><meta content="浅谈协程 | x³u³" property=og:title><meta content="最近经常被各种人问到一些关于协程的事情，例如 xx 语言的 xx 是不是协程，xx 语言和 xx 语言的协程有什么区别，我不得不一次次 share 出我的文章，索性直接发到 blog 上吧" property=og:description><meta content="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Fa9af1d6b-f284-4734-ba06-990353cf3f84%2FElaina.jpg?table=collection&id=0bb2e606-8d0c-4f7c-aca9-70986e90c055" property=og:image><meta content=summary_large_image name=twitter:card><meta content=@xxuuu0 name=twitter:site><meta content="浅谈协程 | x³u³" name=twitter:title><meta content="最近经常被各种人问到一些关于协程的事情，例如 xx 语言的 xx 是不是协程，xx 语言和 xx 语言的协程有什么区别，我不得不一次次 share 出我的文章，索性直接发到 blog 上吧" name=twitter:description><meta content="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Fa9af1d6b-f284-4734-ba06-990353cf3f84%2FElaina.jpg?table=collection&id=0bb2e606-8d0c-4f7c-aca9-70986e90c055" name=twitter:image><link href=https://cdn.jsdelivr.net/npm/photoswipe@5.4.3/dist/photoswipe.css rel=preload as=style onload="this.onload=null,this.rel=&#34;stylesheet&#34;"><noscript><link href=https://cdn.jsdelivr.net/npm/photoswipe@5.4.3/dist/photoswipe.css rel=stylesheet></noscript><script>!function(){const e=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");document.documentElement.classList.add(e)}()</script><link href=/_astro/katex.CVb4srxQ.css rel=stylesheet><link href=/_astro/_slug_.DXL8v6Xi.css rel=stylesheet><link href=/_astro/_slug_.BzJEnS8p.css rel=stylesheet><link href=/_astro/_slug_.DOIB7y8p.css rel=stylesheet><script src=/_astro/hoisted.B871fABB.js type=module></script></head><body data-astro-cid-pjvcz6dw><header class=notion-header data-astro-cid-4f4rmh32><div class=header-container data-astro-cid-4f4rmh32><div class=header-content data-astro-cid-4f4rmh32><div class=logo data-astro-cid-4f4rmh32><a href=/ class=logo-link data-astro-cid-4f4rmh32>x³u³</a></div><div class=header-actions data-astro-cid-4f4rmh32><nav class=nav data-astro-cid-4f4rmh32><a href=/ class=nav-link data-astro-cid-4f4rmh32>🏠 首页 </a><a href=/archive class=nav-link data-astro-cid-4f4rmh32>📃 归档 </a><a href=/links class=nav-link data-astro-cid-4f4rmh32>👬 友链 </a><a href=https://p.xxxuuu.me class=nav-link data-astro-cid-4f4rmh32 rel="noopener noreferrer" target=_blank>📷 摄影 <span class=external-icon data-astro-cid-4f4rmh32>↗</span> </a><a href=/about class=nav-link data-astro-cid-4f4rmh32>👤 关于</a></nav><button aria-label="Toggle theme" title=切换主题 data-astro-cid-44mn2ykx id=theme-toggle><svg fill=none viewBox="0 0 24 24" height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 class=sun-icon data-astro-cid-44mn2ykx xmlns=http://www.w3.org/2000/svg><circle cx=12 cy=12 data-astro-cid-44mn2ykx r=5></circle><line data-astro-cid-44mn2ykx x1=12 x2=12 y1=1 y2=3></line><line data-astro-cid-44mn2ykx x1=12 x2=12 y1=21 y2=23></line><line data-astro-cid-44mn2ykx x1=4.22 x2=5.64 y1=4.22 y2=5.64></line><line data-astro-cid-44mn2ykx x1=18.36 x2=19.78 y1=18.36 y2=19.78></line><line data-astro-cid-44mn2ykx x1=1 x2=3 y1=12 y2=12></line><line data-astro-cid-44mn2ykx x1=21 x2=23 y1=12 y2=12></line><line data-astro-cid-44mn2ykx x1=4.22 x2=5.64 y1=19.78 y2=18.36></line><line data-astro-cid-44mn2ykx x1=18.36 x2=19.78 y1=5.64 y2=4.22></line></svg> <svg fill=none viewBox="0 0 24 24" height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 class=moon-icon data-astro-cid-44mn2ykx xmlns=http://www.w3.org/2000/svg><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" data-astro-cid-44mn2ykx></path></svg></button></div></div></div></header><main class=notion-main data-astro-cid-pjvcz6dw><article class=content data-astro-cid-gbhzkc2y><div class=notion-page data-astro-cid-gbhzkc2y><div class=page-container data-astro-cid-gbhzkc2y><div class=page-main data-astro-cid-gbhzkc2y><header class=page-header data-astro-cid-gbhzkc2y><h1 class=page-title data-astro-cid-gbhzkc2y>浅谈协程</h1></header><div class=page-meta data-astro-cid-gbhzkc2y><div class=meta-info data-astro-cid-gbhzkc2y><span class=meta-item data-astro-cid-gbhzkc2y><span class=meta-icon data-astro-cid-gbhzkc2y>📅</span> <time data-astro-cid-gbhzkc2y datetime=2024-11-22>2024年11月22日</time> </span><span class=meta-item data-astro-cid-gbhzkc2y><span class=meta-icon data-astro-cid-gbhzkc2y>⏱️</span> <span data-astro-cid-gbhzkc2y>6 分钟阅读</span></span></div><div class=meta-tags data-astro-cid-gbhzkc2y><span class=tags-icon data-astro-cid-gbhzkc2y>🏷️</span> <a href=/tag/操作系统 class=tag-pill data-astro-cid-gbhzkc2y>操作系统</a></div><div class=meta-description data-astro-cid-gbhzkc2y>最近经常被各种人问到一些关于协程的事情，例如 xx 语言的 xx 是不是协程，xx 语言和 xx 语言的协程有什么区别，我不得不一次次 share 出我的文章，索性直接发到 blog 上吧</div></div><hr class=page-divider data-astro-cid-gbhzkc2y><div class=notion-content data-astro-cid-gbhzkc2y><p>最近经常被各种人问到一些关于协程的事情，例如 xx 语言的 xx 是不是协程，xx 语言和 xx 语言的协程有什么区别，我不得不一次次 share 出我的文章，索性直接发到 blog 上吧</p><p><br></p><p>首先，协程是什么？一开始应该抛开一切具体语言的实现去理解协程，给出一个明确定义，但协程的定义实在太多，并且扩展出了各种不同形态，这里我们简单定义<strong>协程就是一个「可以暂停和恢复的函数」</strong></p><p><br></p><h2 id="">达夫设备</h2><p>了解了协程的定义，就是实现问题了</p><p>来看一个 fib 协程</p><div class=notion-code-block><div class=notion-code-header><span class=notion-code-language>C++</span> <button aria-label=复制代码 title=复制代码 class=notion-code-copy><svg fill=none viewBox="0 0 24 24" height=16 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=16><rect height=13 rx=2 ry=2 width=13 x=9 y=9></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg> <span class=copy-text>COPY</span></button></div><pre class=notion-code><code class=language-c++>generator&lt;int&gt; fib() {
    int a = 1, b = 1;
    yield a;
    yield b;
    while(true) {
        int c = a + b;
        yield c;
        a = b;
        b = c;
    }
}</code></pre></div><p>对 fib 进行调用，会返回斐波那契数列 1，1，2，3，5，8…</p><p>在 <code>yield</code> 时，协程被暂停，再次调用，协程被恢复</p><p><br></p><p>现在我们要实现类似的效果，核心无非两点，如何暂停和如何恢复</p><p>一种简单的协程实现是达夫设备，它是一个状态机，状态机上的状态对应每个 yield 的位置</p><p>首先通过 static 变量存储状态（也可以通过一个外部的协程结构体来在任意地方存储），接着，yield 时直接 return 返回控制权，调用时通过 switch + goto 跳转回之前的位置，也就是上次 yield 后的位置，这就恢复了状态：</p><div class=notion-code-block><div class=notion-code-header><span class=notion-code-language>C++</span> <button aria-label=复制代码 title=复制代码 class=notion-code-copy><svg fill=none viewBox="0 0 24 24" height=16 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=16><rect height=13 rx=2 ry=2 width=13 x=9 y=9></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg> <span class=copy-text>COPY</span></button></div><pre class=notion-code><code class=language-c++>int fib() {
    static int state = 0;
    static int a = 1;
    static int b = 1;
    static int c = 0;

    switch (state) {
        case 0:
            state = 1;
            goto s0;
        case 1:
            state = 2;
            goto s1;
        case 2:
            state = 3;
            goto s2;
        case 3:
            goto s3;
    }

s0:
    return a;
s1:
    return b;
s2:
    while(true) {
        c = a + b;
        return c;
        s3:
        a = b;
        b = c;
    }
}</code></pre></div><p><br></p><h2 id="">扩展</h2><p>有了基本的协程后，就可以谈谈其它语言中的 generator、async / await、goroutine / virtual thread 等实现了</p><p><br></p><p>对于 generator 和 async / await 模式，实际上和我们上面的实现是类似的，都是一个状态机。但它们通过编译器来生成了这堆繁琐的部分，作为语言的一个语法来提供，可以说是真正能用的协程。例如这样一段 Rust 的 generator 代码</p><div class=notion-code-block><div class=notion-code-header><span class=notion-code-language>Rust</span> <button aria-label=复制代码 title=复制代码 class=notion-code-copy><svg fill=none viewBox="0 0 24 24" height=16 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=16><rect height=13 rx=2 ry=2 width=13 x=9 y=9></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg> <span class=copy-text>COPY</span></button></div><pre class=notion-code><code class=language-rust>#![feature(generators, generator_trait)]
use std::ops::Generator;

use std::pin::Pin;

fn main() {
    let mut gen = ||{
        yield 1;
        yield 2;
        yield 3;
        return 4;
    };

    let mut pin = Pin::new(&amp;mut gen);
    for _ in 0..4 {
        println!(&quot;{:?}&quot;, pin.as_mut().resume(()));
        // Yielded(1)
        // Yielded(2)
        // Yielded(3)
        // Complete(4)
    }
}</code></pre></div><p>编译器会生成类似这样的实现，和我们前面的达夫设备基本基本没区别：</p><figure class="notion-image notion-image-center" style=max-width:528px><a href="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F3a9e11cf-1dd2-4987-b330-8e9d67ea3555%2FUntitled.png%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Content-Sha256%3DUNSIGNED-PAYLOAD%26X-Amz-Credential%3DASIAZI2LB4665RQPAUBN%252F20260127%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20260127T045736Z%26X-Amz-Expires%3D3600%26X-Amz-Security-Token%3DIQoJb3JpZ2luX2VjEIX%252F%252F%252F%252F%252F%252F%252F%252F%252F%252FwEaCXVzLXdlc3QtMiJHMEUCIQCB7DmaM866b1JY8DWstFOSSHCYTAp8bz5gGdt0%252Fv6AowIgEQGFxtwBKc4GAn0EtdkWqxuzvzE%252Blb8AHAYmLWKATTgq%252FwMIThAAGgw2Mzc0MjMxODM4MDUiDD39mIIid1mAFM4aSSrcA1hi6b1zZQL8SpGkNOaiYijkHGwXVFa65MXERmHIysqFmvYFdtGWRjb1QVf6Vzhg2MvKowBuEpMzuJsb1xv1lz3%252BZXW4KQWlpyltSMgO0y1g3wzreiXKfgVWUq4W1xrQNkkxomiS0GU0oIDqXYw%252BH2KB1B51LUZyhtplfoonNZnsTPoTv32OM9bC9UhHdFdfg2f79chobPO83qnjOa5WZOMQLySozI0zF7OCPu%252FnDRAdiOwFoG4JHEiuj2MFZDQSxYuZMLgHhaBmJs18l51dbuYrq5g8SsNOXK331VsR6CfxsFysHTWJBr8LlHyiy8fyAPrvr7ioTVw5fhJVZfsgT9NqQxOwNIjLmtX7gxsozMOx6R0M3k6RsdZQiqGp65nNJgQMXn%252B0VFOvLWga%252FUq8KCCZgpK1566HyWfcdvNywbJcLHa7%252BvsBLcRQGb%252B91R1yxEf6GuUc9%252F2iL42R89%252BJ8aG5MR7UrVNWQi7i5Mc1ZmHKTLcgQdqHRCiLxcyqxK6KNpzFJniIXtdjSUBY2cudFw0JuuRuj3cVdk5DfCPjjXkQjrdryZ1Dv6KHUDg727Ife7bvoI6Ebh8IseirMlT5owx9W5BT5RiiE99kxarLxvI6yFqZ8TNYwJ7UrcNCMKiE4csGOqUBN46X8vbNi4vE2CVlD5a4v4al6Xrxb4IRTU8IJ1N7KXz9XBNUVttAlz0XWl5%252FVVx2zLYZDHZeYXVJjeypvprdwxGps2EsCPRf%252BSOfh4RDbZTkYHgRXuKyQWLxiJ%252BAFWm3T2o9IiCjv2MeB2bZnVBIjhj9MTbeCilK%252FyMlXEnlKTADVZNTHwqxNmeeyvgCzwd%252Fu%252BICbGoikpmZMkltr4g2kNOG7L3t%26X-Amz-Signature%3D8ad7e7b9cce45892c33b9bf7010eccbd182882eed7c10dfafb192b1706d4e572%26X-Amz-SignedHeaders%3Dhost%26x-amz-checksum-mode%3DENABLED%26x-id%3DGetObject?table=block&amp;id=14688756-3979-801b-8e1e-cf72d1848856" class=glightbox data-aspect-ratio=0.732973 data-description="" data-gallery=article-images data-title=Image style=aspect-ratio:0.732973><img alt=Image loading=lazy src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F3a9e11cf-1dd2-4987-b330-8e9d67ea3555%2FUntitled.png%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Content-Sha256%3DUNSIGNED-PAYLOAD%26X-Amz-Credential%3DASIAZI2LB4665RQPAUBN%252F20260127%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20260127T045736Z%26X-Amz-Expires%3D3600%26X-Amz-Security-Token%3DIQoJb3JpZ2luX2VjEIX%252F%252F%252F%252F%252F%252F%252F%252F%252F%252FwEaCXVzLXdlc3QtMiJHMEUCIQCB7DmaM866b1JY8DWstFOSSHCYTAp8bz5gGdt0%252Fv6AowIgEQGFxtwBKc4GAn0EtdkWqxuzvzE%252Blb8AHAYmLWKATTgq%252FwMIThAAGgw2Mzc0MjMxODM4MDUiDD39mIIid1mAFM4aSSrcA1hi6b1zZQL8SpGkNOaiYijkHGwXVFa65MXERmHIysqFmvYFdtGWRjb1QVf6Vzhg2MvKowBuEpMzuJsb1xv1lz3%252BZXW4KQWlpyltSMgO0y1g3wzreiXKfgVWUq4W1xrQNkkxomiS0GU0oIDqXYw%252BH2KB1B51LUZyhtplfoonNZnsTPoTv32OM9bC9UhHdFdfg2f79chobPO83qnjOa5WZOMQLySozI0zF7OCPu%252FnDRAdiOwFoG4JHEiuj2MFZDQSxYuZMLgHhaBmJs18l51dbuYrq5g8SsNOXK331VsR6CfxsFysHTWJBr8LlHyiy8fyAPrvr7ioTVw5fhJVZfsgT9NqQxOwNIjLmtX7gxsozMOx6R0M3k6RsdZQiqGp65nNJgQMXn%252B0VFOvLWga%252FUq8KCCZgpK1566HyWfcdvNywbJcLHa7%252BvsBLcRQGb%252B91R1yxEf6GuUc9%252F2iL42R89%252BJ8aG5MR7UrVNWQi7i5Mc1ZmHKTLcgQdqHRCiLxcyqxK6KNpzFJniIXtdjSUBY2cudFw0JuuRuj3cVdk5DfCPjjXkQjrdryZ1Dv6KHUDg727Ife7bvoI6Ebh8IseirMlT5owx9W5BT5RiiE99kxarLxvI6yFqZ8TNYwJ7UrcNCMKiE4csGOqUBN46X8vbNi4vE2CVlD5a4v4al6Xrxb4IRTU8IJ1N7KXz9XBNUVttAlz0XWl5%252FVVx2zLYZDHZeYXVJjeypvprdwxGps2EsCPRf%252BSOfh4RDbZTkYHgRXuKyQWLxiJ%252BAFWm3T2o9IiCjv2MeB2bZnVBIjhj9MTbeCilK%252FyMlXEnlKTADVZNTHwqxNmeeyvgCzwd%252Fu%252BICbGoikpmZMkltr4g2kNOG7L3t%26X-Amz-Signature%3D8ad7e7b9cce45892c33b9bf7010eccbd182882eed7c10dfafb192b1706d4e572%26X-Amz-SignedHeaders%3Dhost%26x-amz-checksum-mode%3DENABLED%26x-id%3DGetObject?table=block&amp;id=14688756-3979-801b-8e1e-cf72d1848856" onload="const ratio=this.naturalWidth/this.naturalHeight;this.parentElement.style.aspectRatio=ratio.toFixed(6),this.parentElement.setAttribute(&#34;data-aspect-ratio&#34;,ratio.toFixed(6)),this.parentElement.classList.add(&#34;loaded&#34;)"/></a></figure><p><br></p><p><br></p><p>剩下的一些，就基本属于是对协程的「扩展」了</p><p>首先就是所谓的调度器，前面 generator 的模式是没有调度的，或者说，是用户手动控制调度，自己决定何时运行哪个协程，而且这里调度一个协程，就是执行它这个函数。</p><p>而 async / await 模式就会有调度器，例如一个函数在 await 另一个 async 函数，此时如果该函数并没有执行完成，await 这里就需要等待，控制流会被切换出去（类似 generator 模式的 yield），调度器会进行调度</p><p>在设计更复杂的情况下，调度器的工作会多很多，例如如果不是采用 return 和直接 call 来转移所有权，那就可能需要通过直接跳转的方式（插入汇编或 <code>setjmp</code>/<code>longjmp</code> 等）来进行协程的所有权转移。以及可能有更复杂的调度策略决定运行哪一个协程</p><p>南京大学操作系统课程的其中一个实验就是实现这个程度的协程</p><figure class=notion-bookmark><a href=https://jyywiki.cn/OS/2024/labs/M2.md rel="noopener noreferrer" target=_blank><div class=notion-bookmark-cover><img alt="" loading=lazy src=https://jyywiki.cn/OS/img/vscode.svg /></div><div class=notion-bookmark-info><div class=notion-bookmark-title>M2: 协程库 (libco)</div><div class=notion-bookmark-url>jyywiki.cn</div></div></a></figure><p><br></p><p>接着是一些协程设计上的问题。前面我们转移所有权的时候，yield 是定向地转移回所有权到 caller 上，因此可以用 return 实现。但更多场景是 yield 时协程 A 希望暂停自己的同时定向恢复协程 B 的运行，但又不希望 A 直接 call B（如果 B 也 call A，就会造成无限递归）。</p><p>一种实现是基于调度器的，称为非对称协程，A 返回到调度器，要求调度器 call B。这会带来一些性能损失，且不太能保证实时性</p><figure class="notion-image notion-image-center" style=max-width:432px><a href="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F0f71dddd-810b-4881-81bf-75296977bd15%2FUntitled.png%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Content-Sha256%3DUNSIGNED-PAYLOAD%26X-Amz-Credential%3DASIAZI2LB4665RQPAUBN%252F20260127%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20260127T045739Z%26X-Amz-Expires%3D3600%26X-Amz-Security-Token%3DIQoJb3JpZ2luX2VjEIX%252F%252F%252F%252F%252F%252F%252F%252F%252F%252FwEaCXVzLXdlc3QtMiJHMEUCIQCB7DmaM866b1JY8DWstFOSSHCYTAp8bz5gGdt0%252Fv6AowIgEQGFxtwBKc4GAn0EtdkWqxuzvzE%252Blb8AHAYmLWKATTgq%252FwMIThAAGgw2Mzc0MjMxODM4MDUiDD39mIIid1mAFM4aSSrcA1hi6b1zZQL8SpGkNOaiYijkHGwXVFa65MXERmHIysqFmvYFdtGWRjb1QVf6Vzhg2MvKowBuEpMzuJsb1xv1lz3%252BZXW4KQWlpyltSMgO0y1g3wzreiXKfgVWUq4W1xrQNkkxomiS0GU0oIDqXYw%252BH2KB1B51LUZyhtplfoonNZnsTPoTv32OM9bC9UhHdFdfg2f79chobPO83qnjOa5WZOMQLySozI0zF7OCPu%252FnDRAdiOwFoG4JHEiuj2MFZDQSxYuZMLgHhaBmJs18l51dbuYrq5g8SsNOXK331VsR6CfxsFysHTWJBr8LlHyiy8fyAPrvr7ioTVw5fhJVZfsgT9NqQxOwNIjLmtX7gxsozMOx6R0M3k6RsdZQiqGp65nNJgQMXn%252B0VFOvLWga%252FUq8KCCZgpK1566HyWfcdvNywbJcLHa7%252BvsBLcRQGb%252B91R1yxEf6GuUc9%252F2iL42R89%252BJ8aG5MR7UrVNWQi7i5Mc1ZmHKTLcgQdqHRCiLxcyqxK6KNpzFJniIXtdjSUBY2cudFw0JuuRuj3cVdk5DfCPjjXkQjrdryZ1Dv6KHUDg727Ife7bvoI6Ebh8IseirMlT5owx9W5BT5RiiE99kxarLxvI6yFqZ8TNYwJ7UrcNCMKiE4csGOqUBN46X8vbNi4vE2CVlD5a4v4al6Xrxb4IRTU8IJ1N7KXz9XBNUVttAlz0XWl5%252FVVx2zLYZDHZeYXVJjeypvprdwxGps2EsCPRf%252BSOfh4RDbZTkYHgRXuKyQWLxiJ%252BAFWm3T2o9IiCjv2MeB2bZnVBIjhj9MTbeCilK%252FyMlXEnlKTADVZNTHwqxNmeeyvgCzwd%252Fu%252BICbGoikpmZMkltr4g2kNOG7L3t%26X-Amz-Signature%3Dfd497fc99ed32f416c4bc06ffa7c64155e963f49b5bb4d4f45387d8628909679%26X-Amz-SignedHeaders%3Dhost%26x-amz-checksum-mode%3DENABLED%26x-id%3DGetObject?table=block&amp;id=14688756-3979-800d-8df6-f3fb9ba47926" class=glightbox data-aspect-ratio=1.235974 data-description="" data-gallery=article-images data-title=Image style=aspect-ratio:1.235974><img alt=Image loading=lazy src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F0f71dddd-810b-4881-81bf-75296977bd15%2FUntitled.png%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Content-Sha256%3DUNSIGNED-PAYLOAD%26X-Amz-Credential%3DASIAZI2LB4665RQPAUBN%252F20260127%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20260127T045739Z%26X-Amz-Expires%3D3600%26X-Amz-Security-Token%3DIQoJb3JpZ2luX2VjEIX%252F%252F%252F%252F%252F%252F%252F%252F%252F%252FwEaCXVzLXdlc3QtMiJHMEUCIQCB7DmaM866b1JY8DWstFOSSHCYTAp8bz5gGdt0%252Fv6AowIgEQGFxtwBKc4GAn0EtdkWqxuzvzE%252Blb8AHAYmLWKATTgq%252FwMIThAAGgw2Mzc0MjMxODM4MDUiDD39mIIid1mAFM4aSSrcA1hi6b1zZQL8SpGkNOaiYijkHGwXVFa65MXERmHIysqFmvYFdtGWRjb1QVf6Vzhg2MvKowBuEpMzuJsb1xv1lz3%252BZXW4KQWlpyltSMgO0y1g3wzreiXKfgVWUq4W1xrQNkkxomiS0GU0oIDqXYw%252BH2KB1B51LUZyhtplfoonNZnsTPoTv32OM9bC9UhHdFdfg2f79chobPO83qnjOa5WZOMQLySozI0zF7OCPu%252FnDRAdiOwFoG4JHEiuj2MFZDQSxYuZMLgHhaBmJs18l51dbuYrq5g8SsNOXK331VsR6CfxsFysHTWJBr8LlHyiy8fyAPrvr7ioTVw5fhJVZfsgT9NqQxOwNIjLmtX7gxsozMOx6R0M3k6RsdZQiqGp65nNJgQMXn%252B0VFOvLWga%252FUq8KCCZgpK1566HyWfcdvNywbJcLHa7%252BvsBLcRQGb%252B91R1yxEf6GuUc9%252F2iL42R89%252BJ8aG5MR7UrVNWQi7i5Mc1ZmHKTLcgQdqHRCiLxcyqxK6KNpzFJniIXtdjSUBY2cudFw0JuuRuj3cVdk5DfCPjjXkQjrdryZ1Dv6KHUDg727Ife7bvoI6Ebh8IseirMlT5owx9W5BT5RiiE99kxarLxvI6yFqZ8TNYwJ7UrcNCMKiE4csGOqUBN46X8vbNi4vE2CVlD5a4v4al6Xrxb4IRTU8IJ1N7KXz9XBNUVttAlz0XWl5%252FVVx2zLYZDHZeYXVJjeypvprdwxGps2EsCPRf%252BSOfh4RDbZTkYHgRXuKyQWLxiJ%252BAFWm3T2o9IiCjv2MeB2bZnVBIjhj9MTbeCilK%252FyMlXEnlKTADVZNTHwqxNmeeyvgCzwd%252Fu%252BICbGoikpmZMkltr4g2kNOG7L3t%26X-Amz-Signature%3Dfd497fc99ed32f416c4bc06ffa7c64155e963f49b5bb4d4f45387d8628909679%26X-Amz-SignedHeaders%3Dhost%26x-amz-checksum-mode%3DENABLED%26x-id%3DGetObject?table=block&amp;id=14688756-3979-800d-8df6-f3fb9ba47926" onload="const ratio=this.naturalWidth/this.naturalHeight;this.parentElement.style.aspectRatio=ratio.toFixed(6),this.parentElement.setAttribute(&#34;data-aspect-ratio&#34;,ratio.toFixed(6)),this.parentElement.classList.add(&#34;loaded&#34;)"/></a></figure><p>另一类是对称协程，需要一些特殊的指令，让 A 能够直接切换到 B，且 B 返回后直接回到了调度器，这个过程对调度器是不知情的，这种设计架空了调度器，实现上更加复杂，但性能更好更加灵活</p><figure class="notion-image notion-image-center" style=max-width:384px><a href="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Ff34759e5-39ea-43d1-a126-b96a589bb37b%2FUntitled.png%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Content-Sha256%3DUNSIGNED-PAYLOAD%26X-Amz-Credential%3DASIAZI2LB4665RQPAUBN%252F20260127%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20260127T045738Z%26X-Amz-Expires%3D3600%26X-Amz-Security-Token%3DIQoJb3JpZ2luX2VjEIX%252F%252F%252F%252F%252F%252F%252F%252F%252F%252FwEaCXVzLXdlc3QtMiJHMEUCIQCB7DmaM866b1JY8DWstFOSSHCYTAp8bz5gGdt0%252Fv6AowIgEQGFxtwBKc4GAn0EtdkWqxuzvzE%252Blb8AHAYmLWKATTgq%252FwMIThAAGgw2Mzc0MjMxODM4MDUiDD39mIIid1mAFM4aSSrcA1hi6b1zZQL8SpGkNOaiYijkHGwXVFa65MXERmHIysqFmvYFdtGWRjb1QVf6Vzhg2MvKowBuEpMzuJsb1xv1lz3%252BZXW4KQWlpyltSMgO0y1g3wzreiXKfgVWUq4W1xrQNkkxomiS0GU0oIDqXYw%252BH2KB1B51LUZyhtplfoonNZnsTPoTv32OM9bC9UhHdFdfg2f79chobPO83qnjOa5WZOMQLySozI0zF7OCPu%252FnDRAdiOwFoG4JHEiuj2MFZDQSxYuZMLgHhaBmJs18l51dbuYrq5g8SsNOXK331VsR6CfxsFysHTWJBr8LlHyiy8fyAPrvr7ioTVw5fhJVZfsgT9NqQxOwNIjLmtX7gxsozMOx6R0M3k6RsdZQiqGp65nNJgQMXn%252B0VFOvLWga%252FUq8KCCZgpK1566HyWfcdvNywbJcLHa7%252BvsBLcRQGb%252B91R1yxEf6GuUc9%252F2iL42R89%252BJ8aG5MR7UrVNWQi7i5Mc1ZmHKTLcgQdqHRCiLxcyqxK6KNpzFJniIXtdjSUBY2cudFw0JuuRuj3cVdk5DfCPjjXkQjrdryZ1Dv6KHUDg727Ife7bvoI6Ebh8IseirMlT5owx9W5BT5RiiE99kxarLxvI6yFqZ8TNYwJ7UrcNCMKiE4csGOqUBN46X8vbNi4vE2CVlD5a4v4al6Xrxb4IRTU8IJ1N7KXz9XBNUVttAlz0XWl5%252FVVx2zLYZDHZeYXVJjeypvprdwxGps2EsCPRf%252BSOfh4RDbZTkYHgRXuKyQWLxiJ%252BAFWm3T2o9IiCjv2MeB2bZnVBIjhj9MTbeCilK%252FyMlXEnlKTADVZNTHwqxNmeeyvgCzwd%252Fu%252BICbGoikpmZMkltr4g2kNOG7L3t%26X-Amz-Signature%3D4d1e9eff8d4dfe94696da3c1d66149468ca93b6d2e170e356412941442b01b97%26X-Amz-SignedHeaders%3Dhost%26x-amz-checksum-mode%3DENABLED%26x-id%3DGetObject?table=block&amp;id=14688756-3979-809a-af5f-ee8cc4612737" class=glightbox data-aspect-ratio=1.122000 data-description="" data-gallery=article-images data-title=Image style=aspect-ratio:1.122000><img alt=Image loading=lazy src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Ff34759e5-39ea-43d1-a126-b96a589bb37b%2FUntitled.png%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Content-Sha256%3DUNSIGNED-PAYLOAD%26X-Amz-Credential%3DASIAZI2LB4665RQPAUBN%252F20260127%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20260127T045738Z%26X-Amz-Expires%3D3600%26X-Amz-Security-Token%3DIQoJb3JpZ2luX2VjEIX%252F%252F%252F%252F%252F%252F%252F%252F%252F%252FwEaCXVzLXdlc3QtMiJHMEUCIQCB7DmaM866b1JY8DWstFOSSHCYTAp8bz5gGdt0%252Fv6AowIgEQGFxtwBKc4GAn0EtdkWqxuzvzE%252Blb8AHAYmLWKATTgq%252FwMIThAAGgw2Mzc0MjMxODM4MDUiDD39mIIid1mAFM4aSSrcA1hi6b1zZQL8SpGkNOaiYijkHGwXVFa65MXERmHIysqFmvYFdtGWRjb1QVf6Vzhg2MvKowBuEpMzuJsb1xv1lz3%252BZXW4KQWlpyltSMgO0y1g3wzreiXKfgVWUq4W1xrQNkkxomiS0GU0oIDqXYw%252BH2KB1B51LUZyhtplfoonNZnsTPoTv32OM9bC9UhHdFdfg2f79chobPO83qnjOa5WZOMQLySozI0zF7OCPu%252FnDRAdiOwFoG4JHEiuj2MFZDQSxYuZMLgHhaBmJs18l51dbuYrq5g8SsNOXK331VsR6CfxsFysHTWJBr8LlHyiy8fyAPrvr7ioTVw5fhJVZfsgT9NqQxOwNIjLmtX7gxsozMOx6R0M3k6RsdZQiqGp65nNJgQMXn%252B0VFOvLWga%252FUq8KCCZgpK1566HyWfcdvNywbJcLHa7%252BvsBLcRQGb%252B91R1yxEf6GuUc9%252F2iL42R89%252BJ8aG5MR7UrVNWQi7i5Mc1ZmHKTLcgQdqHRCiLxcyqxK6KNpzFJniIXtdjSUBY2cudFw0JuuRuj3cVdk5DfCPjjXkQjrdryZ1Dv6KHUDg727Ife7bvoI6Ebh8IseirMlT5owx9W5BT5RiiE99kxarLxvI6yFqZ8TNYwJ7UrcNCMKiE4csGOqUBN46X8vbNi4vE2CVlD5a4v4al6Xrxb4IRTU8IJ1N7KXz9XBNUVttAlz0XWl5%252FVVx2zLYZDHZeYXVJjeypvprdwxGps2EsCPRf%252BSOfh4RDbZTkYHgRXuKyQWLxiJ%252BAFWm3T2o9IiCjv2MeB2bZnVBIjhj9MTbeCilK%252FyMlXEnlKTADVZNTHwqxNmeeyvgCzwd%252Fu%252BICbGoikpmZMkltr4g2kNOG7L3t%26X-Amz-Signature%3D4d1e9eff8d4dfe94696da3c1d66149468ca93b6d2e170e356412941442b01b97%26X-Amz-SignedHeaders%3Dhost%26x-amz-checksum-mode%3DENABLED%26x-id%3DGetObject?table=block&amp;id=14688756-3979-809a-af5f-ee8cc4612737" onload="const ratio=this.naturalWidth/this.naturalHeight;this.parentElement.style.aspectRatio=ratio.toFixed(6),this.parentElement.setAttribute(&#34;data-aspect-ratio&#34;,ratio.toFixed(6)),this.parentElement.classList.add(&#34;loaded&#34;)"/></a></figure><p><br></p><p>设计上另外一个重要的区别是协程的栈帧，也就是有栈协程和无栈协程。前面实现的协程是无栈协程，它们两个的区别从概念上讲，只有是否保存完整栈帧。</p><p>从实现角度来看，无栈线程的「状态」只有局部变量，转移所有权的位置等，对于该协程来说都是固定的，所以每个无栈协程的帧通常是一个定制的结构体（当然编译器帮你实现了），这个结构体就直接代表了整个无栈协程的所有状态，例如前面 <code>fib</code> 的例子，它的这个结构体可能就是这样的</p><div class=notion-code-block><div class=notion-code-header><span class=notion-code-language>C++</span> <button aria-label=复制代码 title=复制代码 class=notion-code-copy><svg fill=none viewBox="0 0 24 24" height=16 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=16><rect height=13 rx=2 ry=2 width=13 x=9 y=9></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg> <span class=copy-text>COPY</span></button></div><pre class=notion-code><code class=language-c++>struct fib_state {
    int a;
    int b;
    int c;
    int state;
}</code></pre></div><p>而有栈协程对于帧的保存，无论是哪个协程，都是直接申请一大块内存，将其作为函数的调用栈来使用，一切状态都保存在内部。从这个角度来讲，有栈协程更接近普通函数</p><div class=notion-code-block><div class=notion-code-header><span class=notion-code-language>C++</span> <button aria-label=复制代码 title=复制代码 class=notion-code-copy><svg fill=none viewBox="0 0 24 24" height=16 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=16><rect height=13 rx=2 ry=2 width=13 x=9 y=9></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg> <span class=copy-text>COPY</span></button></div><pre class=notion-code><code class=language-c++>struct co {
    byte stack[STACK_SIZE];
}</code></pre></div><p><br></p><p>在使用上的一个重要区别是，有栈协程可以在任意处挂起，包括嵌套函数。而无栈协程不可以，因为它的帧结构只保存了它自己特定的那几个的状态，所以无法恢复到嵌套函数内部。这使得有栈协程在使用上和普通函数几乎没有区别，就像线程一样</p><p>实现上的差异这也体现出无栈协程更加紧凑，开销更小，因为它只保存了必要的状态。而有栈协程需要保存的状态更多，而且通常是有些浪费的（当然也可以让这个栈更小，但要考虑动态扩展的问题）</p><p><br></p><p>现在对于各种语言的协程实现就很清晰了，generator 和 async / await 就是编译器层面上实现的无栈协程，以语法糖的方式来提供。而 goroutine / virtual thread 等更类似线程，这是因为他们是有栈协程，还实现了抢占式的调度器来控制协程的执行，当然这里对于这种抢占式设计是不是协程也有不少争议，因为看起来他们从根本上就违背了协程的「协作式」这一想法</p><p><br></p><h2 id="">性能</h2><p>对于无栈协程，性能上的优势是明显的，首先它保存的状态是非常轻量的，只保存了必须的状态。其次，无栈协程的场景通常是「协作式」的，也就是 A 运行一会，然后轮到 B 运行</p><p>如果通过线程来做这样的操作，大部分时间是浪费在无意义的上下文切换和互斥开销当中了，而无栈协程主动切换控制权，使其每次切换都是有意义的</p><p><br></p><p>而对于带抢占式调度器的有栈协程，和线程那么像，或者说它就是一种用户线程，那究竟开销少在哪里？</p><p>首先，进程和线程的调度需要到内核态做上下文切换，会有以下开销：</p><ol><li>切换页表全局目录</li><li>切换内核态堆栈</li><li>切换硬件上下文（进程恢复前，必须装入寄存器的数据统称为硬件上下文）</li><li>刷新TLB</li><li>内核调度器的执行</li></ol><p>其中特别是跨 CPU 导致的 Cache 失效问题，会对性能有明显影响。CPU 之间也可以看作是一种分布式系统，在高性能场景中，跨 CPU 之间的交互就像跨节点的网络通信一样，相对于纯本地运算要慢得多，是要尽力避免的</p><p><br></p><p>协程调度也需要进行上下文切换，开销主要少在几个方面：</p><ol><li>协程栈通常只有几 KB，比数 M 的线程栈要小得多（无栈协程连这部分也不需要，就只是一个普通的函数调用）</li><li>协程的上下文切换没有跨进程，也就不需要修改额外的内核数据结构（页表等），也不会造成 Cache 失效</li><li>协程调度在用户态，而线程调度在内核态，每次调度都会有额外的上下文切换（到内核态）。协程避免了大量线程频繁的内核态上下文切换，能充分利用分给一个线程的时间片</li></ol><p><br></p><h2 id="">局限</h2><p>协程的轻量和用户态调度带来很高的性能，那么代价是什么？</p><p>首先无栈协程的功能上有局限，例如无法在嵌套函数中挂起，使得它的编程模型还是和普通函数有些不同，也无法实现一些效果，像在大部分语言中 async / await 就会带来传染性</p><p>其次对于有栈协程/用户线程，正是因为它运行在用户态，当涉及需要内核支援的部分时就很被动，例如面对阻塞式 I/O 时，无法察觉导致整个内核线程上的所有协程都被阻塞，或者需要一些比较高级的 CPU 亲和性调度时也难以实现</p><p>以及如果当调度不是抢占式时，协程如果不让出执行权或者因为一些异常导致执行权没有正常让出，就会一直占用在那里，导致其他协程无法运行。当然 Go 都解决了上面这两个问题，但设计上更加复杂了</p><p><br></p><h2 id=ref>Ref</h2><figure class=notion-bookmark><a href=https://mthli.xyz/coroutines-in-c/ rel="noopener noreferrer" target=_blank><div class=notion-bookmark-info><div class=notion-bookmark-title>使用 C 语言实现协程</div><div class=notion-bookmark-description>一种基于达夫设备的思想实现的协程。</div><div class=notion-bookmark-url>mthli.xyz</div></div></a></figure><figure class=notion-bookmark><a href=https://www.bilibili.com/video/BV1dv4y127YT/ rel="noopener noreferrer" target=_blank><div class=notion-bookmark-info><div class=notion-bookmark-title>bilibili.com</div><div class=notion-bookmark-url>bilibili.com</div></div></a></figure><figure class=notion-bookmark><a href=https://zhuanlan.zhihu.com/p/330606651 rel="noopener noreferrer" target=_blank><div class=notion-bookmark-info><div class=notion-bookmark-title>zhuanlan.zhihu.com</div><div class=notion-bookmark-url>zhuanlan.zhihu.com</div></div></a></figure><figure class=notion-bookmark><a href=https://www.zhihu.com/question/50185085/answer/1342613525 rel="noopener noreferrer" target=_blank><div class=notion-bookmark-info><div class=notion-bookmark-title>zhihu.com</div><div class=notion-bookmark-url>zhihu.com</div></div></a></figure><figure class=notion-bookmark><a href=https://zhuanlan.zhihu.com/p/80037638 rel="noopener noreferrer" target=_blank><div class=notion-bookmark-info><div class=notion-bookmark-title>zhuanlan.zhihu.com</div><div class=notion-bookmark-url>zhuanlan.zhihu.com</div></div></a></figure><p><br></p></div><nav class=post-navigation data-astro-cid-gbhzkc2y><a href=/post/memorydb class="nav-link nav-prev" data-astro-cid-gbhzkc2y><span class=nav-label data-astro-cid-gbhzkc2y>← 上一篇</span> <span class=nav-title data-astro-cid-gbhzkc2y>MemoryDB: Redis + Remote Log</span> </a><a href=/post/deterministic-simulator class="nav-link nav-next" data-astro-cid-gbhzkc2y><span class=nav-label data-astro-cid-gbhzkc2y>下一篇 →</span> <span class=nav-title data-astro-cid-gbhzkc2y>确定性模拟器</span></a></nav><footer class=page-footer data-astro-cid-gbhzkc2y><a href=/ class=back-link data-astro-cid-gbhzkc2y>← 返回首页</a></footer><section class=comments-section data-astro-cid-gbhzkc2y><div class=comments-container data-astro-cid-te6ksoa6 data-giscus-config={&#34;slug&#34;:&#34;coroutine&#34;,&#34;title&#34;:&#34;浅谈协程&#34;,&#34;config&#34;:{&#34;repo&#34;:&#34;xxxuuu/xxxuuu.github.io&#34;,&#34;repoId&#34;:&#34;MDEwOlJlcG9zaXRvcnkxODQ3Mjk3Mjg&#34;,&#34;category&#34;:&#34;Announcements&#34;,&#34;categoryId&#34;:&#34;DIC_kwDOCwLAgM4ChgWc&#34;,&#34;mapping&#34;:&#34;title&#34;,&#34;strict&#34;:&#34;0&#34;,&#34;reactionsEnabled&#34;:&#34;1&#34;,&#34;emitMetadata&#34;:&#34;0&#34;,&#34;inputPosition&#34;:&#34;bottom&#34;,&#34;lang&#34;:&#34;zh-CN&#34;,&#34;lazy&#34;:true}} data-provider=giscus id=comments><div class=comments-loading data-astro-cid-te6ksoa6>加载评论中...</div></div></section></div><aside class=toc-container data-astro-cid-gbhzkc2y><div class=toc-wrapper data-astro-cid-gbhzkc2y><div class=toc-title data-astro-cid-gbhzkc2y>目录</div><nav class=toc-nav data-astro-cid-gbhzkc2y></nav></div></aside></div></div></article></main><footer data-astro-cid-aoh3bln3><div class=container data-astro-cid-aoh3bln3><div class=footer-content data-astro-cid-aoh3bln3><div class=copyright data-astro-cid-aoh3bln3><p data-astro-cid-aoh3bln3>&copy; 2026 x³u³. All rights reserved.</p><p data-astro-cid-aoh3bln3 class=powered-by>Powered by <a href=https://github.com/xxxuuu/nopress rel="noopener noreferrer" target=_blank data-astro-cid-aoh3bln3>Nopress</a></p></div><div class=social-links data-astro-cid-aoh3bln3><a href=https://github.com/xxxuuu class=social-icon aria-label=github data-astro-cid-aoh3bln3 rel="noopener noreferrer" target=_blank><span class=icon-wrapper data-astro-cid-aoh3bln3><svg fill=currentColor viewBox="0 0 24 24" aria-hidden=true><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg></span></a><a href=https://x.com/xxuuu0 class=social-icon aria-label=twitter data-astro-cid-aoh3bln3 rel="noopener noreferrer" target=_blank><span class=icon-wrapper data-astro-cid-aoh3bln3><svg fill=currentColor viewBox="0 0 24 24" aria-hidden=true><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></span></a><a href=mailto:xxuuu0@outlook.com class=social-icon aria-label=email data-astro-cid-aoh3bln3 rel="noopener noreferrer" target=_blank><span class=icon-wrapper data-astro-cid-aoh3bln3><svg fill=currentColor viewBox="0 0 24 24" aria-hidden=true><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4-8 5-8-5V6l8 5 8-5v2z"/></svg></span></a><a href=/rss/feed.xml class="social-icon rss" aria-label=RSS订阅 data-astro-cid-aoh3bln3><span class=icon-wrapper data-astro-cid-aoh3bln3><svg fill=currentColor viewBox="0 0 24 24" aria-hidden=true><path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1z"/></svg></span></a></div></div></div></footer></body></html>