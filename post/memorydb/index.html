<!DOCTYPE html><html data-astro-cid-pjvcz6dw lang=zh-CN><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><link href="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F49b4570c-b2f0-457b-81b7-b68e2693a471%2Favatar.png?table=collection&id=0bb2e606-8d0c-4f7c-aca9-70986e90c055" rel=icon><link href=https://xxxuuu.me/post/memorydb/ rel=canonical><link href=/rss/feed.xml rel=alternate title=x³u³ type=application/rss+xml><link href=/sitemap-index.xml rel=sitemap><title>MemoryDB: Redis + Remote Log | x³u³</title><meta content="MemoryDB 是 Amazon 的一个 Redis 兼容的 KV 数据库，论文发表在 SIGMOD 2024 上" name=description><meta content=website property=og:type><meta content=https://xxxuuu.me/post/memorydb/ property=og:url><meta content="MemoryDB: Redis + Remote Log | x³u³" property=og:title><meta content="MemoryDB 是 Amazon 的一个 Redis 兼容的 KV 数据库，论文发表在 SIGMOD 2024 上" property=og:description><meta content="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Fa9af1d6b-f284-4734-ba06-990353cf3f84%2FElaina.jpg?table=collection&id=0bb2e606-8d0c-4f7c-aca9-70986e90c055" property=og:image><meta content=summary_large_image name=twitter:card><meta content=@xxuuu0 name=twitter:site><meta content="MemoryDB: Redis + Remote Log | x³u³" name=twitter:title><meta content="MemoryDB 是 Amazon 的一个 Redis 兼容的 KV 数据库，论文发表在 SIGMOD 2024 上" name=twitter:description><meta content="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Fa9af1d6b-f284-4734-ba06-990353cf3f84%2FElaina.jpg?table=collection&id=0bb2e606-8d0c-4f7c-aca9-70986e90c055" name=twitter:image><link href=https://cdn.jsdelivr.net/npm/photoswipe@5.4.3/dist/photoswipe.css rel=preload as=style onload="this.onload=null,this.rel=&#34;stylesheet&#34;"><noscript><link href=https://cdn.jsdelivr.net/npm/photoswipe@5.4.3/dist/photoswipe.css rel=stylesheet></noscript><script>!function(){const e=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");document.documentElement.classList.add(e)}()</script><link href=/_astro/katex.CVb4srxQ.css rel=stylesheet><link href=/_astro/_slug_.Hsk_LU_h.css rel=stylesheet><link href=/_astro/_slug_.BzJEnS8p.css rel=stylesheet><link href=/_astro/_slug_.DOIB7y8p.css rel=stylesheet><script src=/_astro/hoisted.B871fABB.js type=module></script></head><body data-astro-cid-pjvcz6dw><header class=notion-header data-astro-cid-4f4rmh32><div class=header-container data-astro-cid-4f4rmh32><div class=header-content data-astro-cid-4f4rmh32><div class=logo data-astro-cid-4f4rmh32><a href=/ class=logo-link data-astro-cid-4f4rmh32>x³u³</a></div><div class=header-actions data-astro-cid-4f4rmh32><nav class=nav data-astro-cid-4f4rmh32><a href=/ class=nav-link data-astro-cid-4f4rmh32>🏠 首页 </a><a href=/archive class=nav-link data-astro-cid-4f4rmh32>📃 归档 </a><a href=/links class=nav-link data-astro-cid-4f4rmh32>👬 友链 </a><a href=https://p.xxxuuu.me class=nav-link data-astro-cid-4f4rmh32 rel="noopener noreferrer" target=_blank>📷 摄影 <span class=external-icon data-astro-cid-4f4rmh32>↗</span> </a><a href=/about class=nav-link data-astro-cid-4f4rmh32>👤 关于</a></nav><button aria-label="Toggle theme" data-astro-cid-44mn2ykx id=theme-toggle title=切换主题><svg fill=none viewBox="0 0 24 24" class=sun-icon data-astro-cid-44mn2ykx height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><circle cx=12 cy=12 data-astro-cid-44mn2ykx r=5></circle><line data-astro-cid-44mn2ykx x1=12 x2=12 y1=1 y2=3></line><line data-astro-cid-44mn2ykx x1=12 x2=12 y1=21 y2=23></line><line data-astro-cid-44mn2ykx x1=4.22 x2=5.64 y1=4.22 y2=5.64></line><line data-astro-cid-44mn2ykx x1=18.36 x2=19.78 y1=18.36 y2=19.78></line><line data-astro-cid-44mn2ykx x1=1 x2=3 y1=12 y2=12></line><line data-astro-cid-44mn2ykx x1=21 x2=23 y1=12 y2=12></line><line data-astro-cid-44mn2ykx x1=4.22 x2=5.64 y1=19.78 y2=18.36></line><line data-astro-cid-44mn2ykx x1=18.36 x2=19.78 y1=5.64 y2=4.22></line></svg> <svg fill=none viewBox="0 0 24 24" class=moon-icon data-astro-cid-44mn2ykx height=20 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=20 xmlns=http://www.w3.org/2000/svg><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" data-astro-cid-44mn2ykx></path></svg></button></div></div></div></header><main class=notion-main data-astro-cid-pjvcz6dw><article class=content data-astro-cid-gbhzkc2y><div class=notion-page data-astro-cid-gbhzkc2y><div class=page-container data-astro-cid-gbhzkc2y><div class=page-main data-astro-cid-gbhzkc2y><header class=page-header data-astro-cid-gbhzkc2y><h1 class=page-title data-astro-cid-gbhzkc2y>MemoryDB: Redis + Remote Log</h1></header><div class=page-meta data-astro-cid-gbhzkc2y><div class=meta-info data-astro-cid-gbhzkc2y><span class=meta-item data-astro-cid-gbhzkc2y><span class=meta-icon data-astro-cid-gbhzkc2y>📅</span> <time data-astro-cid-gbhzkc2y datetime=2024-11-17>2024年11月17日</time> </span><span class=meta-item data-astro-cid-gbhzkc2y><span class=meta-icon data-astro-cid-gbhzkc2y>⏱️</span> <span data-astro-cid-gbhzkc2y>6 分钟阅读</span></span></div><div class=meta-tags data-astro-cid-gbhzkc2y><span class=tags-icon data-astro-cid-gbhzkc2y>🏷️</span> <a href=/tag/分布式系统 class=tag-pill data-astro-cid-gbhzkc2y>分布式系统</a><a href=/tag/数据库 class=tag-pill data-astro-cid-gbhzkc2y>数据库</a><a href=/tag/论文阅读 class=tag-pill data-astro-cid-gbhzkc2y>论文阅读</a></div><div class=meta-description data-astro-cid-gbhzkc2y>MemoryDB 是 Amazon 的一个 Redis 兼容的 KV 数据库，论文发表在 SIGMOD 2024 上</div></div><hr class=page-divider data-astro-cid-gbhzkc2y><div class=notion-content data-astro-cid-gbhzkc2y><p>MemoryDB 是 Amazon 的一个 Redis 兼容的 KV 数据库，论文发表在 SIGMOD 2024 上</p><p>由于 Redis 是内存数据库，持久性保证比较弱，因此在使用 Redis 作为主存储的低延迟需求场景，大部分人会构建一套复杂的架构来同步或备份 Redis 的数据，Redis 自己也提供了复制和集群的功能，然而这其中的容错处理无法真正保证一致性和持久性。MemoryDB 诞生就是为了解决这个问题，提供一个<strong>能保证持久性的高可用强一致 Redis，并且仍然保持内存级性能</strong></p><p><br></p><h1 id="">架构</h1><p>首先回顾下 Redis 自身的持久化和一致性挑战：</p><ol><li>Redis 通过副本提供高可用，但这个过程是异步的，当主节点故障，副节点被提升为主节点而复制未完成时，就会永久丢失数据</li><li>Redis 包含 RDB 和 AOF 两种持久化方法，分别是快照和事务日志，对于 AOF 可以配置成每次写入都执行 <code>fsync()</code> 以牺牲可用性为代价提供持久化。但多节点场景 AOF 不能提供任何保证，主节点故障时同样没有办法确保选举出的副本具有最新数据，最坏情况下这个副本可能没有任何数据，导致数据完全丢失</li><li>Redis 提供了 <code>WAIT</code> 命令，通过该命令，客户端能阻塞等待数据同步复制直到完成。但 <code>WAIT</code> 只对当前连接有效，不是全局的。对于其他客户端来说仍然无法保证观察到的数据一致性。同样，故障时也没法做任何保证</li></ol><p>简单来说，<strong>Redis 故障转移会导致数据丢失</strong></p><p><br></p><p>MemoryDB 直接基于 Redis 构建，但并没有进行侵入性修改。这里通过加入一个分布式事务日志服务将两层实现解耦，Redis 只相当于这套架构底下的执行引擎</p><p>Redis 主节点自身的复制流会被拦截，重定向到事务日志中。在同步写入日志成功后对客户端返回，所有其他副本都只是重放日志</p><figure class="notion-image notion-image-center" style=max-width:384px><a href="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Fc20e8ae2-0be9-402e-a134-7c5ce4a0fa29%2Fimage.png%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Content-Sha256%3DUNSIGNED-PAYLOAD%26X-Amz-Credential%3DASIAZI2LB466QPJ5LNAH%252F20260126%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20260126T163638Z%26X-Amz-Expires%3D3600%26X-Amz-Security-Token%3DIQoJb3JpZ2luX2VjEHgaCXVzLXdlc3QtMiJHMEUCIQDDsSEAj45htmUola9de%252B1Y%252FCUohTOMwM9%252F3fyI7TqeHgIgffzWG4AvRjdPUXhizbbb10ZCwXmi0OF3U7%252B6RTfywioq%252FwMIQRAAGgw2Mzc0MjMxODM4MDUiDBw6m3jpLyjsP4HyHyrcA%252BsuCcvp6uH5ZlnhghVzVyFT7Quf6dUIh3U5dolb4yB3Uq6AtcZdgd6cGnJYE3nW2hS%252B2XXmFESkNSZCIcfYAe4rxvmylOOWlzYR%252FOXey0GYfhM%252B2WWl%252BYkPHyaMJaIuvUWDbfio7RXF0lbmK6bdEj10jEqJLt93n0tF2a%252BjBanPKilPpUQp%252F8HxJhLi6SMyjCkeuisFew5h3A874tDefqEabm75421Sz5aM8ZTlnMgoHmoNeuZElerrHQfzMmTi4ylV94hzyl0x5eBVxJs1rPC%252BirSFfLxmiE5D5qb8WzfJyGNPuwz%252BrKfLLdFElOjMEP9h6ZyvKWUw8JRbKGm0m%252FnPdBA9IC2z%252BqCI%252BB%252BLCUYx3ReD96%252FI9yJ96Srkrvkbq%252BGnnuY%252F%252FwRMAqmpkz8zl0WHFFF8a%252BJrstUaBzHMjsxMqW1NgZdwHb31wKdFqsz850qmAFKW9M8KVJRgHCx4jL5lfPfzGpP%252B7mKnHqfw5yg3LbLPQYDKFON3ZAxVxXu4viItJ4Gp9ScXadJdiu%252BT2jk49RbrXqmtXhk3PY8unhsMRKE8wy11V1MK9hgzrY80gRVy0ym6P4kLzX5txLpZQYfAAoOnjHhpr3QQkQYWUNOe5y8nnJvvAzWxnmpBMJ2V3ssGOqUBx1d4CfN6qsEsIEeqcmWyOsYkUhf%252FfQQl0RvyoDjixk0J1hD3VzianOxoPQb0ctEu2m2bY1ebwaqWQVJUgTY8ZX%252FwycY7sJte4%252BH4f%252B0s4hNv3E8rAMpiU3e9G5Z1aTsgNsmY58dH4aAL0J%252FNRrUcrL7qDWUB%252FNZan39BVPmhAi5vVULowqqAxJi7WnhVcvkp%252FlG5SPKLDTQwNVVRyZjLwkdOdWeH%26X-Amz-Signature%3D0073aaf79202d796d1ec819d7f70015e61c718c0590e541a10494281f6bf652f%26X-Amz-SignedHeaders%3Dhost%26x-amz-checksum-mode%3DENABLED%26x-id%3DGetObject?table=block&amp;id=12d88756-3979-8038-bd8a-faad3d98bd5e" class=glightbox data-aspect-ratio=0.990847 data-description="MemoryDB 架构（话说这图真糊啊" data-gallery=article-images data-title="MemoryDB 架构（话说这图真糊啊" style=aspect-ratio:0.990847><img alt="MemoryDB 架构（话说这图真糊啊" loading=lazy src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Fc20e8ae2-0be9-402e-a134-7c5ce4a0fa29%2Fimage.png%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Content-Sha256%3DUNSIGNED-PAYLOAD%26X-Amz-Credential%3DASIAZI2LB466QPJ5LNAH%252F20260126%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20260126T163638Z%26X-Amz-Expires%3D3600%26X-Amz-Security-Token%3DIQoJb3JpZ2luX2VjEHgaCXVzLXdlc3QtMiJHMEUCIQDDsSEAj45htmUola9de%252B1Y%252FCUohTOMwM9%252F3fyI7TqeHgIgffzWG4AvRjdPUXhizbbb10ZCwXmi0OF3U7%252B6RTfywioq%252FwMIQRAAGgw2Mzc0MjMxODM4MDUiDBw6m3jpLyjsP4HyHyrcA%252BsuCcvp6uH5ZlnhghVzVyFT7Quf6dUIh3U5dolb4yB3Uq6AtcZdgd6cGnJYE3nW2hS%252B2XXmFESkNSZCIcfYAe4rxvmylOOWlzYR%252FOXey0GYfhM%252B2WWl%252BYkPHyaMJaIuvUWDbfio7RXF0lbmK6bdEj10jEqJLt93n0tF2a%252BjBanPKilPpUQp%252F8HxJhLi6SMyjCkeuisFew5h3A874tDefqEabm75421Sz5aM8ZTlnMgoHmoNeuZElerrHQfzMmTi4ylV94hzyl0x5eBVxJs1rPC%252BirSFfLxmiE5D5qb8WzfJyGNPuwz%252BrKfLLdFElOjMEP9h6ZyvKWUw8JRbKGm0m%252FnPdBA9IC2z%252BqCI%252BB%252BLCUYx3ReD96%252FI9yJ96Srkrvkbq%252BGnnuY%252F%252FwRMAqmpkz8zl0WHFFF8a%252BJrstUaBzHMjsxMqW1NgZdwHb31wKdFqsz850qmAFKW9M8KVJRgHCx4jL5lfPfzGpP%252B7mKnHqfw5yg3LbLPQYDKFON3ZAxVxXu4viItJ4Gp9ScXadJdiu%252BT2jk49RbrXqmtXhk3PY8unhsMRKE8wy11V1MK9hgzrY80gRVy0ym6P4kLzX5txLpZQYfAAoOnjHhpr3QQkQYWUNOe5y8nnJvvAzWxnmpBMJ2V3ssGOqUBx1d4CfN6qsEsIEeqcmWyOsYkUhf%252FfQQl0RvyoDjixk0J1hD3VzianOxoPQb0ctEu2m2bY1ebwaqWQVJUgTY8ZX%252FwycY7sJte4%252BH4f%252B0s4hNv3E8rAMpiU3e9G5Z1aTsgNsmY58dH4aAL0J%252FNRrUcrL7qDWUB%252FNZan39BVPmhAi5vVULowqqAxJi7WnhVcvkp%252FlG5SPKLDTQwNVVRyZjLwkdOdWeH%26X-Amz-Signature%3D0073aaf79202d796d1ec819d7f70015e61c718c0590e541a10494281f6bf652f%26X-Amz-SignedHeaders%3Dhost%26x-amz-checksum-mode%3DENABLED%26x-id%3DGetObject?table=block&amp;id=12d88756-3979-8038-bd8a-faad3d98bd5e"/></a><figcaption>MemoryDB 架构（话说这图真糊啊</figcaption></figure><p><br></p><h1 id="">持久性</h1><p>事务日志服务是 Multi-AZ 的，能提供持久化的存储，对主节点的操作会同步写入到事务日志中，其他副本就像普通的 Redis 复制过程一样读取事务日志</p><p>可以看出这里事务日志是系统的核心，提供了完美的保证，但论文没有具体说明它是如何构建的，应该又是 Amazon 内部的黑盒服务</p><p>部分分布式数据库允许使用 Kafka 作为 Remote WAL，所以如果要做一个 MemoryDB 的开源实现，Kafka 应该可以承担这个事务日志服务的角色，但还是会有很多额外工作量</p><p><br></p><h1 id="">一致性</h1><p>MemoryDB 这里的日志是一种 WBL（Write-behind logging），选择 WBL 而不是 WAL 的原因是它天然和 Redis 的复制模型保持一致，例如 SPOP 之类的随机操作也能保证相同的结果</p><p><br></p><p>但这样会带来的问题是写入日志前故障会导致不一致，所以这里需要事务日志 ACK 了才能向客户端返回。MemoryDB 通过添加一层 client blocking 层作为 tracker 实现这一点，考虑到 MemoryDB 避免修改 Redis 的前提下，我猜应该类似这样的实现</p><figure class="notion-image notion-image-center" style=max-width:288px><a href="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Fbfc3d68f-ea82-430d-99cb-248f2d66a4bc%2F%25E6%259C%25AA%25E5%2591%25BD%25E5%2590%258D%25E7%25BB%2598%25E5%259B%25BE.drawio.png%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Content-Sha256%3DUNSIGNED-PAYLOAD%26X-Amz-Credential%3DASIAZI2LB466QPJ5LNAH%252F20260126%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20260126T163638Z%26X-Amz-Expires%3D3600%26X-Amz-Security-Token%3DIQoJb3JpZ2luX2VjEHgaCXVzLXdlc3QtMiJHMEUCIQDDsSEAj45htmUola9de%252B1Y%252FCUohTOMwM9%252F3fyI7TqeHgIgffzWG4AvRjdPUXhizbbb10ZCwXmi0OF3U7%252B6RTfywioq%252FwMIQRAAGgw2Mzc0MjMxODM4MDUiDBw6m3jpLyjsP4HyHyrcA%252BsuCcvp6uH5ZlnhghVzVyFT7Quf6dUIh3U5dolb4yB3Uq6AtcZdgd6cGnJYE3nW2hS%252B2XXmFESkNSZCIcfYAe4rxvmylOOWlzYR%252FOXey0GYfhM%252B2WWl%252BYkPHyaMJaIuvUWDbfio7RXF0lbmK6bdEj10jEqJLt93n0tF2a%252BjBanPKilPpUQp%252F8HxJhLi6SMyjCkeuisFew5h3A874tDefqEabm75421Sz5aM8ZTlnMgoHmoNeuZElerrHQfzMmTi4ylV94hzyl0x5eBVxJs1rPC%252BirSFfLxmiE5D5qb8WzfJyGNPuwz%252BrKfLLdFElOjMEP9h6ZyvKWUw8JRbKGm0m%252FnPdBA9IC2z%252BqCI%252BB%252BLCUYx3ReD96%252FI9yJ96Srkrvkbq%252BGnnuY%252F%252FwRMAqmpkz8zl0WHFFF8a%252BJrstUaBzHMjsxMqW1NgZdwHb31wKdFqsz850qmAFKW9M8KVJRgHCx4jL5lfPfzGpP%252B7mKnHqfw5yg3LbLPQYDKFON3ZAxVxXu4viItJ4Gp9ScXadJdiu%252BT2jk49RbrXqmtXhk3PY8unhsMRKE8wy11V1MK9hgzrY80gRVy0ym6P4kLzX5txLpZQYfAAoOnjHhpr3QQkQYWUNOe5y8nnJvvAzWxnmpBMJ2V3ssGOqUBx1d4CfN6qsEsIEeqcmWyOsYkUhf%252FfQQl0RvyoDjixk0J1hD3VzianOxoPQb0ctEu2m2bY1ebwaqWQVJUgTY8ZX%252FwycY7sJte4%252BH4f%252B0s4hNv3E8rAMpiU3e9G5Z1aTsgNsmY58dH4aAL0J%252FNRrUcrL7qDWUB%252FNZan39BVPmhAi5vVULowqqAxJi7WnhVcvkp%252FlG5SPKLDTQwNVVRyZjLwkdOdWeH%26X-Amz-Signature%3Dea62ab63612acf09b9abb96f70e25f748cb1adf0eedf435734427c5261261d8a%26X-Amz-SignedHeaders%3Dhost%26x-amz-checksum-mode%3DENABLED%26x-id%3DGetObject?table=block&amp;id=14188756-3979-804a-bb79-e2f6312ba5b5" class=glightbox data-aspect-ratio=0.603982 data-description="" data-gallery=article-images data-title=Image style=aspect-ratio:0.603982><img alt=Image loading=lazy src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Fbfc3d68f-ea82-430d-99cb-248f2d66a4bc%2F%25E6%259C%25AA%25E5%2591%25BD%25E5%2590%258D%25E7%25BB%2598%25E5%259B%25BE.drawio.png%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Content-Sha256%3DUNSIGNED-PAYLOAD%26X-Amz-Credential%3DASIAZI2LB466QPJ5LNAH%252F20260126%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20260126T163638Z%26X-Amz-Expires%3D3600%26X-Amz-Security-Token%3DIQoJb3JpZ2luX2VjEHgaCXVzLXdlc3QtMiJHMEUCIQDDsSEAj45htmUola9de%252B1Y%252FCUohTOMwM9%252F3fyI7TqeHgIgffzWG4AvRjdPUXhizbbb10ZCwXmi0OF3U7%252B6RTfywioq%252FwMIQRAAGgw2Mzc0MjMxODM4MDUiDBw6m3jpLyjsP4HyHyrcA%252BsuCcvp6uH5ZlnhghVzVyFT7Quf6dUIh3U5dolb4yB3Uq6AtcZdgd6cGnJYE3nW2hS%252B2XXmFESkNSZCIcfYAe4rxvmylOOWlzYR%252FOXey0GYfhM%252B2WWl%252BYkPHyaMJaIuvUWDbfio7RXF0lbmK6bdEj10jEqJLt93n0tF2a%252BjBanPKilPpUQp%252F8HxJhLi6SMyjCkeuisFew5h3A874tDefqEabm75421Sz5aM8ZTlnMgoHmoNeuZElerrHQfzMmTi4ylV94hzyl0x5eBVxJs1rPC%252BirSFfLxmiE5D5qb8WzfJyGNPuwz%252BrKfLLdFElOjMEP9h6ZyvKWUw8JRbKGm0m%252FnPdBA9IC2z%252BqCI%252BB%252BLCUYx3ReD96%252FI9yJ96Srkrvkbq%252BGnnuY%252F%252FwRMAqmpkz8zl0WHFFF8a%252BJrstUaBzHMjsxMqW1NgZdwHb31wKdFqsz850qmAFKW9M8KVJRgHCx4jL5lfPfzGpP%252B7mKnHqfw5yg3LbLPQYDKFON3ZAxVxXu4viItJ4Gp9ScXadJdiu%252BT2jk49RbrXqmtXhk3PY8unhsMRKE8wy11V1MK9hgzrY80gRVy0ym6P4kLzX5txLpZQYfAAoOnjHhpr3QQkQYWUNOe5y8nnJvvAzWxnmpBMJ2V3ssGOqUBx1d4CfN6qsEsIEeqcmWyOsYkUhf%252FfQQl0RvyoDjixk0J1hD3VzianOxoPQb0ctEu2m2bY1ebwaqWQVJUgTY8ZX%252FwycY7sJte4%252BH4f%252B0s4hNv3E8rAMpiU3e9G5Z1aTsgNsmY58dH4aAL0J%252FNRrUcrL7qDWUB%252FNZan39BVPmhAi5vVULowqqAxJi7WnhVcvkp%252FlG5SPKLDTQwNVVRyZjLwkdOdWeH%26X-Amz-Signature%3Dea62ab63612acf09b9abb96f70e25f748cb1adf0eedf435734427c5261261d8a%26X-Amz-SignedHeaders%3Dhost%26x-amz-checksum-mode%3DENABLED%26x-id%3DGetObject?table=block&amp;id=14188756-3979-804a-bb79-e2f6312ba5b5"/></a></figure><p>这里的好处同样是解耦了 Redis，即使事务日志写入未确认，仍然可以让 Redis 继续处理接下来的请求</p><p>但对于主节点的读操作，仍然需要等待其所依赖的写入被持久化，因此在 tracker 需要去 trace 每个尚未被写入日志的 key。只对主节点读写可以提供线性一致性，也允许直接从副本读，这时提供的是顺序一致性，跨多个副本的读取则是最终一致的</p><p><br></p><h1 id="">可用性</h1><p>通过前面的手段，已经能保证主节点正常工作时的持久性和一致性，接下来需要再考虑下分布式系统中最重要的容错处理，主要是以下三个问题：</p><ol><li>故障检测：副本如何知道主节点故障</li><li>选举方式：哪些副本会被提升为主节点</li><li>故障恢复：临时故障的节点如何恢复</li></ol><p><br></p><p>MemoryDB 完美利用事务日志实现了以上三点。事务日志中除了正常数据的复制流，还会包括一些控制日志</p><p>故障检测的方法就是典型的心跳，但这里心跳是作为一条日志，主节点定期写入心跳/租约日志，如果副本未能在租约期限内观测到这类日志，就认为主节点宕机，触发选举</p><div class="notion-callout notion-callout-yellow-background"><div class=notion-callout-icon>❓</div><div class=notion-callout-content>这里感觉会有些时钟问题</div></div><p><br></p><p>其次是具体选主方式，选主时所有副本都只会和日志服务交互，不会互相通信，因此这里并不是采用 quorum 之类的投票方式，而同样是采用写入日志的方法</p><p>每个日志都会有一个唯一 ID，且 append 新日志时，必须指定前序日志 ID。因此多个副本竞争选主时，只有第一个竞选日志是有效的，这也确保了能竞选的副本必然拥有最新数据。新主上台后会通过 gossip 协议通知其他节点，这部分是采用 Redis Cluster 自己的实现</p><p><br></p><p>最后，当故障的主节点恢复时，由于租约过期，它会自行下台重新作为副本工作。除了利用心跳日志实现的故障检测，MemoryDB 通过带外监控服务的心跳检测和内部 Redis Cluster 的 gossip 结合来获得一个集群视图，管控面会在其认为故障的节点上重启 Redis 进程或启动新副本轮替该节点</p><p>MemoryDB 做了很多优化去减少 MTTR（Mean time to recovery）。在运行时，Redis 自身的持久化/快照（RDB）机制也在工作，快照被上传到 S3 中，新副本启动或恢复时会通过 S3 获得快照快速赶上进度然后开始回放事务日志</p><figure class="notion-image notion-image-center" style=max-width:336px><a href="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F9f382b69-dd91-4ea1-909c-793eeaef7f63%2Fimage.png%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Content-Sha256%3DUNSIGNED-PAYLOAD%26X-Amz-Credential%3DASIAZI2LB466QPJ5LNAH%252F20260126%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20260126T163638Z%26X-Amz-Expires%3D3600%26X-Amz-Security-Token%3DIQoJb3JpZ2luX2VjEHgaCXVzLXdlc3QtMiJHMEUCIQDDsSEAj45htmUola9de%252B1Y%252FCUohTOMwM9%252F3fyI7TqeHgIgffzWG4AvRjdPUXhizbbb10ZCwXmi0OF3U7%252B6RTfywioq%252FwMIQRAAGgw2Mzc0MjMxODM4MDUiDBw6m3jpLyjsP4HyHyrcA%252BsuCcvp6uH5ZlnhghVzVyFT7Quf6dUIh3U5dolb4yB3Uq6AtcZdgd6cGnJYE3nW2hS%252B2XXmFESkNSZCIcfYAe4rxvmylOOWlzYR%252FOXey0GYfhM%252B2WWl%252BYkPHyaMJaIuvUWDbfio7RXF0lbmK6bdEj10jEqJLt93n0tF2a%252BjBanPKilPpUQp%252F8HxJhLi6SMyjCkeuisFew5h3A874tDefqEabm75421Sz5aM8ZTlnMgoHmoNeuZElerrHQfzMmTi4ylV94hzyl0x5eBVxJs1rPC%252BirSFfLxmiE5D5qb8WzfJyGNPuwz%252BrKfLLdFElOjMEP9h6ZyvKWUw8JRbKGm0m%252FnPdBA9IC2z%252BqCI%252BB%252BLCUYx3ReD96%252FI9yJ96Srkrvkbq%252BGnnuY%252F%252FwRMAqmpkz8zl0WHFFF8a%252BJrstUaBzHMjsxMqW1NgZdwHb31wKdFqsz850qmAFKW9M8KVJRgHCx4jL5lfPfzGpP%252B7mKnHqfw5yg3LbLPQYDKFON3ZAxVxXu4viItJ4Gp9ScXadJdiu%252BT2jk49RbrXqmtXhk3PY8unhsMRKE8wy11V1MK9hgzrY80gRVy0ym6P4kLzX5txLpZQYfAAoOnjHhpr3QQkQYWUNOe5y8nnJvvAzWxnmpBMJ2V3ssGOqUBx1d4CfN6qsEsIEeqcmWyOsYkUhf%252FfQQl0RvyoDjixk0J1hD3VzianOxoPQb0ctEu2m2bY1ebwaqWQVJUgTY8ZX%252FwycY7sJte4%252BH4f%252B0s4hNv3E8rAMpiU3e9G5Z1aTsgNsmY58dH4aAL0J%252FNRrUcrL7qDWUB%252FNZan39BVPmhAi5vVULowqqAxJi7WnhVcvkp%252FlG5SPKLDTQwNVVRyZjLwkdOdWeH%26X-Amz-Signature%3D37dd011cf11f82816be5df7272a467f6d57ed2d381d4b59c5ae35c7a3f8a5205%26X-Amz-SignedHeaders%3Dhost%26x-amz-checksum-mode%3DENABLED%26x-id%3DGetObject?table=block&amp;id=14088756-3979-80e3-9143-ffcc1806f24d" class=glightbox data-aspect-ratio=0.849624 data-description="" data-gallery=article-images data-title=Image style=aspect-ratio:0.849624><img alt=Image loading=lazy src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F9f382b69-dd91-4ea1-909c-793eeaef7f63%2Fimage.png%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Content-Sha256%3DUNSIGNED-PAYLOAD%26X-Amz-Credential%3DASIAZI2LB466QPJ5LNAH%252F20260126%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20260126T163638Z%26X-Amz-Expires%3D3600%26X-Amz-Security-Token%3DIQoJb3JpZ2luX2VjEHgaCXVzLXdlc3QtMiJHMEUCIQDDsSEAj45htmUola9de%252B1Y%252FCUohTOMwM9%252F3fyI7TqeHgIgffzWG4AvRjdPUXhizbbb10ZCwXmi0OF3U7%252B6RTfywioq%252FwMIQRAAGgw2Mzc0MjMxODM4MDUiDBw6m3jpLyjsP4HyHyrcA%252BsuCcvp6uH5ZlnhghVzVyFT7Quf6dUIh3U5dolb4yB3Uq6AtcZdgd6cGnJYE3nW2hS%252B2XXmFESkNSZCIcfYAe4rxvmylOOWlzYR%252FOXey0GYfhM%252B2WWl%252BYkPHyaMJaIuvUWDbfio7RXF0lbmK6bdEj10jEqJLt93n0tF2a%252BjBanPKilPpUQp%252F8HxJhLi6SMyjCkeuisFew5h3A874tDefqEabm75421Sz5aM8ZTlnMgoHmoNeuZElerrHQfzMmTi4ylV94hzyl0x5eBVxJs1rPC%252BirSFfLxmiE5D5qb8WzfJyGNPuwz%252BrKfLLdFElOjMEP9h6ZyvKWUw8JRbKGm0m%252FnPdBA9IC2z%252BqCI%252BB%252BLCUYx3ReD96%252FI9yJ96Srkrvkbq%252BGnnuY%252F%252FwRMAqmpkz8zl0WHFFF8a%252BJrstUaBzHMjsxMqW1NgZdwHb31wKdFqsz850qmAFKW9M8KVJRgHCx4jL5lfPfzGpP%252B7mKnHqfw5yg3LbLPQYDKFON3ZAxVxXu4viItJ4Gp9ScXadJdiu%252BT2jk49RbrXqmtXhk3PY8unhsMRKE8wy11V1MK9hgzrY80gRVy0ym6P4kLzX5txLpZQYfAAoOnjHhpr3QQkQYWUNOe5y8nnJvvAzWxnmpBMJ2V3ssGOqUBx1d4CfN6qsEsIEeqcmWyOsYkUhf%252FfQQl0RvyoDjixk0J1hD3VzianOxoPQb0ctEu2m2bY1ebwaqWQVJUgTY8ZX%252FwycY7sJte4%252BH4f%252B0s4hNv3E8rAMpiU3e9G5Z1aTsgNsmY58dH4aAL0J%252FNRrUcrL7qDWUB%252FNZan39BVPmhAi5vVULowqqAxJi7WnhVcvkp%252FlG5SPKLDTQwNVVRyZjLwkdOdWeH%26X-Amz-Signature%3D37dd011cf11f82816be5df7272a467f6d57ed2d381d4b59c5ae35c7a3f8a5205%26X-Amz-SignedHeaders%3Dhost%26x-amz-checksum-mode%3DENABLED%26x-id%3DGetObject?table=block&amp;id=14088756-3979-80e3-9143-ffcc1806f24d"/></a></figure><p>Redis 的快照是通过 Linux 的 fork 写时复制特性来实现的，虽然整体开销已经很小，但也不可避免地带来一些性能抖动，包括瞬时的内存占用</p><p>MemoryDB 的优化相当于把写时复制从进程扩展到集群层面，快照时会启动一个 off-box 临时集群，临时集群和副本恢复一样，先恢复数据到最新状态，再进行快照。虽然看起来有点重，成本很高，但优点是能完全避免快照导致用户集群产生抖动以及这期间的可用性降低两个问题</p><div class="notion-callout notion-callout-yellow-background"><div class=notion-callout-icon>💡</div><div class=notion-callout-content>关于这一点，还可以看看别家的解决方案，例如阿里云直接修改了内核把 fork 时开销最多的的页表复制过程放到子进程中：<a href=https://www.vldb.org/pvldb/vol16/p1033-chen.pdf rel="noopener noreferrer" target=_blank>Async-fork: Mitigating Query Latency Spikes Incurred by the Fork-based Snapshot Mechanism from the OS Level</a></div></div><p><br></p><h1 id="">性能</h1><p>最后是例行环节 evaluation</p><p><br></p><p>只读(a)和只写(b)负载：</p><figure class="notion-image notion-image-center" style=max-width:528px><a href="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F85832d91-1442-4d30-a09f-b8357d87adbc%2Fimage.png%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Content-Sha256%3DUNSIGNED-PAYLOAD%26X-Amz-Credential%3DASIAZI2LB466QPJ5LNAH%252F20260126%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20260126T163639Z%26X-Amz-Expires%3D3600%26X-Amz-Security-Token%3DIQoJb3JpZ2luX2VjEHgaCXVzLXdlc3QtMiJHMEUCIQDDsSEAj45htmUola9de%252B1Y%252FCUohTOMwM9%252F3fyI7TqeHgIgffzWG4AvRjdPUXhizbbb10ZCwXmi0OF3U7%252B6RTfywioq%252FwMIQRAAGgw2Mzc0MjMxODM4MDUiDBw6m3jpLyjsP4HyHyrcA%252BsuCcvp6uH5ZlnhghVzVyFT7Quf6dUIh3U5dolb4yB3Uq6AtcZdgd6cGnJYE3nW2hS%252B2XXmFESkNSZCIcfYAe4rxvmylOOWlzYR%252FOXey0GYfhM%252B2WWl%252BYkPHyaMJaIuvUWDbfio7RXF0lbmK6bdEj10jEqJLt93n0tF2a%252BjBanPKilPpUQp%252F8HxJhLi6SMyjCkeuisFew5h3A874tDefqEabm75421Sz5aM8ZTlnMgoHmoNeuZElerrHQfzMmTi4ylV94hzyl0x5eBVxJs1rPC%252BirSFfLxmiE5D5qb8WzfJyGNPuwz%252BrKfLLdFElOjMEP9h6ZyvKWUw8JRbKGm0m%252FnPdBA9IC2z%252BqCI%252BB%252BLCUYx3ReD96%252FI9yJ96Srkrvkbq%252BGnnuY%252F%252FwRMAqmpkz8zl0WHFFF8a%252BJrstUaBzHMjsxMqW1NgZdwHb31wKdFqsz850qmAFKW9M8KVJRgHCx4jL5lfPfzGpP%252B7mKnHqfw5yg3LbLPQYDKFON3ZAxVxXu4viItJ4Gp9ScXadJdiu%252BT2jk49RbrXqmtXhk3PY8unhsMRKE8wy11V1MK9hgzrY80gRVy0ym6P4kLzX5txLpZQYfAAoOnjHhpr3QQkQYWUNOe5y8nnJvvAzWxnmpBMJ2V3ssGOqUBx1d4CfN6qsEsIEeqcmWyOsYkUhf%252FfQQl0RvyoDjixk0J1hD3VzianOxoPQb0ctEu2m2bY1ebwaqWQVJUgTY8ZX%252FwycY7sJte4%252BH4f%252B0s4hNv3E8rAMpiU3e9G5Z1aTsgNsmY58dH4aAL0J%252FNRrUcrL7qDWUB%252FNZan39BVPmhAi5vVULowqqAxJi7WnhVcvkp%252FlG5SPKLDTQwNVVRyZjLwkdOdWeH%26X-Amz-Signature%3Dfbfd49df69fcf6183dd981592de0f6f42dfee7ffebd16a55080d176dd1a109cf%26X-Amz-SignedHeaders%3Dhost%26x-amz-checksum-mode%3DENABLED%26x-id%3DGetObject?table=block&amp;id=14188756-3979-8022-a5d3-dc5667a7f2d2" class=glightbox data-aspect-ratio=2.074074 data-description="" data-gallery=article-images data-title=Image style=aspect-ratio:2.074074><img alt=Image loading=lazy src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F85832d91-1442-4d30-a09f-b8357d87adbc%2Fimage.png%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Content-Sha256%3DUNSIGNED-PAYLOAD%26X-Amz-Credential%3DASIAZI2LB466QPJ5LNAH%252F20260126%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20260126T163639Z%26X-Amz-Expires%3D3600%26X-Amz-Security-Token%3DIQoJb3JpZ2luX2VjEHgaCXVzLXdlc3QtMiJHMEUCIQDDsSEAj45htmUola9de%252B1Y%252FCUohTOMwM9%252F3fyI7TqeHgIgffzWG4AvRjdPUXhizbbb10ZCwXmi0OF3U7%252B6RTfywioq%252FwMIQRAAGgw2Mzc0MjMxODM4MDUiDBw6m3jpLyjsP4HyHyrcA%252BsuCcvp6uH5ZlnhghVzVyFT7Quf6dUIh3U5dolb4yB3Uq6AtcZdgd6cGnJYE3nW2hS%252B2XXmFESkNSZCIcfYAe4rxvmylOOWlzYR%252FOXey0GYfhM%252B2WWl%252BYkPHyaMJaIuvUWDbfio7RXF0lbmK6bdEj10jEqJLt93n0tF2a%252BjBanPKilPpUQp%252F8HxJhLi6SMyjCkeuisFew5h3A874tDefqEabm75421Sz5aM8ZTlnMgoHmoNeuZElerrHQfzMmTi4ylV94hzyl0x5eBVxJs1rPC%252BirSFfLxmiE5D5qb8WzfJyGNPuwz%252BrKfLLdFElOjMEP9h6ZyvKWUw8JRbKGm0m%252FnPdBA9IC2z%252BqCI%252BB%252BLCUYx3ReD96%252FI9yJ96Srkrvkbq%252BGnnuY%252F%252FwRMAqmpkz8zl0WHFFF8a%252BJrstUaBzHMjsxMqW1NgZdwHb31wKdFqsz850qmAFKW9M8KVJRgHCx4jL5lfPfzGpP%252B7mKnHqfw5yg3LbLPQYDKFON3ZAxVxXu4viItJ4Gp9ScXadJdiu%252BT2jk49RbrXqmtXhk3PY8unhsMRKE8wy11V1MK9hgzrY80gRVy0ym6P4kLzX5txLpZQYfAAoOnjHhpr3QQkQYWUNOe5y8nnJvvAzWxnmpBMJ2V3ssGOqUBx1d4CfN6qsEsIEeqcmWyOsYkUhf%252FfQQl0RvyoDjixk0J1hD3VzianOxoPQb0ctEu2m2bY1ebwaqWQVJUgTY8ZX%252FwycY7sJte4%252BH4f%252B0s4hNv3E8rAMpiU3e9G5Z1aTsgNsmY58dH4aAL0J%252FNRrUcrL7qDWUB%252FNZan39BVPmhAi5vVULowqqAxJi7WnhVcvkp%252FlG5SPKLDTQwNVVRyZjLwkdOdWeH%26X-Amz-Signature%3Dfbfd49df69fcf6183dd981592de0f6f42dfee7ffebd16a55080d176dd1a109cf%26X-Amz-SignedHeaders%3Dhost%26x-amz-checksum-mode%3DENABLED%26x-id%3DGetObject?table=block&amp;id=14188756-3979-8022-a5d3-dc5667a7f2d2"/></a></figure><p>写请求由于有对事务日志的同步写入，性能基本是 Redis 的 1/3 到 1/2 左右，符合预期。但读性能没有理由 MemoryDB 能比 Redis 还快啊？感觉有些猫腻，论文里说是因为 MemoryDB 通过优化过的 I/O 多路复用聚合了客户端链接，但我对此保留疑问</p><p><br></p><p>只读(a)、只写(b)和混合读写(c)的时延表现，基本符合预期：</p><figure class="notion-image notion-image-center notion-image-page-width"><a href="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F2b826c0e-8de6-44a1-9ad2-ac24b15a0c0b%2Fimage.png%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Content-Sha256%3DUNSIGNED-PAYLOAD%26X-Amz-Credential%3DASIAZI2LB466QPJ5LNAH%252F20260126%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20260126T163639Z%26X-Amz-Expires%3D3600%26X-Amz-Security-Token%3DIQoJb3JpZ2luX2VjEHgaCXVzLXdlc3QtMiJHMEUCIQDDsSEAj45htmUola9de%252B1Y%252FCUohTOMwM9%252F3fyI7TqeHgIgffzWG4AvRjdPUXhizbbb10ZCwXmi0OF3U7%252B6RTfywioq%252FwMIQRAAGgw2Mzc0MjMxODM4MDUiDBw6m3jpLyjsP4HyHyrcA%252BsuCcvp6uH5ZlnhghVzVyFT7Quf6dUIh3U5dolb4yB3Uq6AtcZdgd6cGnJYE3nW2hS%252B2XXmFESkNSZCIcfYAe4rxvmylOOWlzYR%252FOXey0GYfhM%252B2WWl%252BYkPHyaMJaIuvUWDbfio7RXF0lbmK6bdEj10jEqJLt93n0tF2a%252BjBanPKilPpUQp%252F8HxJhLi6SMyjCkeuisFew5h3A874tDefqEabm75421Sz5aM8ZTlnMgoHmoNeuZElerrHQfzMmTi4ylV94hzyl0x5eBVxJs1rPC%252BirSFfLxmiE5D5qb8WzfJyGNPuwz%252BrKfLLdFElOjMEP9h6ZyvKWUw8JRbKGm0m%252FnPdBA9IC2z%252BqCI%252BB%252BLCUYx3ReD96%252FI9yJ96Srkrvkbq%252BGnnuY%252F%252FwRMAqmpkz8zl0WHFFF8a%252BJrstUaBzHMjsxMqW1NgZdwHb31wKdFqsz850qmAFKW9M8KVJRgHCx4jL5lfPfzGpP%252B7mKnHqfw5yg3LbLPQYDKFON3ZAxVxXu4viItJ4Gp9ScXadJdiu%252BT2jk49RbrXqmtXhk3PY8unhsMRKE8wy11V1MK9hgzrY80gRVy0ym6P4kLzX5txLpZQYfAAoOnjHhpr3QQkQYWUNOe5y8nnJvvAzWxnmpBMJ2V3ssGOqUBx1d4CfN6qsEsIEeqcmWyOsYkUhf%252FfQQl0RvyoDjixk0J1hD3VzianOxoPQb0ctEu2m2bY1ebwaqWQVJUgTY8ZX%252FwycY7sJte4%252BH4f%252B0s4hNv3E8rAMpiU3e9G5Z1aTsgNsmY58dH4aAL0J%252FNRrUcrL7qDWUB%252FNZan39BVPmhAi5vVULowqqAxJi7WnhVcvkp%252FlG5SPKLDTQwNVVRyZjLwkdOdWeH%26X-Amz-Signature%3Dc3eec7161b12b6f6f5bca9b6173ddda8993e8184f5fdad985b4d6922016984cc%26X-Amz-SignedHeaders%3Dhost%26x-amz-checksum-mode%3DENABLED%26x-id%3DGetObject?table=block&amp;id=14188756-3979-8016-8705-e764ae36bcf0" class=glightbox data-aspect-ratio=2.589552 data-description="" data-gallery=article-images data-title=Image style=aspect-ratio:2.589552><img alt=Image loading=lazy src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F2b826c0e-8de6-44a1-9ad2-ac24b15a0c0b%2Fimage.png%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Content-Sha256%3DUNSIGNED-PAYLOAD%26X-Amz-Credential%3DASIAZI2LB466QPJ5LNAH%252F20260126%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20260126T163639Z%26X-Amz-Expires%3D3600%26X-Amz-Security-Token%3DIQoJb3JpZ2luX2VjEHgaCXVzLXdlc3QtMiJHMEUCIQDDsSEAj45htmUola9de%252B1Y%252FCUohTOMwM9%252F3fyI7TqeHgIgffzWG4AvRjdPUXhizbbb10ZCwXmi0OF3U7%252B6RTfywioq%252FwMIQRAAGgw2Mzc0MjMxODM4MDUiDBw6m3jpLyjsP4HyHyrcA%252BsuCcvp6uH5ZlnhghVzVyFT7Quf6dUIh3U5dolb4yB3Uq6AtcZdgd6cGnJYE3nW2hS%252B2XXmFESkNSZCIcfYAe4rxvmylOOWlzYR%252FOXey0GYfhM%252B2WWl%252BYkPHyaMJaIuvUWDbfio7RXF0lbmK6bdEj10jEqJLt93n0tF2a%252BjBanPKilPpUQp%252F8HxJhLi6SMyjCkeuisFew5h3A874tDefqEabm75421Sz5aM8ZTlnMgoHmoNeuZElerrHQfzMmTi4ylV94hzyl0x5eBVxJs1rPC%252BirSFfLxmiE5D5qb8WzfJyGNPuwz%252BrKfLLdFElOjMEP9h6ZyvKWUw8JRbKGm0m%252FnPdBA9IC2z%252BqCI%252BB%252BLCUYx3ReD96%252FI9yJ96Srkrvkbq%252BGnnuY%252F%252FwRMAqmpkz8zl0WHFFF8a%252BJrstUaBzHMjsxMqW1NgZdwHb31wKdFqsz850qmAFKW9M8KVJRgHCx4jL5lfPfzGpP%252B7mKnHqfw5yg3LbLPQYDKFON3ZAxVxXu4viItJ4Gp9ScXadJdiu%252BT2jk49RbrXqmtXhk3PY8unhsMRKE8wy11V1MK9hgzrY80gRVy0ym6P4kLzX5txLpZQYfAAoOnjHhpr3QQkQYWUNOe5y8nnJvvAzWxnmpBMJ2V3ssGOqUBx1d4CfN6qsEsIEeqcmWyOsYkUhf%252FfQQl0RvyoDjixk0J1hD3VzianOxoPQb0ctEu2m2bY1ebwaqWQVJUgTY8ZX%252FwycY7sJte4%252BH4f%252B0s4hNv3E8rAMpiU3e9G5Z1aTsgNsmY58dH4aAL0J%252FNRrUcrL7qDWUB%252FNZan39BVPmhAi5vVULowqqAxJi7WnhVcvkp%252FlG5SPKLDTQwNVVRyZjLwkdOdWeH%26X-Amz-Signature%3Dc3eec7161b12b6f6f5bca9b6173ddda8993e8184f5fdad985b4d6922016984cc%26X-Amz-SignedHeaders%3Dhost%26x-amz-checksum-mode%3DENABLED%26x-id%3DGetObject?table=block&amp;id=14188756-3979-8016-8705-e764ae36bcf0"/></a></figure><p><br></p><p>接下来是快照，负载是 2000w 个 500 bytes 的 key，节点配置 2c16G。快照同时 100 个 client 执行 GET，20 个 client 执行 SET</p><p>Redis 在快照期间的请求的延迟(a)和吞吐量(b)影响，以及内存占用情况：</p><figure class="notion-image notion-image-center notion-image-page-width"><a href="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F2b3b487b-c4c7-430f-80cc-d0c1ab6f5df5%2Fimage.png%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Content-Sha256%3DUNSIGNED-PAYLOAD%26X-Amz-Credential%3DASIAZI2LB466QPJ5LNAH%252F20260126%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20260126T163639Z%26X-Amz-Expires%3D3600%26X-Amz-Security-Token%3DIQoJb3JpZ2luX2VjEHgaCXVzLXdlc3QtMiJHMEUCIQDDsSEAj45htmUola9de%252B1Y%252FCUohTOMwM9%252F3fyI7TqeHgIgffzWG4AvRjdPUXhizbbb10ZCwXmi0OF3U7%252B6RTfywioq%252FwMIQRAAGgw2Mzc0MjMxODM4MDUiDBw6m3jpLyjsP4HyHyrcA%252BsuCcvp6uH5ZlnhghVzVyFT7Quf6dUIh3U5dolb4yB3Uq6AtcZdgd6cGnJYE3nW2hS%252B2XXmFESkNSZCIcfYAe4rxvmylOOWlzYR%252FOXey0GYfhM%252B2WWl%252BYkPHyaMJaIuvUWDbfio7RXF0lbmK6bdEj10jEqJLt93n0tF2a%252BjBanPKilPpUQp%252F8HxJhLi6SMyjCkeuisFew5h3A874tDefqEabm75421Sz5aM8ZTlnMgoHmoNeuZElerrHQfzMmTi4ylV94hzyl0x5eBVxJs1rPC%252BirSFfLxmiE5D5qb8WzfJyGNPuwz%252BrKfLLdFElOjMEP9h6ZyvKWUw8JRbKGm0m%252FnPdBA9IC2z%252BqCI%252BB%252BLCUYx3ReD96%252FI9yJ96Srkrvkbq%252BGnnuY%252F%252FwRMAqmpkz8zl0WHFFF8a%252BJrstUaBzHMjsxMqW1NgZdwHb31wKdFqsz850qmAFKW9M8KVJRgHCx4jL5lfPfzGpP%252B7mKnHqfw5yg3LbLPQYDKFON3ZAxVxXu4viItJ4Gp9ScXadJdiu%252BT2jk49RbrXqmtXhk3PY8unhsMRKE8wy11V1MK9hgzrY80gRVy0ym6P4kLzX5txLpZQYfAAoOnjHhpr3QQkQYWUNOe5y8nnJvvAzWxnmpBMJ2V3ssGOqUBx1d4CfN6qsEsIEeqcmWyOsYkUhf%252FfQQl0RvyoDjixk0J1hD3VzianOxoPQb0ctEu2m2bY1ebwaqWQVJUgTY8ZX%252FwycY7sJte4%252BH4f%252B0s4hNv3E8rAMpiU3e9G5Z1aTsgNsmY58dH4aAL0J%252FNRrUcrL7qDWUB%252FNZan39BVPmhAi5vVULowqqAxJi7WnhVcvkp%252FlG5SPKLDTQwNVVRyZjLwkdOdWeH%26X-Amz-Signature%3De8ab405d27f7bf33328df3b79fa4cb92f4e74cfbf2ef144a0d9678253b5f11e2%26X-Amz-SignedHeaders%3Dhost%26x-amz-checksum-mode%3DENABLED%26x-id%3DGetObject?table=block&amp;id=14188756-3979-802a-8de9-f5c33426d156" class=glightbox data-aspect-ratio=2.729167 data-description="" data-gallery=article-images data-title=Image style=aspect-ratio:2.729167><img alt=Image loading=lazy src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F2b3b487b-c4c7-430f-80cc-d0c1ab6f5df5%2Fimage.png%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Content-Sha256%3DUNSIGNED-PAYLOAD%26X-Amz-Credential%3DASIAZI2LB466QPJ5LNAH%252F20260126%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20260126T163639Z%26X-Amz-Expires%3D3600%26X-Amz-Security-Token%3DIQoJb3JpZ2luX2VjEHgaCXVzLXdlc3QtMiJHMEUCIQDDsSEAj45htmUola9de%252B1Y%252FCUohTOMwM9%252F3fyI7TqeHgIgffzWG4AvRjdPUXhizbbb10ZCwXmi0OF3U7%252B6RTfywioq%252FwMIQRAAGgw2Mzc0MjMxODM4MDUiDBw6m3jpLyjsP4HyHyrcA%252BsuCcvp6uH5ZlnhghVzVyFT7Quf6dUIh3U5dolb4yB3Uq6AtcZdgd6cGnJYE3nW2hS%252B2XXmFESkNSZCIcfYAe4rxvmylOOWlzYR%252FOXey0GYfhM%252B2WWl%252BYkPHyaMJaIuvUWDbfio7RXF0lbmK6bdEj10jEqJLt93n0tF2a%252BjBanPKilPpUQp%252F8HxJhLi6SMyjCkeuisFew5h3A874tDefqEabm75421Sz5aM8ZTlnMgoHmoNeuZElerrHQfzMmTi4ylV94hzyl0x5eBVxJs1rPC%252BirSFfLxmiE5D5qb8WzfJyGNPuwz%252BrKfLLdFElOjMEP9h6ZyvKWUw8JRbKGm0m%252FnPdBA9IC2z%252BqCI%252BB%252BLCUYx3ReD96%252FI9yJ96Srkrvkbq%252BGnnuY%252F%252FwRMAqmpkz8zl0WHFFF8a%252BJrstUaBzHMjsxMqW1NgZdwHb31wKdFqsz850qmAFKW9M8KVJRgHCx4jL5lfPfzGpP%252B7mKnHqfw5yg3LbLPQYDKFON3ZAxVxXu4viItJ4Gp9ScXadJdiu%252BT2jk49RbrXqmtXhk3PY8unhsMRKE8wy11V1MK9hgzrY80gRVy0ym6P4kLzX5txLpZQYfAAoOnjHhpr3QQkQYWUNOe5y8nnJvvAzWxnmpBMJ2V3ssGOqUBx1d4CfN6qsEsIEeqcmWyOsYkUhf%252FfQQl0RvyoDjixk0J1hD3VzianOxoPQb0ctEu2m2bY1ebwaqWQVJUgTY8ZX%252FwycY7sJte4%252BH4f%252B0s4hNv3E8rAMpiU3e9G5Z1aTsgNsmY58dH4aAL0J%252FNRrUcrL7qDWUB%252FNZan39BVPmhAi5vVULowqqAxJi7WnhVcvkp%252FlG5SPKLDTQwNVVRyZjLwkdOdWeH%26X-Amz-Signature%3De8ab405d27f7bf33328df3b79fa4cb92f4e74cfbf2ef144a0d9678253b5f11e2%26X-Amz-SignedHeaders%3Dhost%26x-amz-checksum-mode%3DENABLED%26x-id%3DGetObject?table=block&amp;id=14188756-3979-802a-8de9-f5c33426d156"/></a></figure><p>MemoryDB 在快照期间的延迟(a)和吞吐量(b)：</p><p><br></p><figure class="notion-image notion-image-center notion-image-page-width"><a href="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F07c212c9-11a1-40a0-a226-8a42735f85fd%2Fimage.png%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Content-Sha256%3DUNSIGNED-PAYLOAD%26X-Amz-Credential%3DASIAZI2LB466QPJ5LNAH%252F20260126%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20260126T163639Z%26X-Amz-Expires%3D3600%26X-Amz-Security-Token%3DIQoJb3JpZ2luX2VjEHgaCXVzLXdlc3QtMiJHMEUCIQDDsSEAj45htmUola9de%252B1Y%252FCUohTOMwM9%252F3fyI7TqeHgIgffzWG4AvRjdPUXhizbbb10ZCwXmi0OF3U7%252B6RTfywioq%252FwMIQRAAGgw2Mzc0MjMxODM4MDUiDBw6m3jpLyjsP4HyHyrcA%252BsuCcvp6uH5ZlnhghVzVyFT7Quf6dUIh3U5dolb4yB3Uq6AtcZdgd6cGnJYE3nW2hS%252B2XXmFESkNSZCIcfYAe4rxvmylOOWlzYR%252FOXey0GYfhM%252B2WWl%252BYkPHyaMJaIuvUWDbfio7RXF0lbmK6bdEj10jEqJLt93n0tF2a%252BjBanPKilPpUQp%252F8HxJhLi6SMyjCkeuisFew5h3A874tDefqEabm75421Sz5aM8ZTlnMgoHmoNeuZElerrHQfzMmTi4ylV94hzyl0x5eBVxJs1rPC%252BirSFfLxmiE5D5qb8WzfJyGNPuwz%252BrKfLLdFElOjMEP9h6ZyvKWUw8JRbKGm0m%252FnPdBA9IC2z%252BqCI%252BB%252BLCUYx3ReD96%252FI9yJ96Srkrvkbq%252BGnnuY%252F%252FwRMAqmpkz8zl0WHFFF8a%252BJrstUaBzHMjsxMqW1NgZdwHb31wKdFqsz850qmAFKW9M8KVJRgHCx4jL5lfPfzGpP%252B7mKnHqfw5yg3LbLPQYDKFON3ZAxVxXu4viItJ4Gp9ScXadJdiu%252BT2jk49RbrXqmtXhk3PY8unhsMRKE8wy11V1MK9hgzrY80gRVy0ym6P4kLzX5txLpZQYfAAoOnjHhpr3QQkQYWUNOe5y8nnJvvAzWxnmpBMJ2V3ssGOqUBx1d4CfN6qsEsIEeqcmWyOsYkUhf%252FfQQl0RvyoDjixk0J1hD3VzianOxoPQb0ctEu2m2bY1ebwaqWQVJUgTY8ZX%252FwycY7sJte4%252BH4f%252B0s4hNv3E8rAMpiU3e9G5Z1aTsgNsmY58dH4aAL0J%252FNRrUcrL7qDWUB%252FNZan39BVPmhAi5vVULowqqAxJi7WnhVcvkp%252FlG5SPKLDTQwNVVRyZjLwkdOdWeH%26X-Amz-Signature%3D071fc0062a9ff35684ee9899587aa11d7ba914e5836163070e10b89a4eaf8775%26X-Amz-SignedHeaders%3Dhost%26x-amz-checksum-mode%3DENABLED%26x-id%3DGetObject?table=block&amp;id=14188756-3979-801e-a64c-d8ba1480ba0c" class=glightbox data-aspect-ratio=2.695473 data-description="" data-gallery=article-images data-title=Image style=aspect-ratio:2.695473><img alt=Image loading=lazy src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F07c212c9-11a1-40a0-a226-8a42735f85fd%2Fimage.png%3FX-Amz-Algorithm%3DAWS4-HMAC-SHA256%26X-Amz-Content-Sha256%3DUNSIGNED-PAYLOAD%26X-Amz-Credential%3DASIAZI2LB466QPJ5LNAH%252F20260126%252Fus-west-2%252Fs3%252Faws4_request%26X-Amz-Date%3D20260126T163639Z%26X-Amz-Expires%3D3600%26X-Amz-Security-Token%3DIQoJb3JpZ2luX2VjEHgaCXVzLXdlc3QtMiJHMEUCIQDDsSEAj45htmUola9de%252B1Y%252FCUohTOMwM9%252F3fyI7TqeHgIgffzWG4AvRjdPUXhizbbb10ZCwXmi0OF3U7%252B6RTfywioq%252FwMIQRAAGgw2Mzc0MjMxODM4MDUiDBw6m3jpLyjsP4HyHyrcA%252BsuCcvp6uH5ZlnhghVzVyFT7Quf6dUIh3U5dolb4yB3Uq6AtcZdgd6cGnJYE3nW2hS%252B2XXmFESkNSZCIcfYAe4rxvmylOOWlzYR%252FOXey0GYfhM%252B2WWl%252BYkPHyaMJaIuvUWDbfio7RXF0lbmK6bdEj10jEqJLt93n0tF2a%252BjBanPKilPpUQp%252F8HxJhLi6SMyjCkeuisFew5h3A874tDefqEabm75421Sz5aM8ZTlnMgoHmoNeuZElerrHQfzMmTi4ylV94hzyl0x5eBVxJs1rPC%252BirSFfLxmiE5D5qb8WzfJyGNPuwz%252BrKfLLdFElOjMEP9h6ZyvKWUw8JRbKGm0m%252FnPdBA9IC2z%252BqCI%252BB%252BLCUYx3ReD96%252FI9yJ96Srkrvkbq%252BGnnuY%252F%252FwRMAqmpkz8zl0WHFFF8a%252BJrstUaBzHMjsxMqW1NgZdwHb31wKdFqsz850qmAFKW9M8KVJRgHCx4jL5lfPfzGpP%252B7mKnHqfw5yg3LbLPQYDKFON3ZAxVxXu4viItJ4Gp9ScXadJdiu%252BT2jk49RbrXqmtXhk3PY8unhsMRKE8wy11V1MK9hgzrY80gRVy0ym6P4kLzX5txLpZQYfAAoOnjHhpr3QQkQYWUNOe5y8nnJvvAzWxnmpBMJ2V3ssGOqUBx1d4CfN6qsEsIEeqcmWyOsYkUhf%252FfQQl0RvyoDjixk0J1hD3VzianOxoPQb0ctEu2m2bY1ebwaqWQVJUgTY8ZX%252FwycY7sJte4%252BH4f%252B0s4hNv3E8rAMpiU3e9G5Z1aTsgNsmY58dH4aAL0J%252FNRrUcrL7qDWUB%252FNZan39BVPmhAi5vVULowqqAxJi7WnhVcvkp%252FlG5SPKLDTQwNVVRyZjLwkdOdWeH%26X-Amz-Signature%3D071fc0062a9ff35684ee9899587aa11d7ba914e5836163070e10b89a4eaf8775%26X-Amz-SignedHeaders%3Dhost%26x-amz-checksum-mode%3DENABLED%26x-id%3DGetObject?table=block&amp;id=14188756-3979-801e-a64c-d8ba1480ba0c"/></a></figure><p>也符合预期，MemoryDB 非常稳定，不过看起来显然也田忌赛马了，没有评估这启动一个临时集群的成本开销，整个快照过程也慢不少</p><p><br></p><h1 id="">总结</h1><p>总结一下几点：</p><ol><li>Redis 仅仅作为执行引擎，解耦实现</li><li>通过事务日志（transaction log）同步写保证持久性</li><li>tracker 追踪未完成持久化的 key，提供线性一致性</li><li>围绕 log 实现租约和选主</li><li>快照卸载到 off-box 集群上执行，避免抖动</li></ol><p><br></p><p>总体来说，是很巧妙的想法和实现，仅仅围绕 log 就实现了这一切。而且从兼容 Redis 这一核心目的角度来看，通过 log 的解耦，能做到极低的侵入性，也就意味着更高的兼容性和可维护性，是非常好的工程实践。大多数开源 fork 魔改到最后，gap 越来越大，再要保持兼容的话维护成本就会很高</p><p><br></p><p>另一方面也引发了我关于 log 的更多思考，大多数数据系统都会有 WAL 或其他各种 log，这种基于 log 复制的 idea 在共识算法中也很常见。MemoryDB 展示了一个如何通过这些 log 扩展系统的完美例子，再回过头来看其他系统、设计和解决方案，不禁会想是不是也能在 log 上迸发出无限可能</p><p><br></p><p>之后如果有时间，可能打算去复刻一个 MemoryDB 的实现</p><p><br></p><h1 id=ref>Ref</h1><ul><li><a href=https://assets.amazon.science/e0/1b/ba6c28034babbc1b18f54aa8102e/amazon-memorydb-a-fast-and-durable-memory-first-cloud-database.pdf rel="noopener noreferrer" target=_blank>Amazon MemoryDB: A Fast and Durable Memory-First Cloud Database</a></li><li><a href=https://aws.amazon.com/cn/blogs/china/amazon-memorydb-a-brief-introduction-to-the-sigmod-2024-paper/ rel="noopener noreferrer" target=_blank>溯本追源 – Amazon MemoryDB SIGMOD 2024 论文解读 | 亚马逊AWS官方博客</a></li><li><a href=https://blog.xiyoulinux.com/blog/104106524 rel="noopener noreferrer" target=_blank>从一到无穷大 #27 从Amazon MemoryDB视角看稳定binlog带来的无限可能性</a></li></ul><p><br></p></div><nav class=post-navigation data-astro-cid-gbhzkc2y><a href=/post/db-mmap class="nav-link nav-prev" data-astro-cid-gbhzkc2y><span class=nav-label data-astro-cid-gbhzkc2y>← 上一篇</span> <span class=nav-title data-astro-cid-gbhzkc2y>应该在 DBMS 中使用 MMAP 吗？</span> </a><a href=/post/coroutine class="nav-link nav-next" data-astro-cid-gbhzkc2y><span class=nav-label data-astro-cid-gbhzkc2y>下一篇 →</span> <span class=nav-title data-astro-cid-gbhzkc2y>浅谈协程</span></a></nav><footer class=page-footer data-astro-cid-gbhzkc2y><a href=/ class=back-link data-astro-cid-gbhzkc2y>← 返回首页</a></footer><section class=comments-section data-astro-cid-gbhzkc2y><div class=comments-container data-astro-cid-te6ksoa6 data-giscus-config="{&#34;slug&#34;:&#34;memorydb&#34;,&#34;title&#34;:&#34;MemoryDB: Redis + Remote Log&#34;,&#34;config&#34;:{&#34;repo&#34;:&#34;xxxuuu/xxxuuu.github.io&#34;,&#34;repoId&#34;:&#34;MDEwOlJlcG9zaXRvcnkxODQ3Mjk3Mjg&#34;,&#34;category&#34;:&#34;Announcements&#34;,&#34;categoryId&#34;:&#34;DIC_kwDOCwLAgM4ChgWc&#34;,&#34;mapping&#34;:&#34;title&#34;,&#34;strict&#34;:&#34;0&#34;,&#34;reactionsEnabled&#34;:&#34;1&#34;,&#34;emitMetadata&#34;:&#34;0&#34;,&#34;inputPosition&#34;:&#34;bottom&#34;,&#34;lang&#34;:&#34;zh-CN&#34;,&#34;lazy&#34;:true}}" data-provider=giscus id=comments><div class=comments-loading data-astro-cid-te6ksoa6>加载评论中...</div></div></section></div><aside class=toc-container data-astro-cid-gbhzkc2y><div class=toc-wrapper data-astro-cid-gbhzkc2y><div class=toc-title data-astro-cid-gbhzkc2y>目录</div><nav class=toc-nav data-astro-cid-gbhzkc2y></nav></div></aside></div></div></article></main><footer data-astro-cid-aoh3bln3><div class=container data-astro-cid-aoh3bln3><div class=footer-content data-astro-cid-aoh3bln3><div class=copyright data-astro-cid-aoh3bln3><p data-astro-cid-aoh3bln3>&copy; 2026 x³u³. All rights reserved.</p><p data-astro-cid-aoh3bln3 class=powered-by>Powered by <a href=https://github.com/xxxuuu/nopress rel="noopener noreferrer" target=_blank data-astro-cid-aoh3bln3>Nopress</a></p></div><div class=social-links data-astro-cid-aoh3bln3><a href=https://github.com/xxxuuu class=social-icon aria-label=github data-astro-cid-aoh3bln3 rel="noopener noreferrer" target=_blank><span class=icon-wrapper data-astro-cid-aoh3bln3><svg fill=currentColor viewBox="0 0 24 24" aria-hidden=true><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg></span></a><a href=https://x.com/xxuuu0 class=social-icon aria-label=twitter data-astro-cid-aoh3bln3 rel="noopener noreferrer" target=_blank><span class=icon-wrapper data-astro-cid-aoh3bln3><svg fill=currentColor viewBox="0 0 24 24" aria-hidden=true><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></span></a><a href=mailto:xxuuu0@outlook.com class=social-icon aria-label=email data-astro-cid-aoh3bln3 rel="noopener noreferrer" target=_blank><span class=icon-wrapper data-astro-cid-aoh3bln3><svg fill=currentColor viewBox="0 0 24 24" aria-hidden=true><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4-8 5-8-5V6l8 5 8-5v2z"/></svg></span></a><a href=/rss/feed.xml class="social-icon rss" aria-label=RSS订阅 data-astro-cid-aoh3bln3><span class=icon-wrapper data-astro-cid-aoh3bln3><svg fill=currentColor viewBox="0 0 24 24" aria-hidden=true><path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1z"/></svg></span></a></div></div></div></footer></body></html>