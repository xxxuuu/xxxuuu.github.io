<!DOCTYPE html><html lang="zh-CN"><head><link rel="icon" href="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F49b4570c-b2f0-457b-81b7-b68e2693a471%2Favatar.png?table=collection&amp;id=0bb2e606-8d0c-4f7c-aca9-70986e90c055&amp;t=0bb2e606-8d0c-4f7c-aca9-70986e90c055&amp;width=800&amp;cache=v2"/><title>Longhorn 浅析 | x³u³</title><meta name="theme-color" content="#000000"/><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=1.0"/><meta name="robots" content="follow, index"/><meta charSet="UTF-8"/><meta name="keywords" content="存储,分布式系统"/><meta name="description" content="Longhorn 是一个 Go 实现的 Cloud Native Storage，比较好奇作为一个提供块存储的分布式存储系统，使用 Go 实现，会面临哪些挑战，性能方面要又要如何优化"/><meta property="og:locale" content="zh_CN"/><meta property="og:title" content="Longhorn 浅析 | x³u³"/><meta property="og:description" content="Longhorn 是一个 Go 实现的 Cloud Native Storage，比较好奇作为一个提供块存储的分布式存储系统，使用 Go 实现，会面临哪些挑战，性能方面要又要如何优化"/><meta property="og:url" content="https://xxxuuu.me/post/longhorn"/><meta property="og:image" content="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Fc3967b7e-bde2-4b5b-b5f6-97de21642f16%2Flonghorn.png?table=block&amp;id=bde25ba8-2381-4da6-bb5e-5787ace45def&amp;t=bde25ba8-2381-4da6-bb5e-5787ace45def&amp;width=800&amp;cache=v2"/><meta property="og:site_name" content="Longhorn 浅析 | x³u³"/><meta property="og:type" content="Post"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:description" content="Longhorn 是一个 Go 实现的 Cloud Native Storage，比较好奇作为一个提供块存储的分布式存储系统，使用 Go 实现，会面临哪些挑战，性能方面要又要如何优化"/><meta name="twitter:title" content="Longhorn 浅析 | x³u³"/><link rel="icon" href="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F49b4570c-b2f0-457b-81b7-b68e2693a471%2Favatar.png?table=collection&amp;id=0bb2e606-8d0c-4f7c-aca9-70986e90c055&amp;t=0bb2e606-8d0c-4f7c-aca9-70986e90c055&amp;width=800&amp;cache=v2"/><meta property="article:published_time"/><meta property="article:author" content="xxxuuu"/><meta property="article:section" content="分布式系统,存储,云原生"/><meta property="article:publisher"/><meta name="next-head-count" content="23"/><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerPolicy="no-referrer"/><link data-next-font="" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/ec75275403549c7b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ec75275403549c7b.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script defer="" src="/_next/static/chunks/3607272e.720be9a60ad0a2e4.js"></script><script defer="" src="/_next/static/chunks/15660.223d3f297fbf2e70.js"></script><script defer="" src="/_next/static/chunks/31794.7e73cf5150b281ef.js"></script><script src="/_next/static/chunks/webpack-2e93fd44b13cc828.js" defer=""></script><script src="/_next/static/chunks/framework-a9bb0a3aa321677c.js" defer=""></script><script src="/_next/static/chunks/main-38dcea65ee3c1f0e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-e9e50482a01cfd95.js" defer=""></script><script src="/_next/static/chunks/88495-591bdb3ec2a9391e.js" defer=""></script><script src="/_next/static/chunks/pages/%5Bprefix%5D/%5Bslug%5D-e9a6e2b9082a2bda.js" defer=""></script><script src="/_next/static/bzll3595dvYzC4mzTRuY5/_buildManifest.js" defer=""></script><script src="/_next/static/bzll3595dvYzC4mzTRuY5/_ssgManifest.js" defer=""></script><style id="__jsx-ae067b659f5ecbd6">:root{--content-width:768px;--theme-color:#ff8200;--fg-color:#495057}::-moz-selection{background-color:var(--theme-color)!important;color:#fff!important}::selection{background-color:var(--theme-color)!important;color:#fff!important}.notion-h-title{color:#343a40;font-weight:bold}.notion-text,.notion-list,.notion-toggle,.notion-to-do,.notion-quote,.notion-callout-text,.notion-simple-table-cell{letter-spacing:.5px;color:var(--fg-color);font-size:1rem;font-weight:400}.notion-inline-code{background:rgba(255,229,100,.2);-webkit-border-radius:2px;-moz-border-radius:2px;border-radius:2px;color:var(--fg-color)}.notion-asset-wrapper img{-webkit-border-radius:.6em;-moz-border-radius:.6em;border-radius:.6em}.notion-quote{-webkit-border-radius:0;-moz-border-radius:0;border-radius:0;border-left:3px solid var(--theme-color);background-color:rgba(238,241,225,.3)}.notion-link{opacity:1;color:#36563c;border-bottom:1px dashed#36563c!important;-webkit-transition:all.3s;-moz-transition:all.3s;-o-transition:all.3s;transition:all.3s}.notion-link:hover{color:var(--theme-color);border-bottom:1px dashed var(--theme-color)!important}.notion-bookmark{-webkit-transition:all.3s;-moz-transition:all.3s;-o-transition:all.3s;transition:all.3s}.notion-bookmark:hover{border-color:var(--theme-color)}.notion-callout{border:0}.notion-property-checkbox-unchecked{-webkit-border-radius:2px;-moz-border-radius:2px;border-radius:2px;border:1.3px solid var(--theme-color)}.notion-property-checkbox-checked{background:var(--theme-color);-webkit-border-radius:2px;-moz-border-radius:2px;border-radius:2px}.notion-property-checkbox-checked .svg{width:12px;height:12px;top:2px;left:2px}.notion-toggle>summary::marker{# TODO gap between marker and text
      }.notion-list li{padding-left:.5rem}.notion-list ol>ul{padding-left:0}.notion-list ul>ol{padding-left:0}.notion-list li::marker{color:var(--theme-color);font-weight:600;letter-spacing:-1px}.notion-table-of-contents-item{opacity:1}</style><style id="__jsx-2783458257">null

  </style></head><body><div id="__next"><div id="theme-autumn" class="font-sans font-light bg-white scroll-smooth"><header style="background-color:null" class="w-full h-[430px] flex justify-center z-10"><div style="background-image:url(https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Fa9af1d6b-f284-4734-ba06-990353cf3f84%2FElaina.jpg?table=collection&amp;id=0bb2e606-8d0c-4f7c-aca9-70986e90c055&amp;t=0bb2e606-8d0c-4f7c-aca9-70986e90c055&amp;width=800&amp;cache=v2)" class="max-w-[var(--content-width)] size-full px-5 flex justify-center items-center flex-col relative bg-cover bg-center"><div class="rounded-xl bg-white/[.6] w-full py-4 px-5 backdrop-blur-sm hover:scale-[1.03] transition duration-300 relative bottom-5"><div class="flex items-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" class="size-20 rounded-full shadow-lg pointer-events-none select-none"/><div class="flex flex-col flex-1 ml-7 size-full"><h1 class="text-2xl my-0 text-[var(--theme-color)] drop-shadow-[0_2px_10px_rgba(231,156,0,0.6)] font-bold">x³u³</h1><div class="text-sm font-normal w-full text-gray-500 mt-2 flex jusitify-between"><span class="flex-1">🗒 碎碎念</span><div class="justify-center flex-wrap flex"><div class="space-x-3 text-sm flex items-center text-gray-500 opacity-80"><a target="_blank" rel="noreferrer" title="github" href="https://github.com/xxxuuu"><i class="fab fa-github"></i></a><a target="_blank" rel="noreferrer" title="email" href="mailto:xxuuu0@outlook.com"><i class="fas fa-envelope"></i></a><a target="_blank" rel="noreferrer" title="RSS" href="/rss/feed.xml"><i class="fas fa-rss"></i></a></div></div></div></div></div></div><div class="absolute w-full bottom-0 px-5"><nav class="w-full bg-transparent"><ul class="flex"><li class="cursor-pointer text-gray-200/[.9] text-sm font-normal drop-shadow-md mr-4 h-8 transition-all duration-100 hover:text-white hover:border-b-white hover:border-b-2"><a target="_self" class="pb-3" href="/"> <!-- -->🏠 首页</a></li><li class="cursor-pointer text-gray-200/[.9] text-sm font-normal drop-shadow-md mr-4 h-8 transition-all duration-100 hover:text-white hover:border-b-white hover:border-b-2"><a target="_self" class="pb-3" href="/archive"> <!-- -->📃 归档</a></li><li class="cursor-pointer text-gray-200/[.9] text-sm font-normal drop-shadow-md mr-4 h-8 transition-all duration-100 hover:text-white hover:border-b-white hover:border-b-2"><a target="_self" class="pb-3" href="/links"> <!-- -->👬 友链</a></li><li class="cursor-pointer text-gray-200/[.9] text-sm font-normal drop-shadow-md mr-4 h-8 transition-all duration-100 hover:text-white hover:border-b-white hover:border-b-2"><a target="_self" class="pb-3" href="/about"> <!-- -->👤 关于</a></li></ul></nav></div></div></header><div id="container-inner" class="w-full relative mx-auto max-w-[var(--content-width)]"><div id="container-wrapper" class="relative mx-auto justify-center sm:flex"><div class="w-full transition ease-in-out duration-700 transform order-first opacity-0 translate-y-32"><div id="article-wrapper" class="px-4 sm:px-8 pb-12 sm:pb-20 relative"><section class="flex flex-col mt-16"><h1 class="text-4xl font-bold text-gray-800">Longhorn 浅析</h1><div class="mt-6 mb-8 text-gray-300 flex flex-row"><span class="mr-3 text-gray-300 text-sm sm:text-base font-normal flex justify-center items-center">2024-08-08</span><span id="wordCountWrapper" class="flex gap-3 font-light"><span class="flex whitespace-nowrap items-center"><i class="pl-1 pr-2 fas fa-file-word"></i><span id="wordCount">0</span></span><span class="flex whitespace-nowrap items-center"><i class="mr-1 fas fa-clock"></i><span></span><span id="readTime">0</span> <!-- -->分钟</span></span></div></section><div id="notion-article" class="mx-auto overflow-hidden "><main class="notion light-mode notion-page notion-block-bde25ba823814da6bb5e5787ace45def"><div class="notion-viewport"></div><div class="notion-collection-page-properties"><div class="notion-collection-row"><div class="notion-collection-row-body"><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 13A6 6 0 107 1a6 6 0 000 12zM3.751 5.323A.2.2 0 013.909 5h6.182a.2.2 0 01.158.323L7.158 9.297a.2.2 0 01-.316 0L3.751 5.323z"></path></svg><div class="notion-collection-column-title-body">type</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-select"></span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 13A6 6 0 107 1a6 6 0 000 12zM3.751 5.323A.2.2 0 013.909 5h6.182a.2.2 0 01.158.323L7.158 9.297a.2.2 0 01-.316 0L3.751 5.323z"></path></svg><div class="notion-collection-column-title-body">status</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-select"></span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M10.889 5.5H3.11v1.556h7.778V5.5zm1.555-4.444h-.777V0H10.11v1.056H3.89V0H2.333v1.056h-.777c-.864 0-1.548.7-1.548 1.555L0 12.5c0 .856.692 1.5 1.556 1.5h10.888C13.3 14 14 13.356 14 12.5V2.611c0-.855-.7-1.555-1.556-1.555zm0 11.444H1.556V3.944h10.888V12.5zM8.556 8.611H3.11v1.556h5.445V8.61z"></path></svg><div class="notion-collection-column-title-body">date</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-date"></span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 4.568a.5.5 0 00-.5-.5h-6a.5.5 0 00-.5.5v1.046a.5.5 0 00.5.5h6a.5.5 0 00.5-.5V4.568zM.5 1a.5.5 0 00-.5.5v1.045a.5.5 0 00.5.5h12a.5.5 0 00.5-.5V1.5a.5.5 0 00-.5-.5H.5zM0 8.682a.5.5 0 00.5.5h11a.5.5 0 00.5-.5V7.636a.5.5 0 00-.5-.5H.5a.5.5 0 00-.5.5v1.046zm0 3.068a.5.5 0 00.5.5h9a.5.5 0 00.5-.5v-1.045a.5.5 0 00-.5-.5h-9a.5.5 0 00-.5.5v1.045z"></path></svg><div class="notion-collection-column-title-body">slug</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-text"></span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 4.568a.5.5 0 00-.5-.5h-6a.5.5 0 00-.5.5v1.046a.5.5 0 00.5.5h6a.5.5 0 00.5-.5V4.568zM.5 1a.5.5 0 00-.5.5v1.045a.5.5 0 00.5.5h12a.5.5 0 00.5-.5V1.5a.5.5 0 00-.5-.5H.5zM0 8.682a.5.5 0 00.5.5h11a.5.5 0 00.5-.5V7.636a.5.5 0 00-.5-.5H.5a.5.5 0 00-.5.5v1.046zm0 3.068a.5.5 0 00.5.5h9a.5.5 0 00.5-.5v-1.045a.5.5 0 00-.5-.5h-9a.5.5 0 00-.5.5v1.045z"></path></svg><div class="notion-collection-column-title-body">summary</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-text"></span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M4 3a1 1 0 011-1h7a1 1 0 110 2H5a1 1 0 01-1-1zm0 4a1 1 0 011-1h7a1 1 0 110 2H5a1 1 0 01-1-1zm0 4a1 1 0 011-1h7a1 1 0 110 2H5a1 1 0 01-1-1zM2 4a1 1 0 110-2 1 1 0 010 2zm0 4a1 1 0 110-2 1 1 0 010 2zm0 4a1 1 0 110-2 1 1 0 010 2z"></path></svg><div class="notion-collection-column-title-body">tags</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-multi_select"></span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 13A6 6 0 107 1a6 6 0 000 12zM3.751 5.323A.2.2 0 013.909 5h6.182a.2.2 0 01.158.323L7.158 9.297a.2.2 0 01-.316 0L3.751 5.323z"></path></svg><div class="notion-collection-column-title-body">category</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-select"></span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 4.568a.5.5 0 00-.5-.5h-6a.5.5 0 00-.5.5v1.046a.5.5 0 00.5.5h6a.5.5 0 00.5-.5V4.568zM.5 1a.5.5 0 00-.5.5v1.045a.5.5 0 00.5.5h12a.5.5 0 00.5-.5V1.5a.5.5 0 00-.5-.5H.5zM0 8.682a.5.5 0 00.5.5h11a.5.5 0 00.5-.5V7.636a.5.5 0 00-.5-.5H.5a.5.5 0 00-.5.5v1.046zm0 3.068a.5.5 0 00.5.5h9a.5.5 0 00.5-.5v-1.045a.5.5 0 00-.5-.5h-9a.5.5 0 00-.5.5v1.045z"></path></svg><div class="notion-collection-column-title-body">icon</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-text"></span></div></div><div class="notion-collection-row-property"><div class="notion-collection-column-title"><svg viewBox="0 0 14 14" class="notion-collection-column-title-icon"><path d="M7 4.568a.5.5 0 00-.5-.5h-6a.5.5 0 00-.5.5v1.046a.5.5 0 00.5.5h6a.5.5 0 00.5-.5V4.568zM.5 1a.5.5 0 00-.5.5v1.045a.5.5 0 00.5.5h12a.5.5 0 00.5-.5V1.5a.5.5 0 00-.5-.5H.5zM0 8.682a.5.5 0 00.5.5h11a.5.5 0 00.5-.5V7.636a.5.5 0 00-.5-.5H.5a.5.5 0 00-.5.5v1.046zm0 3.068a.5.5 0 00.5.5h9a.5.5 0 00.5-.5v-1.045a.5.5 0 00-.5-.5h-9a.5.5 0 00-.5.5v1.045z"></path></svg><div class="notion-collection-column-title-body">password</div></div><div class="notion-collection-row-value"><span class="notion-property notion-property-text"></span></div></div></div></div></div><div class="notion-blank notion-block-558e14006fe1422cbf7fc8b2f8deb43c"> </div><div class="notion-text notion-block-a27b268070864f4cbd2715352ef1ce82">Longhorn 是一个 Go 实现的 Cloud Native Storage，比较好奇作为一个提供块存储的分布式存储系统，使用 Go 实现，会面临哪些挑战，性能方面要又要如何优化</div><div class="notion-blank notion-block-301a3fb6101147f18b36213676033414"> </div><div class="notion-text notion-block-c05865d57daa4abb98d93927c381a6e5">从宏观视角来看，Longhorn 的数据流如下， Engine 是 volume 的 controller，每个 volume 都会有一个 engine 实例，replica 是卷的一个副本实例，负责具体的落盘，显然 Engine 就是数据面的核心</div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-f09b7b63717c43f58e2d00daafae5408"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F74bdb399-f643-4c60-af08-0435670cf958%2FUntitled.png%3FspaceId%3D4cc04375-345a-4a1e-bdf0-3a7c88ef0425?table=block&amp;id=f09b7b63-717c-43f5-8e2d-00daafae5408&amp;t=f09b7b63-717c-43f5-8e2d-00daafae5408&amp;width=1415.984375&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><div class="notion-text notion-block-2ac29b2fe2b04d3cb6887163a7b9475c">Longhorn 是控制面则是基于 K8s 的，所有资源都以 K8s CRD 提供，通过 Operator 管控，称为 Manager</div><div class="notion-blank notion-block-8b5b62ca50dd42c8bb35c986c2eeefa1"> </div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-7bba19424d114d388f9393df77e91948" data-id="7bba19424d114d388f9393df77e91948"><span><div id="7bba19424d114d388f9393df77e91948" class="notion-header-anchor"></div><a class="notion-hash-link" href="#7bba19424d114d388f9393df77e91948" title="V1 Engine"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">V1 Engine</span></span></h2><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-b7063a8fa46a434181a452d52e494be3" data-id="b7063a8fa46a434181a452d52e494be3"><span><div id="b7063a8fa46a434181a452d52e494be3" class="notion-header-anchor"></div><a class="notion-hash-link" href="#b7063a8fa46a434181a452d52e494be3" title="Replica"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">Replica</span></span></h3><div class="notion-text notion-block-ac953debb2294ea4955a3907f2d4c26e">Engine 有 V1 和 V2 两个版本，先从 V1 Engine 开始分析，自底向上看，最下面的是 replica。replica server 在启动时就会创建/打开对应的 replica，然后启动两个 grpc server，分别处理控制流和数据流</div><div class="notion-blank notion-block-948f2c7c876444488997463e10737272"> </div><div class="notion-text notion-block-dea92143e9cc4454ac8a47e67e6deff5">replica 在节点上对应一组 sparse file，代码中这个结构称为 <code class="notion-inline-code">diffDisk</code>，每个 file 有点类似于 LSM-Tree 中的 layer/level，这里称为 snapshot（除了最新一层叫 head/live data）：</div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-c0ea8054fb6646609340c9e8e46a1185"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:576px;max-width:100%;flex-direction:column"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F09606cc3-8f19-4e2f-9a02-c9c0ace747f9%2FUntitled.png%3FspaceId%3D4cc04375-345a-4a1e-bdf0-3a7c88ef0425?table=block&amp;id=c0ea8054-fb66-4660-9340-c9e8e46a1185&amp;t=c0ea8054-fb66-4660-9340-c9e8e46a1185&amp;width=1152&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><div class="notion-text notion-block-84d974d484744992909a067236352d38">每个 <code class="notion-inline-code">diffDisk</code> 的元数据存在一个 <code class="notion-inline-code">volume.meta</code> 文件中，还会有一个 <code class="notion-inline-code">revision.counter</code> 文件记录写入的版本号。每一层 file 划分为多个 4K 大小的 sector，这是写入的最小单元，因为都是 sparse file，所以 Longhorn 的卷自然支持精简配置。file 之间从新到旧连接起来，索引表 <code class="notion-inline-code">location</code> 则存储 sector 位于哪一个 file 中</div><div class="notion-blank notion-block-01378c9a591b4f45943571fe10dd271f"> </div><div class="notion-text notion-block-fa074d7b3d934f53a68dd46949b39809">读写流程</div><ul class="notion-list notion-list-disc notion-block-e667a8553d764888b6c0c4180da37b75"><li>写入时先自增 revision，元数据中标为为 dirty，这里 revision 会落盘，但元数据不会。然后在 <code class="notion-inline-code">diffDisk</code> 只会写入最新的一层，即 live data 或 head，是原地写入的，同时更新索引。前面提到 sector 是写入最小单元，如果写入不够一个 sector，就会先读出原数据，修改后再写</li></ul><ul class="notion-list notion-list-disc notion-block-b43e47110e5a4c76ab01abd21773aa37"><li>读取时从索引中找到 sector 对应第几层的 file，如果找到就直接去读。否则从新到旧的 file 查找，对于每一个 file 使用 FIEMAP ioctl 查询指定范围内是否存在 extent，是则说明 sector 位于这个 file 中，更新索引后读取</li></ul><div class="notion-blank notion-block-d00ff36106d24fc2aec64382971c546f"> </div><div class="notion-text notion-block-3477863df7d647a29e30c35ff77d444a">快照&amp;扩容流程</div><ul class="notion-list notion-list-disc notion-block-31eec8634d574064839f5d742db75ef3"><li>快照：快照很简单，只是创建一个新的 head。删除就是将其内容覆盖到上一层 snapshot 中</li></ul><ul class="notion-list notion-list-disc notion-block-6761eac08c074bf6ac15bb5702cabd8a"><li>扩容：创建一个新的 head，相当于打了个快照，head 的大小被 truncate 为扩容后的大小，同时还需要修改元数据。由于 sector 变多了，<code class="notion-inline-code">diffDisk</code> 内的 <code class="notion-inline-code">location</code> 索引表也要扩容</li></ul><div class="notion-blank notion-block-e209bbbcc5a54a7ca6cb3196ca30f373"> </div><div class="notion-text notion-block-5561d5c90b2b4db6a6edf1b47e382aa1">一开始还以为 <code class="notion-inline-code">diffDisk</code> 会是类似 RocksDB 这种 LSM-Tree based 的存储引擎，但完全不是一回事。它没有存储引擎必须的各种功能，可以说只是一个能支持 snapshot 的数据格式</div><div class="notion-text notion-block-f9d9524df630451ba766cb16c3c63f75">首先接口语义上，<code class="notion-inline-code">diffDisk</code> 是为块存储设计的，并不是 key-value 的，或者说 key 就是 offset；也没有删除接口，只有读和写。不过这也问题不大，块存储本身也没有“删除”的概念，真要添加删除接口也可以通过写入墓碑标记实现</div><div class="notion-text notion-block-071e3692288c43178c67a3910049b00d"><code class="notion-inline-code">diffDisk</code> 中单个文件的数据布局和元数据维护是依赖文件系统的 extent 功能实现的，没有定义自己的格式。所以这套实现对文件系统有要求，需要支持 extent 功能，优点是文件很“干净“，这里如果没有 snapshot，实际上就是对单个文件的直接读写。但反之可以说没有任何优化，性能需要打个问号</div><div class="notion-text notion-block-d7a2c34e356e42d0a6983d2151404de8">同时它没有 WAL，无法保证崩溃一致性。这种情况需要 rebuild，更不用提快照（revision）读和事务之类的功能了。rebuild 这些操作都依赖上层控制面触发，后续会提到</div><div class="notion-blank notion-block-80f037a748eb4cdead71a0cad980a13e"> </div><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-68047b47005d4e7f8dc2ec22c348a0ce" data-id="68047b47005d4e7f8dc2ec22c348a0ce"><span><div id="68047b47005d4e7f8dc2ec22c348a0ce" class="notion-header-anchor"></div><a class="notion-hash-link" href="#68047b47005d4e7f8dc2ec22c348a0ce" title="Controller"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">Controller</span></span></h3><div class="notion-text notion-block-5b30fff5ac8547668a0e4cc9e4e63060">Controller 负责整个 volume 视角的读写，它被调度在和最终 client 的 Pod 相同的节点上，从 frontend 中接受读写请求，往后连接到一个或多个 replica 上，将读写转发给这些 replica</div><div class="notion-text notion-block-b740d7c8ba6b4d0dbf4500769d6b8fa1">为了避免和 K8s 中的 Controller 混淆，后面都直接称这个 Controller 为 Engine</div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-6080c1ce0625443ba0dcfc07904694e3"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:528px;max-width:100%;flex-direction:column"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Fd7d422a8-aa34-4ff3-b059-b898eb14bf56%2FUntitled.png%3FspaceId%3D4cc04375-345a-4a1e-bdf0-3a7c88ef0425?table=block&amp;id=6080c1ce-0625-443b-a0dc-fc07904694e3&amp;t=6080c1ce-0625-443b-a0dc-fc07904694e3&amp;width=1056&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><div class="notion-blank notion-block-b15c19b27cf1414e87710ef828778f27"> </div><div class="notion-text notion-block-845f783b6e76486380cba501c2ab288e">Engine 启动时会监听一个 UDS（<code class="notion-inline-code">/var/run/longhorn-{volume-name}.sock</code>），同时创建 frontend，frontend 实际上就是一个 iSCSI Target，通过<a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://github.com/rancher/tgt">定制的 tgtd</a> 创建，这个定制 tgtd 做的工作不多，主要是能支持将 iSCSI 流量包装成 Longhorn 自己的一个简单协议转发到前面的 UDS 中</div><div class="notion-text notion-block-bfb2ab66dca24e3e963f0d9cdbe5db92">协议结构如下：</div><pre class="notion-code"><div class="notion-code-copy"><div class="notion-code-copy-button"><svg fill="currentColor" viewBox="0 0 16 16" width="1em" version="1.1"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg></div></div><code class="language-go">type Message struct {
	MagicVersion uint16
	Seq          uint32
	Type         uint32
	Offset       int64
	Size         uint32
	Data         []byte
}

const (
	TypeRead = iota
	TypeWrite
	TypeResponse
	TypeError
	TypeEOF
	TypeClose
	TypePing
	TypeUnmap
)

const (
	MagicVersion = uint16(0x1b01) // LongHorn01
)</code></pre><div class="notion-text notion-block-f58864b6b95c4ceb8dd8d8f6fea37fe8">有了 iSCSI Target 后，还需要启动 iSCSI Initator 连接这个 Target，这步的目的是需要创建出一个块设备，然后通过 mknod 指定相同的主次设备号再创建出 <code class="notion-inline-code">/dev/longhorn/{vol_name}</code>。这就是 client 最终直接操作的设备，对它的 I/O 会一路到 Initator → Target → UDS 上。到此 frontend 就算创建完成</div><div class="notion-blank notion-block-ec72c51e348449f69c3cafe735b4ec2c"> </div><div class="notion-text notion-block-8a914f1feca04c7eac4cfd909ab9f4b3">Engine 之后为 volume 的每一个 replica 创建对应的 backend(replicator)，并维持心跳。会从前面监听的 UDS 中解析协议并转发给 replica</div><div class="notion-text notion-block-f08581e62d684580b7892a44743bc72e">具体读写上 Engine 通过一个读写锁控制并发，read 只要任一一个 replica 成功即可，用的 round-robin 的策略做 balance。write 和 unmap 等操作是并发执行的，要求全部成功。IOPS 之类的监控和统计也在这个层级实现</div><div class="notion-text notion-block-2cb0b40891c0483aa64ef60bdccf5026">最后 Engine 会再启动一个 grpc server，处理控制流，例如卷扩容、快照等命令，也是通过 backend(replicator) 转发到 replica 上执行的。当然，这里调用的是处理控制流的 grpc server</div><div class="notion-blank notion-block-88d58d5b4d6f4a50b3ec76d208033133"> </div><div class="notion-text notion-block-dfa25c88d5f3451797c360a81e00e59a">这里有一个优化，如果 volume 只有一个 replica（单副本）且设置了 struct local 模式。Manager 会将 replica 调度到和 Engine 同一个节点上。Engine 在创建 backend 时就会通过 UDS 连接而不是 TCP 连接。这种本地化的策略能够有效提升 IOPS 和改善延迟，不过这里约束了只能用单副本，限制比较大</div><div class="notion-text notion-block-d1435b2bc5a744348d3615e683aebc70">虽然 Engine 自身是单点，但是它运行在和 client 相同的节点上，因此如果节点故障，一般 client 也会同时不可用，是个不错的策略</div><div class="notion-blank notion-block-9d5c6878fd1743ffbc06d9bf48d7ae83"> </div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-1f5cc8783c964b378a81a49efab11384" data-id="1f5cc8783c964b378a81a49efab11384"><span><div id="1f5cc8783c964b378a81a49efab11384" class="notion-header-anchor"></div><a class="notion-hash-link" href="#1f5cc8783c964b378a81a49efab11384" title="Manager"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">Manager</span></span></h2><div class="notion-text notion-block-a6622edd4b28456a82631d11a44b11d6">一开始提到，Longhorn 的控制面是作为 K8s Operator 实现的，称为 Manager。Longhorn 里所有元数据，包括 Engine 和 Replica 都以 CRD 呈现。</div><div class="notion-text notion-block-493cb66e845a4ecd852d50700e1ee1ac">这套方案的优点是很多东西都能依赖 K8s 的能力提供和管理，还能很好地融入生态。但同样很多元数据操作的链路都要通过 K8s，感觉还是会比较慢，也限制了规模和能力</div><div class="notion-blank notion-block-7ec3e975990b45568d8190e2e4baaba9"> </div><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-5302560a92db4fe1828ee3481a827c60" data-id="5302560a92db4fe1828ee3481a827c60"><span><div id="5302560a92db4fe1828ee3481a827c60" class="notion-header-anchor"></div><a class="notion-hash-link" href="#5302560a92db4fe1828ee3481a827c60" title="rebuild &amp; add replica"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">rebuild &amp; add replica</span></span></h3><div class="notion-text notion-block-fbd6f38ab64f4cc097720f73a67f3d07">如果 Engine 到某个 replica 心跳失败或读写或控制流命令错误，或发现 replica 的 revision 不是最新的，这个 replica 的 mode 就被设置为 ERR 不再读写</div><div class="notion-text notion-block-12a5cdc8ab434bb8b1f686b36052524b">Manager 中的 monitor 会定时请求 Engine 中处理控制流的 grpc server 获取其所有的 replica 信息，更新到 Engine CR 的 status 中。因此当在 Manager 中的 Engine Controller 对该 Engin CR 进行 reconcile 时就能检测到 replica 处于 ERR mode 或不存在，调用 Engine 触发 rebuild</div><div class="notion-blank notion-block-a729190e0c854c5dafebd900206f656c"> </div><div class="notion-text notion-block-a55f5c5f9ae54823bde01f309bb0d7d0">V1 Engine 的 rebuild 最终执行了 AddReplica Task，所以 rebuild 实际上流程和新增 replica 一致</div><ul class="notion-list notion-list-disc notion-block-5385dda74bc54d37a1fddff3b825b70e"><li>Engine 在创建新 replica 之前，会先对其他 replica 打一个快照，然后创建一个 WO（仅写入）模式的新 replica，因此它马上就可以接收写入</li></ul><ul class="notion-list notion-list-disc notion-block-badafa3bb61f439bb6af239a9545bd51"><li>然后从已有的 replica 中将 <code class="notion-inline-code">diffDisk</code> 的元数据和剩下 snapshot 给 sync 过去。在 sync 完成后，通知 Engine 重新检验合法性，此时 replica 正式可用，设置回 RW 模式，启动对新 replica 的心跳</li></ul><div class="notion-text notion-block-895459d5394d4433857a0b297e72f044">这里在打完快照后，新 replica 的写入就全都在 head/live data 上了，写入是安全的。snapshot 的 sync 在后台异步进行，利用了 <code class="notion-inline-code">diffDisk</code> 的特性和快照实现了在线 rebuild</div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-aa4a49657412479ab0459d4061d971fe"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:528px;max-width:100%;flex-direction:column"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F4984c535-3b59-4ae9-b363-c56f764adf27%2FUntitled.png%3FspaceId%3D4cc04375-345a-4a1e-bdf0-3a7c88ef0425?table=block&amp;id=aa4a4965-7412-479a-b045-9d4061d971fe&amp;t=aa4a4965-7412-479a-b045-9d4061d971fe&amp;width=1056&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><div class="notion-blank notion-block-e6a2ecb92ae64051801d13b4a3aa0ffc"> </div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-f492b362aba24373bcfd1865eeda3ea6" data-id="f492b362aba24373bcfd1865eeda3ea6"><span><div id="f492b362aba24373bcfd1865eeda3ea6" class="notion-header-anchor"></div><a class="notion-hash-link" href="#f492b362aba24373bcfd1865eeda3ea6" title="File storage"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">File storage</span></span></h2><div class="notion-text notion-block-688603097b4a488a8c2c74cabaa7cfad">Longhorn 提供的 CSI 不支持 Block PVC 的 RWX 挂载，因为块层无法感知更高层（文件系统）的写入模式和内容，多个 client 写入就会把挂载的文件系统元数据写坏。为了支持 RWX 的 PVC，Longhorn 额外通过 Share Manager 组件提供了文件存储。这里有意思的是，它不叫 Filesystem Manager 而是叫 Share Manager，可以看出是完全以 K8s 视角考虑的</div><div class="notion-blank notion-block-fe2898a8b32542b0b198071835532d84"> </div><div class="notion-text notion-block-216da7e2fe814906b1222f304a5dfca4">当创建 RWX 的 volume （Longhorn 的 CR，非 PVC）时，Manager 中 volume controller 会创建对应的 share manager CR。share manager controller 再创建 share manager pod 并修改 volume 让其实际挂载在这个 share manager pod 的节点上</div><div class="notion-text notion-block-157938c8dd74469496dd340cfd82336e">controller 检测到 pod 启动之后，就会给其发起 RPC 请求将 <code class="notion-inline-code">/dev/longhorn/{vol_name}</code> 块设备格式化为指定文件系统挂载到 <code class="notion-inline-code">/export/{vol_name}</code> 中</div><div class="notion-text notion-block-5124f1f3028f4cc9a6a07ab9f3274d8e">share manager 内运行了一个 nfs ganesha，作为 NFS server。最后 share manager 更新 nfs ganesha 配置，将 <code class="notion-inline-code">/export/{vol_name}</code> 导出</div><div class="notion-text notion-block-8855c8717ddb4bbc9a853acae891457c">share manager 和 volume 的 status 在 controller reconcile 中被更新，设置 NFS 连接信息，现在 CSI 就可以获取到 NFS 连接配置，完成最终的用户 Pod 挂载流程</div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-30cca0e43eeb464483e6a121dc1ec3a0"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:624px;max-width:100%;flex-direction:column"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F634f0ba3-651c-4cb3-ade9-b46c64d446bb%2FUntitled.png%3FspaceId%3D4cc04375-345a-4a1e-bdf0-3a7c88ef0425?table=block&amp;id=30cca0e4-3eeb-4644-83e6-a121dc1ec3a0&amp;t=30cca0e4-3eeb-4644-83e6-a121dc1ec3a0&amp;width=1248&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><div class="notion-blank notion-block-1cef134c94214c29ac92dbc7771ddd4f"> </div><div class="notion-text notion-block-eb6f16d4ea0d4932b61ca1c85055695c">这里 NFS server 是一个单点的 gateway。为了故障恢复，Longhorn 修改 nfs ganesha 添加了一个新的 recovery backend 类型 longhorn，这个定制的 recovery backend 的作用是将 nfs ganesha 的内部状态信息存储到 K8s ConfigMap 中</div><div class="notion-text notion-block-ca9b37503b20433a85b5877a4f3e51ad">当发生故障，新的 share manager pod 被创建出来后，nfs ganesha 就能从 ConfigMap 中恢复状态，nfs client 可以配置一定宽限期，此时再重试请求就能成功，恢复运行</div><div class="notion-blank notion-block-b5e2e343a9a746b7a31bb5fa4b7a04ec"> </div><div class="notion-text notion-block-d376ba71b271424d8060d08d2e53d349">实际上 NFS server 可以配置 active/active（多活）和 active/passive（主备） 模式。这样恢复速度能比等待重建快得多，可以做到高可用，但目前看起来在这套架构上并不好实现</div><div class="notion-text notion-block-27e019a04b364049bf72944745e9ac6c">首先这里 NFS server 本身就是跑在 iSCSI 块设备上的，无法处理多 client 写入，这就回到一开始的情况了，因此无法做到 active/active。而 Engine 则限制了必须和 Pod 在同一节点上，目前不支持存在一个备用的 Engine 连接同样的 Replica，自然也无法做到 active/passive</div><div class="notion-blank notion-block-8dc4380a3dbf41d09ceab0af03074b40"> </div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-c02bf5693f054580b098f52d09297f11" data-id="c02bf5693f054580b098f52d09297f11"><span><div id="c02bf5693f054580b098f52d09297f11" class="notion-header-anchor"></div><a class="notion-hash-link" href="#c02bf5693f054580b098f52d09297f11" title="V2 Engine"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">V2 Engine</span></span></h2><div class="notion-text notion-block-0abfa26040794ca88d4602c04448568c">V2 Engine 使用了 SPDK，基本是复用了 SPDK 自带的功能，Go 只是调用来创建，不会再直接处理 I/O，性能应该能得到很大提高。V2 Engine 目前还是 preview feature，一些功能支持的不完善，例如扩容</div><div class="notion-blank notion-block-e8b93937f7b8427ab87bf8c4800bcd91"> </div><div class="notion-text notion-block-6b50d50962704f2e958767eb032c21d6">在 V2 Engine 上，总体设计也类似于 V1 Engine，Engine 连接多个 Replica。Replica 就是一个 SPDK 的 lvol bdev（逻辑卷），还包括一个 NVMf Target 将 bdev 暴露出去。剩下的例如精简配置、快照等功能都是 SPDK 自身已经支持的，直接通过 JSON-RPC 调用即可</div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-44824160de3d43d5a6c9915fdffdaf24"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Facdac30c-0f7c-4d5d-a678-43c4dfb4897b%2FUntitled.png%3FspaceId%3D4cc04375-345a-4a1e-bdf0-3a7c88ef0425?table=block&amp;id=44824160-de3d-43d5-a6c9-915fdffdaf24&amp;t=44824160-de3d-43d5-a6c9-915fdffdaf24&amp;width=1440&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><div class="notion-text notion-block-dfc590a4a8c84edd898232d3a8e5c77b">Replica 已经暴露了 NVMf bdev，Engine 同样通过 SPDK 连接到每个 Replica 的 NVMf bdev，再组成 RAID1 bdev，这样又利用了 SPDK 直接实现了多副本，最后暴露出 NVMf Target 给 client 连接</div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-6e079fd554fa4c0f8fd99c090bea781e"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:528px;max-width:100%;flex-direction:column"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Fdcf8bbf2-409a-4d6c-bff0-bf9dc67fdcc1%2FUntitled.png%3FspaceId%3D4cc04375-345a-4a1e-bdf0-3a7c88ef0425?table=block&amp;id=6e079fd5-54fa-4c0f-8fd9-9c090bea781e&amp;t=6e079fd5-54fa-4c0f-8fd9-9c090bea781e&amp;width=1056&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><div class="notion-blank notion-block-fb0a3e9fce5c4c3aaf83b31a9fe55903"> </div><div class="notion-text notion-block-f4b352ddcaba43ae9a316b09879a3ab0">由于并不插手 I/O 流程，这里的容错处理稍微被动些。健康检查不再是心跳，而是定期（3s）获取 replica 上的 SPDK bdev 列表，在这个过程中更新一些统计数据。当 bdev 不存在或信息不一致时，就会设置为 ERR mode 让其 rebuild</div><div class="notion-text notion-block-8800227d91f7445580535c8e5cceb673">V2 Engine 中 rebuild 和 add replica 流程和 V1 Engine 大体类似：</div><ol start="1" class="notion-list notion-list-numbered notion-block-2dbe78ddc4294bc69720ca89ee62ecf0"><li>首先打快照，然后让新的 replica 直接通过 NVMf 连接源 replica 的 bdev，作为 external snapshot 创建新的 lvol bdev</li></ol><ol start="2" class="notion-list notion-list-numbered notion-block-51eb40a690404a438505b0b2ab13876d"><li>回到 V2 Engine，现在新 replica 的 lvol bdev 已经存在了，可以连接并添加到 RAID1 bdev 中。虽然这时也给新 replica 设置了 WO mode，但 Engine 已经不在 I/O 流程中了 管不着，SPDK 仍然可能从新的 bdev 中读，SPDK 能正确处理，但会有一定性能下降</li></ol><ol start="3" class="notion-list notion-list-numbered notion-block-42b416728d6e4431aa2caf3e688887fd"><li>虽然新 replica 的 bdev 中已经有了完整数据（RAID1 bdev 会自动处理），但它上面并没有源 replica 上那些历史快照链，还需要一个恢复快照链的过程。这里会再创建一个新的 rebuilding lvol，使用 shallow copy 将源 replica 的快照一层层 copy 过去，每 copy 完一层就给 rebuilding lvol 打一次快照。这样从头给 rebuilding lvol 构建历史快照链</li></ol><ol start="4" class="notion-list notion-list-numbered notion-block-f43a75e3a93649ef96504ce452c81e7c"><li>最后再将第 1 步中的新 lvol 的 parent 从 external snapshot 改为 rebuilding lvol</li></ol><div class="notion-blank notion-block-912714e5daaa4647b3b17413e3f0da44"> </div><div class="notion-text notion-block-d32b007e23384eb7858b3d37620a8c83">V2 Engine 的模式让我想起了 Kafka，Kafka 虽然是 Java 实现，但实际上 Java 本身没有做太多 key path 上的数据处理，而是 offload 到 kernel 去做，避免了 Java 的性能劣势。从这个角度来说，Kafka 的数据面更像一个细粒度的对 kernel 的控制面。Longhorn 的 V2 Engine 也是如此，基本就是对 SPDK 的控制面</div><div class="notion-blank notion-block-39530a36f3764bb18113d7206968fa8d"> </div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-87890865c79542519af29a263964d1bb" data-id="87890865c79542519af29a263964d1bb"><span><div id="87890865c79542519af29a263964d1bb" class="notion-header-anchor"></div><a class="notion-hash-link" href="#87890865c79542519af29a263964d1bb" title="Performance"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">Performance</span></span></h2><div class="notion-text notion-block-9207b00ddbac48199deaf25292352e0d">看一下性能，benchmark 可以看到，V1 Engine 的性能比较差，也在预期之内。不过这里测试用的 SSD 比较一般，完全没发挥出 SPDK 的性能，但到了那种程度网络也是瓶颈了，Longhorn 目前还不支持 RDMA</div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-7c84041259194a47bf3b2417b4e8b9a8"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F79cf5471-dca4-4a90-a6ee-9ec25beb9771%2FUntitled.png%3FspaceId%3D4cc04375-345a-4a1e-bdf0-3a7c88ef0425?table=block&amp;id=7c840412-5919-4a47-bf3b-2417b4e8b9a8&amp;t=7c840412-5919-4a47-bf3b-2417b4e8b9a8&amp;width=1416&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><div class="notion-blank notion-block-9374f8ca0db046d68a44bd8f825d731e"> </div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-7c1c4ce94e1943d786b56207c665bbf9"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F22ca52d1-17b5-4860-aa1b-4da95b25cc58%2FUntitled.png%3FspaceId%3D4cc04375-345a-4a1e-bdf0-3a7c88ef0425?table=block&amp;id=7c1c4ce9-4e19-43d7-86b5-6207c665bbf9&amp;t=7c1c4ce9-4e19-43d7-86b5-6207c665bbf9&amp;width=1415.984375&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-0ecfb0baa0474a58ac8155cb200e0303"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Fe9c48585-311b-4ce5-a5c7-3c73dabcbc57%2FUntitled.png%3FspaceId%3D4cc04375-345a-4a1e-bdf0-3a7c88ef0425?table=block&amp;id=0ecfb0ba-a047-4a58-ac81-55cb200e0303&amp;t=0ecfb0ba-a047-4a58-ac81-55cb200e0303&amp;width=1415.984375&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><div class="notion-blank notion-block-3061abd76d2b46b6b730aa48e3f77b10"> </div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-686b62651ca14dfbb625582ee5e0884a" data-id="686b62651ca14dfbb625582ee5e0884a"><span><div id="686b62651ca14dfbb625582ee5e0884a" class="notion-header-anchor"></div><a class="notion-hash-link" href="#686b62651ca14dfbb625582ee5e0884a" title="Summary"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">Summary</span></span></h2><div class="notion-text notion-block-5f3918d4e456458aa4f31d9cae3ccefb">总的来说，Longhorn 架构简洁，基于简单朴素的想法构建，又很好地复用了已有的成熟组件，无论是基于 K8s 的控制面，还是 V1 Engine 中的 sparse file，tgtd，nfs ganesha，V2 Engine 的 SPDK，都是这种想法的体现。使用起来也很友好</div><div class="notion-text notion-block-6d3d53a8874b4d2a8fa421e088da8416">缺点是一旦有舒适区内无法满足的需求，就会比较麻烦。例如现在已经修改了 tgtd 和 nfs ganesha，但这种零碎的修改又很难维护，特别是 SPDK 不是简单包装一下就可以产品化的，这在未来可能会是一个挑战。另外，存算融合也可能会导致负载互相影响，进一步降低性能，控制面的调度收敛速度估计也受限于 K8s，万卷规模时各种 CR 可能就数十万个了，而 etcd 还是单 Raft Group 的，瓶颈明显</div><div class="notion-blank notion-block-9d6ff8c0b08d4ba59e8710d7409735b8"> </div><div class="notion-text notion-block-9ab0b35f84744bdaab456c0090f7e85a">后续可以考虑的优化点不少，首先存储层就不支持 chunk/block 之类的 partition，这直接限制了单个卷能提供的容量，而且没有细粒度的 partition，容错和调度都会不够灵活。现在 rebuild 都是全量的，不仅影响速度，在大卷时这样的流量对集群也有压力。最后是一些业务功能，例如 QoS 等比较刚需的还不支持</div><div class="notion-text notion-block-0c280a677c334976a0cf4f6c5163704c">Longhorn 的性能、扩展性和容错可以说都是很差的，但却仍然有着不少的应用，这不禁让我想起同事说过的一句话：「大部分客户和场景根本不在乎性能，只关注成本、易用性和稳定性」</div><div class="notion-text notion-block-c393f09a44db483dbcb2644c4df77ce0">值得一提的是 Longhorn 的文档写的很不错，大部分 feature 都有详细提案文档和需求来源追溯，这点非常好，还是很适合作为入门学习的分布式存储项目</div><div class="notion-blank notion-block-c069cf00c15644edab96a083efce6fd1"> </div><div class="notion-blank notion-block-2140495bb7044178900ada12d68daed7"> </div><div class="notion-text notion-block-c09c9fd4e8e94e6484bf861b297ba597">Ref：</div><ul class="notion-list notion-list-disc notion-block-1bed0ccdd9574d18aab844bde9182313"><li><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://longhorn.io/docs/1.6.2/concepts/">Longhorn | Architecture and Concepts</a></li></ul><ul class="notion-list notion-list-disc notion-block-98e5ad318f3b4a14aa61430ea78f5412"><li><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://github.com/longhorn/longhorn/wiki/Architecture-Overview-For-Developers">Architecture Overview For Developers</a></li></ul><ul class="notion-list notion-list-disc notion-block-dadebf59a65e4de4b0872c5d075b1ab5"><li><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://peteryj.github.io/2020/10/11/longhorn-engine-code-analysis/">longhorn-engine 源码分析 - Peter Yang&#x27;s Blog</a></li></ul><ul class="notion-list notion-list-disc notion-block-56a447e1bf3b457bb5ca22cd6ffade12"><li><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://github.com/longhorn/longhorn/blob/master/enhancements/20221123-local-volume.md">20221123-local-volume.md</a></li></ul><ul class="notion-list notion-list-disc notion-block-f68dbe3d33014bff8b823140ef4fa3e6"><li><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://mp.weixin.qq.com/s/9eFYJ5OFRrShaKJezxV6Bg">Longhorn 的正确使用姿势：如何处理增量 replica 与其中的 snapshot/backup</a></li></ul><ul class="notion-list notion-list-disc notion-block-83198b20b262454698b62893f220808e"><li><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://longhorn.io/docs/1.6.2/nodes-and-volumes/volumes/rwx-volumes/">Longhorn | ReadWriteMany (RWX) Volume</a></li></ul><ul class="notion-list notion-list-disc notion-block-e775ef1a31f542a49a95cef860c10fe3"><li><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://github.com/longhorn/longhorn/blob/master/enhancements/20201220-rwx-volume-support.md">20201220-rwx-volume-support.md</a></li></ul><ul class="notion-list notion-list-disc notion-block-04a72dc6b4cd42a9b6797b9ed1c9727a"><li><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://github.com/longhorn/longhorn/blob/d5e8a44104f5e03c310870b47da7c8ab55f671b3/enhancements/20220727-dedicated-recovery-backend-for-rwx-volume-nfs-server.md">20220727-dedicated-recovery-backend-for-rwx-volume-nfs-server.md</a></li></ul><ul class="notion-list notion-list-disc notion-block-e1d05407c2084f5c9af01c1621143b4d"><li><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://github.com/longhorn/longhorn/blob/master/enhancements/20230619-spdk-engine.md">20230619-spdk-engine.md</a></li></ul><ul class="notion-list notion-list-disc notion-block-cd732eaa43e74483a122e424226f982d"><li><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://spdk.io/doc/logical_volumes.html">SPDK: Logical Volumes</a></li></ul><ul class="notion-list notion-list-disc notion-block-e17fae7a31b64bbdb3255589cf7abcd3"><li><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://spdk.io/doc/nvmf.html">SPDK: NVMe over Fabrics Target</a></li></ul><ul class="notion-list notion-list-disc notion-block-5f63c08e8e7c4c32ab83ecb2a9a3c6e1"><li><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://spdk.io/doc/bdev.html">SPDK: Block Device User Guide</a></li></ul><ul class="notion-list notion-list-disc notion-block-cf49f8d438da47319a0ae82178d7bf33"><li><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://github.com/longhorn/longhorn/issues/7199">v2 volume replica online rebuilding</a></li></ul><ul class="notion-list notion-list-disc notion-block-e45463e94b21457484b3b20328c00b1e"><li><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://github.com/longhorn/longhorn/blob/b58a7a3849e12fa4674723c1ce0dfe708fd8423a/enhancements/20231030-spdk-raid-delta-copy.md">20231030-spdk-raid-delta-copy.md</a></li></ul><ul class="notion-list notion-list-disc notion-block-22612c4b1c3b468ba2c8af7dacb56a95"><li><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://longhorn.io/docs/1.6.2/v2-data-engine/performance/">Longhorn | Performance</a></li></ul><div class="notion-blank notion-block-5df8b1160c774e2daf6a52a44b086766"> </div></main></div><div class="flex flex-row gap-2"><a class="rounded-full px-4 py-1 bg-gray-100/[.3] text-gray-400 text-xs sm:text-sm font-normal leading-6 cursor-pointer transition-all duration-300 hover:bg-[var(--theme-color)] hover:text-white hover:-translate-y-1" href="/tag/%E5%AD%98%E5%82%A8">存储</a><a class="rounded-full px-4 py-1 bg-gray-100/[.3] text-gray-400 text-xs sm:text-sm font-normal leading-6 cursor-pointer transition-all duration-300 hover:bg-[var(--theme-color)] hover:text-white hover:-translate-y-1" href="/tag/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F">分布式系统</a></div><div class="mt-8 mb-6 w-full border-b border-dashed border-gray-200"></div><p class="text-base mb-3 font-normal text-gray-300">下一篇</p><a href="/post/kernel-rwlock"><h2 class="mb-2 sm:mb-4 text-gray-800 text-2xl font-bold relative transition-all duration-300 before:invisible before:h-5 before:w-0 before:bg-[var(--theme-color)] before:opacity-5 before:absolute before:top-4 before:-left-2 before:rounded-lg before:transition-all before:duration-500 hover:before:visible hover:before:w-full hover:text-[var(--theme-color)] hover:drop-shadow(0_1px_2px_rgb(255,255,255)">从 Linux 内核看读写锁设计</h2></a><div class="mt-6 mb-8 w-full border-b border-dashed border-gray-200"></div><div id="comment" class="comment mt-5 text-gray-800 dark:text-gray-300 "><div class="text-center">Loading...<i class="fas fa-spinner animate-spin text-3xl "></i></div></div><aside class="hidden lg:block absolute h-full w-52 -right-56 top-36"><div class="sticky top-20"></div></aside></div></div></div></div><footer class="w-full border-t border-gray-200/[.8] relative mt-72 md:mt-60 before:w-full before:h-[22rem] before:z-10 before:block before:absolute before:-top-[17.6rem] before:left-0 before:bg-[url(/images/footer-bg.png)] before:bg-no-repeat before:bg-center before:bg-cover lg:before:bg-contain "><div class="max-w-[var(--content-width)] mx-auto my-12"><p class="mx-6 text-left text-xs text-gray-500 font-bold relative z-20">© <!-- -->2018-2025<!-- --> <!-- -->xxxuuu<!-- --> · Powered by <a class="hover:underline text-gray-700" href="https://github.com/xxxuuu/NotionNext">NotionNext</a></p></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"NOTION_CONFIG":{"LINK":"https://xxxuuu.me","THEME":"autumn","KEYWORDS":"分布式系统,存储,云原生","AUTHOR":"xxxuuu","BIO":"xxxuuu","CUSTOM_MENU":"true","CUSTOM_RIGHT_CLICK_CONTEXT_MENU":"false","LANG":"zh-CN","SINCE":"2018","POST_TITLE_ICON":"false"},"notice":null,"siteInfo":{"title":"x³u³","description":"🗒 碎碎念","pageCover":"https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Fa9af1d6b-f284-4734-ba06-990353cf3f84%2FElaina.jpg?table=collection\u0026id=0bb2e606-8d0c-4f7c-aca9-70986e90c055\u0026t=0bb2e606-8d0c-4f7c-aca9-70986e90c055\u0026width=800\u0026cache=v2","icon":"https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F49b4570c-b2f0-457b-81b7-b68e2693a471%2Favatar.png?table=collection\u0026id=0bb2e606-8d0c-4f7c-aca9-70986e90c055\u0026t=0bb2e606-8d0c-4f7c-aca9-70986e90c055\u0026width=800\u0026cache=v2","link":"https://xxxuuu.me"},"allNavPages":[{"title":"Summer Pockets 圣地巡礼记","pageCoverThumbnail":"https://www.notion.so/image/attachment%3Ab7e99627-78b8-440b-ab94-290679fd56a8%3Atoudai-5-1.jpg?table=block\u0026id=25d88756-3979-8023-9a5a-d926873b7b9b\u0026t=25d88756-3979-8023-9a5a-d926873b7b9b","category":null,"tags":["旅行"],"summary":"眩しさだけは、忘れなかった","slug":"post/summer-pockets-junrei","href":"/post/summer-pockets-junrei","pageIcon":"","lastEditedDate":"2025-09-01T18:26:01.035Z","publishDate":1756339200000,"ext":{},"short_id":"25d88756"},{"title":"2024 年度总结","pageCoverThumbnail":"https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Fbfe50417-58ba-4d65-ab45-24dd49660962%2Fimage.png?table=block\u0026id=16e88756-3979-8010-aeb9-d7e49f597453\u0026t=16e88756-3979-8010-aeb9-d7e49f597453\u0026width=800\u0026cache=v2","category":null,"tags":["碎碎念"],"summary":null,"slug":"post/2024summary","href":"/post/2024summary","pageIcon":"","lastEditedDate":"2025-01-01T09:43:48.713Z","publishDate":1735689600000,"ext":{},"short_id":"16e88756"},{"title":"确定性模拟器","pageCoverThumbnail":"","category":null,"tags":["分布式系统"],"summary":"最初接触到确定性模拟的概念是在 2022 年 Rust China Conf 上听的一场演讲，后续一直持续关注着这个领域，也在腾讯组内分享过相关议题","slug":"post/deterministic-simulator","href":"/post/deterministic-simulator","pageIcon":"","lastEditedDate":"2024-12-21T17:14:04.799Z","publishDate":1734739200000,"ext":{},"short_id":"14688756"},{"title":"浅谈协程","pageCoverThumbnail":"","category":null,"tags":["操作系统"],"summary":"最近经常被各种人问到一些关于协程的事情，例如 xx 语言的 xx 是不是协程，xx 语言和 xx 语言的协程有什么区别，我不得不一次次 share 出我的文章，索性直接发到 blog 上吧","slug":"post/coroutine","href":"/post/coroutine","pageIcon":"","lastEditedDate":"2024-11-22T15:31:35.279Z","publishDate":1732233600000,"ext":{},"short_id":"14688756"},{"title":"MemoryDB: Redis + Remote Log","pageCoverThumbnail":"","category":null,"tags":["分布式系统","数据库","论文阅读"],"summary":"MemoryDB 是 Amazon 的一个 Redis 兼容的 KV 数据库，论文发表在 SIGMOD 2024 上","slug":"post/memorydb","href":"/post/memorydb","pageIcon":"","lastEditedDate":"2024-11-18T03:17:24.167Z","publishDate":1731801600000,"ext":{},"short_id":"12988756"},{"title":"应该在 DBMS 中使用 MMAP 吗？","pageCoverThumbnail":"","category":null,"tags":["论文阅读","数据库"],"summary":null,"slug":"post/db-mmap","href":"/post/db-mmap","pageIcon":"","lastEditedDate":"2024-11-03T07:26:55.808Z","publishDate":1729987200000,"ext":{},"short_id":"94e03781"},{"title":"日本游记","pageCoverThumbnail":"https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Fb07e03ea-454d-48b4-a53c-169003780460%2FDSC_0663.jpg?table=block\u0026id=11688756-3979-8028-b7d8-ce8bf2ec4253\u0026t=11688756-3979-8028-b7d8-ce8bf2ec4253\u0026width=800\u0026cache=v2","category":null,"tags":["碎碎念","旅行"],"summary":"次の駅は、東京です","slug":"post/japan-travel","href":"/post/japan-travel","pageIcon":"","lastEditedDate":"2024-11-09T06:15:00.191Z","publishDate":1729468800000,"ext":{},"short_id":"11688756"},{"title":"PVE 迁移翻车自救","pageCoverThumbnail":"","category":null,"tags":["折腾","PVE"],"summary":null,"slug":"post/pve-migration-rescue","href":"/post/pve-migration-rescue","pageIcon":"","lastEditedDate":"2024-10-13T12:39:01.429Z","publishDate":1728777600000,"ext":{},"short_id":"11d88756"},{"title":"译：使 Rust library 兼容 no_std","pageCoverThumbnail":"","category":null,"tags":["Rust"],"summary":"Effective Rust Item 33","slug":"post/rust-no-std","href":"/post/rust-no-std","pageIcon":"","lastEditedDate":"2024-09-21T10:57:48.428Z","publishDate":1726876800000,"ext":{},"short_id":"4e5d7fc0"},{"title":"Infra 窘境","pageCoverThumbnail":"","category":null,"tags":["碎碎念"],"summary":"前段时间秋招也陆续开始了，偶尔有师弟问我不想写业务，怎么才能做 infra，其实我是劝退的。算下来我毕业正式工作也一年多了，趁机从个人角度发表点暴论","slug":"post/infra-dilemma","href":"/post/infra-dilemma","pageIcon":"","lastEditedDate":"2024-09-12T13:38:22.110Z","publishDate":1725321600000,"ext":{},"short_id":"5b4b2d85"},{"title":"迁移博客到 Notion","pageCoverThumbnail":"","category":null,"tags":["折腾"],"summary":"Make Notion Great Again！","slug":"post/migrate-blog-to-notion","href":"/post/migrate-blog-to-notion","pageIcon":"","lastEditedDate":"2024-11-17T13:06:23.285Z","publishDate":1724544000000,"ext":{},"short_id":"a06c26b2"},{"title":"Longhorn 浅析","pageCoverThumbnail":"https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Fc3967b7e-bde2-4b5b-b5f6-97de21642f16%2Flonghorn.png?table=block\u0026id=bde25ba8-2381-4da6-bb5e-5787ace45def\u0026t=bde25ba8-2381-4da6-bb5e-5787ace45def\u0026width=800\u0026cache=v2","category":null,"tags":["存储","分布式系统"],"summary":"Longhorn 是一个 Go 实现的 Cloud Native Storage，比较好奇作为一个提供块存储的分布式存储系统，使用 Go 实现，会面临哪些挑战，性能方面要又要如何优化","slug":"post/longhorn","href":"/post/longhorn","pageIcon":"","lastEditedDate":"2024-10-08T10:27:34.637Z","publishDate":1723075200000,"ext":{},"short_id":"bde25ba8"},{"title":"从 Linux 内核看读写锁设计","pageCoverThumbnail":"","category":null,"tags":["Linux","操作系统"],"summary":"前段时间看了《Linux内核设计与实现》，第 10 章「内核同步方法」中提到了几种内核中的读写锁。它们分别代表了几种比较典型的读写锁设计，非常值得学习，这里记录一下，讨论是基于 2.6 内核和 x86 体系结构的基础上进行的","slug":"post/kernel-rwlock","href":"/post/kernel-rwlock","pageIcon":"","lastEditedDate":"2024-11-22T13:43:47.075Z","publishDate":1704326400000,"ext":{},"short_id":"0e96a78e"},{"title":"2023 年度总结","pageCoverThumbnail":"https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F9e8551ce-463f-41bc-b07f-5a8362a94846%2F2023summary.jpg?table=block\u0026id=d26ce18a-fa8d-4df4-8b82-69c419c5b621\u0026t=d26ce18a-fa8d-4df4-8b82-69c419c5b621\u0026width=800\u0026cache=v2","category":null,"tags":["碎碎念"],"summary":null,"slug":"post/2023summary","href":"/post/2023summary","pageIcon":"","lastEditedDate":"2024-08-27T15:25:27.096Z","publishDate":1703980800000,"ext":{},"short_id":"d26ce18a"},{"title":"混乱的软中断概念","pageCoverThumbnail":"","category":null,"tags":["Linux","操作系统"],"summary":"软中断（softirq）和软件中断（software interrupt）","slug":"post/softirq-and-software-interrupt","href":"/post/softirq-and-software-interrupt","pageIcon":"","lastEditedDate":"2024-11-22T13:43:43.071Z","publishDate":1692144000000,"ext":{},"short_id":"3327d648"},{"title":"PVE8 上启用 12 代 Intel CPU 核显 SR-IOV","pageCoverThumbnail":"","category":null,"tags":["折腾","PVE"],"summary":"拯救我的 Galgame 和追番体验～","slug":"post/pve8-intel-sr-iov","href":"/post/pve8-intel-sr-iov","pageIcon":"","lastEditedDate":"2024-10-13T03:51:26.212Z","publishDate":1691280000000,"ext":{},"short_id":"d5fd419b"},{"title":"容器标准和生态","pageCoverThumbnail":"","category":null,"tags":["Cloud Native"],"summary":null,"slug":"post/container-spec-ecosystem","href":"/post/container-spec-ecosystem","pageIcon":"","lastEditedDate":"2025-01-13T12:53:01.310Z","publishDate":1689120000000,"ext":{},"short_id":"deaccfa2"},{"title":"Vim as an IDE","pageCoverThumbnail":"","category":null,"tags":["折腾","Vim"],"summary":"记录 Vim 入教过程和折腾记录","slug":"post/vim-as-an-ide","href":"/post/vim-as-an-ide","pageIcon":"","lastEditedDate":"2024-08-27T15:25:23.391Z","publishDate":1687392000000,"ext":{},"short_id":"f26f0a34"},{"title":"Kubernetes CSI","pageCoverThumbnail":"","category":null,"tags":["Cloud Native","Kubernetes"],"summary":null,"slug":"post/kubernetes-csi","href":"/post/kubernetes-csi","pageIcon":"","lastEditedDate":"2024-08-27T15:25:21.308Z","publishDate":1686960000000,"ext":{},"short_id":"a23d61e0"},{"title":"2022 年度总结","pageCoverThumbnail":"https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F967f6a03-c26f-451c-971a-3b507ae769f3%2Ftencent_badge.jpg?table=block\u0026id=cc463e20-63ea-4132-acea-84fc7307dde8\u0026t=cc463e20-63ea-4132-acea-84fc7307dde8\u0026width=800\u0026cache=v2","category":null,"tags":["碎碎念"],"summary":null,"slug":"post/2022summary","href":"/post/2022summary","pageIcon":"","lastEditedDate":"2024-11-10T10:41:29.539Z","publishDate":1672444800000,"ext":{},"short_id":"cc463e20"},{"title":"The Google File System 论文概览","pageCoverThumbnail":"","category":null,"tags":["论文阅读","分布式系统"],"summary":null,"slug":"post/gfs-paper","href":"/post/gfs-paper","pageIcon":"","lastEditedDate":"2025-04-15T02:57:01.735Z","publishDate":1644796800000,"ext":{},"short_id":"1eecd7c4"},{"title":"MIT6.824 Lab1 MapReduce","pageCoverThumbnail":"","category":null,"tags":["分布式系统"],"summary":null,"slug":"post/mit6824-lab1-mapreduce","href":"/post/mit6824-lab1-mapreduce","pageIcon":"","lastEditedDate":"2024-08-27T15:25:13.837Z","publishDate":1644624000000,"ext":{},"short_id":"514ae2e3"},{"title":"蒟蒻的 2021 年度总结","pageCoverThumbnail":"https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Fd8a67659-bb3d-447e-b70f-7aa9f7987b88%2Fgpnu.jpeg?table=block\u0026id=7b0eb02d-8b44-45f3-b593-52c0a62f4595\u0026t=7b0eb02d-8b44-45f3-b593-52c0a62f4595\u0026width=800\u0026cache=v2","category":null,"tags":["碎碎念"],"summary":"落落落落的一年","slug":"post/2021summary","href":"/post/2021summary","pageIcon":"","lastEditedDate":"2024-08-27T15:25:12.637Z","publishDate":1640908800000,"ext":{},"short_id":"7b0eb02d"},{"title":"蒟蒻的 2020 年度总结","pageCoverThumbnail":"https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F1dc80ee3-5c1d-4af8-a284-d7896174816a%2Ficpc%25E5%258D%2597%25E4%25BA%25AC.png?table=block\u0026id=37c4cfd9-62a3-41bb-9989-f9df38c45d04\u0026t=37c4cfd9-62a3-41bb-9989-f9df38c45d04\u0026width=800\u0026cache=v2","category":null,"tags":["碎碎念"],"summary":"转眼三年已经过去，我也迎来了毕业","slug":"post/2020summary","href":"/post/2020summary","pageIcon":"","lastEditedDate":"2024-08-27T15:25:11.371Z","publishDate":1610236800000,"ext":{},"short_id":"37c4cfd9"},{"title":"蒟蒻的 2019 年度总结","pageCoverThumbnail":"https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2F2fdfd260-e2c8-42ea-9d8d-6fd6795797dc%2Flanqiao.jpeg?table=block\u0026id=8aa3f594-ff5d-4f99-b0a2-fa09bb32ba84\u0026t=8aa3f594-ff5d-4f99-b0a2-fa09bb32ba84\u0026width=800\u0026cache=v2","category":null,"tags":["碎碎念"],"summary":"随着2019年最后一晚的落幕，21世纪的10年代也结束了，今年的我无论是在技术上还是别的方面，都成长了许多。以本文记录我的技术路程，迎接新的一年","slug":"post/2019summary","href":"/post/2019summary","pageIcon":"","lastEditedDate":"2024-08-27T15:25:09.505Z","publishDate":1577836800000,"ext":{},"short_id":"8aa3f594"},{"title":"蒟蒻的 2018 年度总结","pageCoverThumbnail":"https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Ff362b439-342f-451a-b70e-41ec07d86ab3%2F2018summary.jpeg?table=block\u0026id=806f9f46-c738-4c87-9957-e73d11ec44bd\u0026t=806f9f46-c738-4c87-9957-e73d11ec44bd\u0026width=800\u0026cache=v2","category":null,"tags":["碎碎念"],"summary":"又是一年过去了，2018算是人生中最重要的转折点之一，总结一下今年的经历和感想，也算是记录我的技术路程","slug":"post/2018summary","href":"/post/2018summary","pageIcon":"","lastEditedDate":"2024-08-27T15:25:07.409Z","publishDate":1546214400000,"ext":{},"short_id":"806f9f46"}],"tagOptions":[{"name":"碎碎念","color":"red","count":9},{"name":"分布式系统","color":"gray","count":5},{"name":"折腾","color":"blue","count":4},{"name":"论文阅读","color":"orange","count":3},{"name":"操作系统","color":"blue","count":3},{"name":"Linux","color":"purple","count":2},{"name":"Cloud Native","color":"brown","count":2},{"name":"数据库","color":"yellow","count":2},{"name":"旅行","color":"yellow","count":2},{"name":"PVE","color":"blue","count":2},{"name":"存储","color":"default","count":1},{"name":"Vim","color":"pink","count":1},{"name":"Kubernetes","color":"green","count":1},{"name":"Rust","color":"orange","count":1}],"categoryOptions":[],"customNav":[{"icon":"fas fa-link","name":"友链","href":"/links","target":"_self","show":true},{"icon":null,"name":"关于","href":"/about","target":"_self","show":true}],"customMenu":[{"date":{"start_date":"2023-03-23"},"type":"Menu","slug":"/","title":"🏠 首页","status":"Published","category":"","comment":"","publishDate":1679529600000,"publishDay":"2023-3-23","lastEditedDate":"2024-08-29T13:50:49.017Z","lastEditedDay":"2024-8-29","fullWidth":false,"pageIcon":"","pageCover":"","pageCoverThumbnail":"","ext":{},"tagItems":[],"href":"/","name":"🏠 首页","target":"_self","password":"","show":true},{"date":{"start_date":"2024-08-24","date_format":"relative"},"type":"Menu","slug":"/archive","title":"📃 归档","status":"Published","category":"","comment":"","publishDate":1724457600000,"publishDay":"2024-8-24","lastEditedDate":"2024-08-25T14:25:34.972Z","lastEditedDay":"2024-8-25","fullWidth":false,"pageIcon":"","pageCover":"","pageCoverThumbnail":"","ext":{},"tagItems":[],"href":"/archive","name":"📃 归档","target":"_self","password":"","show":true},{"date":{"start_date":"2023-03-23"},"type":"Menu","slug":"/links","summary":"跳转到/links","title":"👬 友链","status":"Published","category":"","comment":"","publishDate":1679529600000,"publishDay":"2023-3-23","lastEditedDate":"2024-08-29T13:50:37.253Z","lastEditedDay":"2024-8-29","fullWidth":false,"pageIcon":"","pageCover":"","pageCoverThumbnail":"","ext":{},"tagItems":[],"href":"/links","name":"👬 友链","target":"_self","password":"","show":true},{"date":{"start_date":"2023-03-23"},"type":"Menu","slug":"/about","summary":"跳转到/about","title":"👤 关于","status":"Published","category":"","comment":"","publishDate":1679529600000,"publishDay":"2023-3-23","lastEditedDate":"2024-08-29T13:50:43.390Z","lastEditedDay":"2024-8-29","fullWidth":false,"pageIcon":"","pageCover":"","pageCoverThumbnail":"","ext":{},"tagItems":[],"href":"/about","name":"👤 关于","target":"_self","password":"","show":true}],"postCount":26,"latestPosts":[{"id":"25d88756-3979-8023-9a5a-d926873b7b9b","date":{"start_date":"2025-08-28","date_format":"relative"},"type":"Post","slug":"post/summer-pockets-junrei","tags":["旅行"],"summary":"眩しさだけは、忘れなかった","title":"Summer Pockets 圣地巡礼记","status":"Published","category":"","comment":"","publishDate":1756339200000,"publishDay":"2025-8-28","lastEditedDate":"2025-09-01T18:26:01.035Z","lastEditedDay":"2025-9-1","fullWidth":false,"pageIcon":"","pageCover":"https://www.notion.so/image/attachment%3Ab7e99627-78b8-440b-ab94-290679fd56a8%3Atoudai-5-1.jpg?table=block\u0026id=25d88756-3979-8023-9a5a-d926873b7b9b\u0026t=25d88756-3979-8023-9a5a-d926873b7b9b","pageCoverThumbnail":"https://www.notion.so/image/attachment%3Ab7e99627-78b8-440b-ab94-290679fd56a8%3Atoudai-5-1.jpg?table=block\u0026id=25d88756-3979-8023-9a5a-d926873b7b9b\u0026t=25d88756-3979-8023-9a5a-d926873b7b9b","ext":{},"tagItems":[{"name":"旅行","color":"yellow"}],"href":"/post/summer-pockets-junrei","target":"_self","password":""},{"id":"16e88756-3979-8010-aeb9-d7e49f597453","date":{"start_date":"2025-01-01","date_format":"relative"},"type":"Post","slug":"post/2024summary","tags":["碎碎念"],"title":"2024 年度总结","status":"Published","category":"","comment":"","publishDate":1735689600000,"publishDay":"2025-1-1","lastEditedDate":"2025-01-01T09:43:48.713Z","lastEditedDay":"2025-1-1","fullWidth":false,"pageIcon":"","pageCover":"https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Fbfe50417-58ba-4d65-ab45-24dd49660962%2Fimage.png?table=block\u0026id=16e88756-3979-8010-aeb9-d7e49f597453\u0026t=16e88756-3979-8010-aeb9-d7e49f597453\u0026width=800\u0026cache=v2","pageCoverThumbnail":"https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Fbfe50417-58ba-4d65-ab45-24dd49660962%2Fimage.png?table=block\u0026id=16e88756-3979-8010-aeb9-d7e49f597453\u0026t=16e88756-3979-8010-aeb9-d7e49f597453\u0026width=800\u0026cache=v2","ext":{},"tagItems":[{"name":"碎碎念","color":"red"}],"href":"/post/2024summary","target":"_self","password":""},{"id":"14688756-3979-80f8-8f88-d0bb8697b4a4","date":{"start_date":"2024-12-21","date_format":"relative"},"type":"Post","slug":"post/deterministic-simulator","tags":["分布式系统"],"summary":"最初接触到确定性模拟的概念是在 2022 年 Rust China Conf 上听的一场演讲，后续一直持续关注着这个领域，也在腾讯组内分享过相关议题","title":"确定性模拟器","status":"Published","category":"","comment":"","publishDate":1734739200000,"publishDay":"2024-12-21","lastEditedDate":"2024-12-21T17:14:04.799Z","lastEditedDay":"2024-12-21","fullWidth":false,"pageIcon":"","pageCover":"","pageCoverThumbnail":"","ext":{},"tagItems":[{"name":"分布式系统","color":"gray"}],"href":"/post/deterministic-simulator","target":"_self","password":""},{"id":"14688756-3979-806c-af3c-f23f4c85d88e","date":{"start_date":"2024-11-22","date_format":"relative"},"type":"Post","slug":"post/coroutine","tags":["操作系统"],"summary":"最近经常被各种人问到一些关于协程的事情，例如 xx 语言的 xx 是不是协程，xx 语言和 xx 语言的协程有什么区别，我不得不一次次 share 出我的文章，索性直接发到 blog 上吧","title":"浅谈协程","status":"Published","category":"","comment":"","publishDate":1732233600000,"publishDay":"2024-11-22","lastEditedDate":"2024-11-22T15:31:35.279Z","lastEditedDay":"2024-11-22","fullWidth":false,"pageIcon":"","pageCover":"","pageCoverThumbnail":"","ext":{},"tagItems":[{"name":"操作系统","color":"blue"}],"href":"/post/coroutine","target":"_self","password":""},{"id":"12988756-3979-8065-aeb4-e6ec1258ed90","date":{"start_date":"2024-11-17","date_format":"relative"},"type":"Post","slug":"post/memorydb","tags":["分布式系统","数据库","论文阅读"],"summary":"MemoryDB 是 Amazon 的一个 Redis 兼容的 KV 数据库，论文发表在 SIGMOD 2024 上","title":"MemoryDB: Redis + Remote Log","status":"Published","category":"","comment":"","publishDate":1731801600000,"publishDay":"2024-11-17","lastEditedDate":"2024-11-18T03:17:24.167Z","lastEditedDay":"2024-11-18","fullWidth":false,"pageIcon":"","pageCover":"","pageCoverThumbnail":"","ext":{},"tagItems":[{"name":"分布式系统","color":"gray"},{"name":"数据库","color":"yellow"},{"name":"论文阅读","color":"orange"}],"href":"/post/memorydb","target":"_self","password":""},{"id":"94e03781-e74c-41d0-89f7-df2e2a7ad93f","date":{"start_date":"2024-10-27","date_format":"relative"},"type":"Post","slug":"post/db-mmap","tags":["论文阅读","数据库"],"title":"应该在 DBMS 中使用 MMAP 吗？","status":"Published","category":"","comment":"","publishDate":1729987200000,"publishDay":"2024-10-27","lastEditedDate":"2024-11-03T07:26:55.808Z","lastEditedDay":"2024-11-3","fullWidth":false,"pageIcon":"","pageCover":"","pageCoverThumbnail":"","ext":{},"tagItems":[{"name":"论文阅读","color":"orange"},{"name":"数据库","color":"yellow"}],"href":"/post/db-mmap","target":"_self","password":""}],"post":{"id":"bde25ba8-2381-4da6-bb5e-5787ace45def","date":{"start_date":"2024-08-08","date_format":"relative"},"type":"Post","slug":"post/longhorn","tags":["存储","分布式系统"],"summary":"Longhorn 是一个 Go 实现的 Cloud Native Storage，比较好奇作为一个提供块存储的分布式存储系统，使用 Go 实现，会面临哪些挑战，性能方面要又要如何优化","title":"Longhorn 浅析","status":"Published","category":"","comment":"","publishDate":1723075200000,"publishDay":"2024-8-8","lastEditedDate":"2024-10-08T10:27:34.637Z","lastEditedDay":"2024-10-8","fullWidth":false,"pageIcon":"","pageCover":"https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Fc3967b7e-bde2-4b5b-b5f6-97de21642f16%2Flonghorn.png?table=block\u0026id=bde25ba8-2381-4da6-bb5e-5787ace45def\u0026t=bde25ba8-2381-4da6-bb5e-5787ace45def\u0026width=800\u0026cache=v2","pageCoverThumbnail":"https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F4cc04375-345a-4a1e-bdf0-3a7c88ef0425%2Fc3967b7e-bde2-4b5b-b5f6-97de21642f16%2Flonghorn.png?table=block\u0026id=bde25ba8-2381-4da6-bb5e-5787ace45def\u0026t=bde25ba8-2381-4da6-bb5e-5787ace45def\u0026width=800\u0026cache=v2","ext":{},"tagItems":[{"name":"存储","color":"default"},{"name":"分布式系统","color":"gray"}],"href":"/post/longhorn","target":"_self","password":"","blockMap":{"block":{"bde25ba8-2381-4da6-bb5e-5787ace45def":{"value":{"id":"bde25ba8-2381-4da6-bb5e-5787ace45def","version":394,"type":"page","content":["558e1400-6fe1-422c-bf7f-c8b2f8deb43c","a27b2680-7086-4f4c-bd27-15352ef1ce82","301a3fb6-1011-47f1-8b36-213676033414","c05865d5-7daa-4abb-98d9-3927c381a6e5","f09b7b63-717c-43f5-8e2d-00daafae5408","2ac29b2f-e2b0-4d3c-b688-7163a7b9475c","8b5b62ca-50dd-42c8-bb35-c986c2eeefa1","7bba1942-4d11-4d38-8f93-93df77e91948","b7063a8f-a46a-4341-81a4-52d52e494be3","ac953deb-b229-4ea4-955a-3907f2d4c26e","948f2c7c-8764-4448-8997-463e10737272","dea92143-e9cc-4454-ac8a-47e67e6deff5","c0ea8054-fb66-4660-9340-c9e8e46a1185","84d974d4-8474-4992-909a-067236352d38","01378c9a-591b-4f45-9435-71fe10dd271f","fa074d7b-3d93-4f53-a68d-d46949b39809","e667a855-3d76-4888-b6c0-c4180da37b75","b43e4711-0e5a-4c76-ab01-abd21773aa37","d00ff361-06d2-4fc2-aec6-4382971c546f","3477863d-f7d6-47a2-9e30-c35ff77d444a","31eec863-4d57-4064-839f-5d742db75ef3","6761eac0-8c07-4bf6-ac15-bb5702cabd8a","e209bbbc-c5a5-4a7c-a6cb-3196ca30f373","5561d5c9-0b2b-4db6-a6ed-f1b47e382aa1","f9d9524d-f630-451b-a766-cb16c3c63f75","071e3692-288c-4317-8c67-a3910049b00d","d7a2c34e-356e-42d0-a698-3d2151404de8","80f037a7-48eb-4cde-ad71-a0cad980a13e","68047b47-005d-4e7f-8dc2-ec22c348a0ce","5b30fff5-ac85-4766-8a0e-4cc9e4e63060","b740d7c8-ba6b-4d0d-bf45-00769d6b8fa1","6080c1ce-0625-443b-a0dc-fc07904694e3","b15c19b2-7cf1-414e-8771-0ef828778f27","845f783b-6e76-4863-80cb-a501c2ab288e","bfb2ab66-dca2-4e3e-963f-0d9cdbe5db92","ff3f6104-8866-4df0-9eb3-fa7ca05b1226","f58864b6-b95c-4ceb-8dd8-d8f6fea37fe8","ec72c51e-3484-49f6-9c3c-afe735b4ec2c","8a914f1f-eca0-4c7e-ac4c-fd909ab9f4b3","f08581e6-2d68-4580-b789-2a44743bc72e","2cb0b408-91c0-483a-a64e-f60bdccf5026","88d58d5b-4d6f-4a50-b3ec-76d208033133","dfa25c88-d5f3-4517-97c3-60a81e00e59a","d1435b2b-c5a7-4434-8d36-15e683aebc70","9d5c6878-fd17-43ff-bc06-d9bf48d7ae83","1f5cc878-3c96-4b37-8a81-a49efab11384","a6622edd-4b28-456a-8263-1d11a44b11d6","493cb66e-845a-4ecd-852d-50700e1ee1ac","7ec3e975-990b-4556-8d81-90e2e4baaba9","5302560a-92db-4fe1-828e-e3481a827c60","fbd6f38a-b64f-4cc0-9772-0f73a67f3d07","12a5cdc8-ab43-4bb8-b1f6-86b36052524b","a729190e-0c85-4c5d-afeb-d900206f656c","a55f5c5f-9ae5-4823-bde0-1f309bb0d7d0","5385dda7-4bc5-4d37-a1fd-dff3b825b70e","badafa3b-b61f-439b-b6af-239a9545bd51","895459d5-394d-4433-857a-0b297e72f044","aa4a4965-7412-479a-b045-9d4061d971fe","e6a2ecb9-2ae6-4051-801d-13b4a3aa0ffc","f492b362-aba2-4373-bcfd-1865eeda3ea6","68860309-7b4a-488a-8c2c-74cabaa7cfad","fe2898a8-b325-42b0-b198-071835532d84","216da7e2-fe81-4906-b122-2f304a5dfca4","157938c8-dd74-4694-96dd-340cfd82336e","5124f1f3-028f-4cc9-a6a0-7ab9f3274d8e","8855c871-7ddb-4bbc-9a85-3acae891457c","30cca0e4-3eeb-4644-83e6-a121dc1ec3a0","1cef134c-9421-4c29-ac92-dbc7771ddd4f","eb6f16d4-ea0d-4932-b61c-a1c85055695c","ca9b3750-3b20-433a-85b5-877a4f3e51ad","b5e2e343-a9a7-46b7-a31b-b5fa4b7a04ec","d376ba71-b271-424d-8060-d08d2e53d349","27e019a0-4b36-4049-bf72-944745e9ac6c","8dc4380a-3dbf-41d0-9cea-b0af03074b40","c02bf569-3f05-4580-b098-f52d09297f11","0abfa260-4079-4ca8-8d46-02c04448568c","e8b93937-f7b8-427a-b87b-f8c4800bcd91","6b50d509-6270-4f2e-9587-67eb032c21d6","44824160-de3d-43d5-a6c9-915fdffdaf24","dfc590a4-a8c8-4edd-8982-32d3a8e5c77b","6e079fd5-54fa-4c0f-8fd9-9c090bea781e","fb0a3e9f-ce5c-4c3a-af83-b31a9fe55903","f4b352dd-caba-43ae-9a31-6b09879a3ab0","8800227d-91f7-4455-8053-5c8e5cceb673","2dbe78dd-c429-4bc6-9720-ca89ee62ecf0","51eb40a6-9040-4a43-8505-b0b2ab13876d","42b41672-8d6e-4431-aa2c-af3e688887fd","f43a75e3-a936-49ef-9650-4ce452c81e7c","912714e5-daaa-4647-b3b1-7413e3f0da44","d32b007e-2338-4eb7-858b-3d37620a8c83","39530a36-f376-4bb1-8113-d7206968fa8d","87890865-c795-4251-9af2-9a263964d1bb","9207b00d-dbac-4819-9dea-f25292352e0d","7c840412-5919-4a47-bf3b-2417b4e8b9a8","9374f8ca-0db0-46d6-8a44-bd8f825d731e","7c1c4ce9-4e19-43d7-86b5-6207c665bbf9","0ecfb0ba-a047-4a58-ac81-55cb200e0303","3061abd7-6d2b-46b6-b730-aa48e3f77b10","686b6265-1ca1-4dfb-b625-582ee5e0884a","5f3918d4-e456-458a-a4f3-1d9cae3ccefb","6d3d53a8-874b-4d2a-8fa4-21e088da8416","9d6ff8c0-b08d-4ba5-9e87-10d7409735b8","9ab0b35f-8474-4bda-ab45-6c0090f7e85a","0c280a67-7c33-4976-a0cf-4f6c5163704c","c393f09a-44db-483d-bcb2-644c4df77ce0","c069cf00-c156-44ed-ab96-a083efce6fd1","2140495b-b704-4178-900a-da12d68daed7","c09c9fd4-e8e9-4e64-84bf-861b297ba597","1bed0ccd-d957-4d18-aab8-44bde9182313","98e5ad31-8f3b-4a14-aa61-430ea78f5412","dadebf59-a65e-4de4-b087-2c5d075b1ab5","56a447e1-bf3b-457b-b5ca-22cd6ffade12","f68dbe3d-3301-4bff-8b82-3140ef4fa3e6","83198b20-b262-4546-98b6-2893f220808e","e775ef1a-31f5-42a4-9a95-cef860c10fe3","04a72dc6-b4cd-42a9-b679-7b9ed1c9727a","e1d05407-c208-4f5c-9af0-1c1621143b4d","cd732eaa-43e7-4483-a122-e424226f982d","e17fae7a-31b6-4bbd-b325-5589cf7abcd3","5f63c08e-8e7c-4c32-ab83-ecb2a9a3c6e1","cf49f8d4-38da-4731-9a0a-e82178d7bf33","e45463e9-4b21-4574-84b3-b20328c00b1e","22612c4b-1c3b-468b-a2c8-af7dacb56a95","5df8b116-0c77-4e2d-af6a-52a44b086766"],"format":{"page_font":"mono","page_cover":"https://prod-files-secure.s3.us-west-2.amazonaws.com/4cc04375-345a-4a1e-bdf0-3a7c88ef0425/c3967b7e-bde2-4b5b-b5f6-97de21642f16/longhorn.png","block_locked":false,"block_locked_by":"919e7400-5a69-4402-b2e1-f7d99cc48131","copied_from_pointer":{"id":"2eace25c-842c-46fd-9ccb-e9190981b6c3","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"},"page_cover_position":0.5},"created_time":1724511656057,"last_edited_time":1728383254637,"parent_id":"0bb2e606-8d0c-4f7c-aca9-70986e90c055","parent_table":"collection","alive":true,"copied_from":"2eace25c-842c-46fd-9ccb-e9190981b6c3","file_ids":["c3967b7e-bde2-4b5b-b5f6-97de21642f16"],"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"pl67HxTp4IAwNG-5pWD0dg,\"start\",\"end\"","n":{"pl67HxTp4IAwNG-5pWD0dg,\"start\",\"end\"":{"s":{"x":"pl67HxTp4IAwNG-5pWD0dg","i":[{"t":"s"},{"t":"t","i":["u5k2AfiHBQG6",1],"o":"start","l":11,"c":"Longhorn 浅析"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"0dc306ca-50a6-4917-9b5a-85a61f0f66f5":{"value":{"id":"0dc306ca-50a6-4917-9b5a-85a61f0f66f5","version":203,"type":"collection_view_page","content":["c12d1fcb-2e22-4dc3-a5f5-b5010c63059a"],"view_ids":["2efe7048-0d5f-4e04-8b4e-2a3793ad6aef","14688756-3979-80e7-97c9-000c212f8370","14588756-3979-8039-9990-000cefddccf8","55d7f55d-3bd1-4a1a-97c9-a6c8354ecd3d","8dfd415c-71af-41f9-b984-e7182bf2210b","3c2f93d8-6810-42a1-87da-55f1ecda9bca"],"collection_id":"0bb2e606-8d0c-4f7c-aca9-70986e90c055","format":{"site_id":"cd684fc1-aa3f-4897-8f3a-ec903e77f063","block_locked":false,"block_locked_by":"27074aef-7216-41ed-baef-d9b53addd870","collection_pointer":{"id":"0bb2e606-8d0c-4f7c-aca9-70986e90c055","table":"collection","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"},"copied_from_pointer":{"id":"02ab3b86-7800-4aa6-9e9e-415905ef32a5","table":"block","spaceId":"6c096b44-beb9-48ee-8f92-1efdde47f3a3"},"page_cover_position":0.5,"social_media_image_preview_url":"https://prod-files-secure.s3.us-west-2.amazonaws.com/4cc04375-345a-4a1e-bdf0-3a7c88ef0425/16412a4f-3220-4021-b553-56a010794a94/SocialMediaPreviewImage.png"},"permissions":[{"role":"editor","type":"user_permission","user_id":"919e7400-5a69-4402-b2e1-f7d99cc48131"},{"role":"reader","type":"public_permission","is_site":true,"added_timestamp":1724420656606,"allow_duplicate":false}],"created_time":1724383978099,"last_edited_time":1756748880461,"parent_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","parent_table":"space","alive":true,"copied_from":"02ab3b86-7800-4aa6-9e9e-415905ef32a5","file_ids":["49b4570c-b2f0-457b-81b7-b68e2693a471","708d7d1d-6233-408b-952f-594bb2831de7","145cea07-09d7-4146-bcf5-bebd1518488c","a9af1d6b-f284-4734-ba06-990353cf3f84","20ee2bf3-8f75-4cd7-9d6e-e1a780d5f17c","16412a4f-3220-4021-b553-56a010794a94"],"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"WL67X1wdfrRBQYoi916POg,\"start\",\"end\"","n":{"WL67X1wdfrRBQYoi916POg,\"start\",\"end\"":{"s":{"x":"WL67X1wdfrRBQYoi916POg","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"558e1400-6fe1-422c-bf7f-c8b2f8deb43c":{"value":{"id":"558e1400-6fe1-422c-bf7f-c8b2f8deb43c","version":5,"type":"text","created_time":1724511730771,"last_edited_time":1724511730773,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"h_LGeLa2DCHfyGK1YBQcvQ,\"start\",\"end\"","n":{"h_LGeLa2DCHfyGK1YBQcvQ,\"start\",\"end\"":{"s":{"x":"h_LGeLa2DCHfyGK1YBQcvQ","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"a27b2680-7086-4f4c-bd27-15352ef1ce82":{"value":{"id":"a27b2680-7086-4f4c-bd27-15352ef1ce82","version":9,"type":"text","properties":{"title":[["Longhorn 是一个 Go 实现的 Cloud Native Storage，比较好奇作为一个提供块存储的分布式存储系统，使用 Go 实现，会面临哪些挑战，性能方面要又要如何优化"]]},"format":{"copied_from_pointer":{"id":"ad0c61b0-6f84-424b-9474-970d8f1154e6","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734203,"last_edited_time":1724511734204,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"ad0c61b0-6f84-424b-9474-970d8f1154e6","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"XtHeJ2F8DRa9LIEzsqqLnw,\"start\",\"end\"","n":{"XtHeJ2F8DRa9LIEzsqqLnw,\"start\",\"end\"":{"s":{"x":"XtHeJ2F8DRa9LIEzsqqLnw","i":[{"t":"s"},{"t":"t","i":["UwBAN4QMp7tS",1],"o":"start","l":91,"c":"Longhorn 是一个 Go 实现的 Cloud Native Storage，比较好奇作为一个提供块存储的分布式存储系统，使用 Go 实现，会面临哪些挑战，性能方面要又要如何优化"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"301a3fb6-1011-47f1-8b36-213676033414":{"value":{"id":"301a3fb6-1011-47f1-8b36-213676033414","version":7,"type":"text","format":{"copied_from_pointer":{"id":"4406f490-7e1a-49c0-9a3f-87d363a76138","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734129,"last_edited_time":1724511734130,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"4406f490-7e1a-49c0-9a3f-87d363a76138","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"f9Mkrw1-ZzS-voTyiwnaFw,\"start\",\"end\"","n":{"f9Mkrw1-ZzS-voTyiwnaFw,\"start\",\"end\"":{"s":{"x":"f9Mkrw1-ZzS-voTyiwnaFw","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"c05865d5-7daa-4abb-98d9-3927c381a6e5":{"value":{"id":"c05865d5-7daa-4abb-98d9-3927c381a6e5","version":9,"type":"text","properties":{"title":[["从宏观视角来看，Longhorn 的数据流如下， Engine 是 volume 的 controller，每个 volume 都会有一个 engine 实例，replica 是卷的一个副本实例，负责具体的落盘，显然 Engine 就是数据面的核心"]]},"format":{"copied_from_pointer":{"id":"371aff99-56a3-42cc-8678-6ea152cac46a","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734001,"last_edited_time":1724511734002,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"371aff99-56a3-42cc-8678-6ea152cac46a","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"PuzQGWJZuRKsdbt23OedPw,\"start\",\"end\"","n":{"PuzQGWJZuRKsdbt23OedPw,\"start\",\"end\"":{"s":{"x":"PuzQGWJZuRKsdbt23OedPw","i":[{"t":"s"},{"t":"t","i":["I4JdvdwfMOZB",1],"o":"start","l":124,"c":"从宏观视角来看，Longhorn 的数据流如下， Engine 是 volume 的 controller，每个 volume 都会有一个 engine 实例，replica 是卷的一个副本实例，负责具体的落盘，显然 Engine 就是数据面的核心"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"f09b7b63-717c-43f5-8e2d-00daafae5408":{"value":{"id":"f09b7b63-717c-43f5-8e2d-00daafae5408","version":11,"type":"image","properties":{"size":[["88.0KB"]],"title":[["Untitled"]],"source":[["https://prod-files-secure.s3.us-west-2.amazonaws.com/4cc04375-345a-4a1e-bdf0-3a7c88ef0425/74bdb399-f643-4c60-af08-0435670cf958/Untitled.png"]]},"format":{"block_width":707.9921875,"display_source":"https://prod-files-secure.s3.us-west-2.amazonaws.com/4cc04375-345a-4a1e-bdf0-3a7c88ef0425/74bdb399-f643-4c60-af08-0435670cf958/Untitled.png","block_full_width":false,"block_page_width":true,"block_aspect_ratio":0.602921646746348,"copied_from_pointer":{"id":"199f65ae-5ff0-4ac8-b9ae-07d8914f6b1f","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"},"block_preserve_scale":true},"created_time":1724511734098,"last_edited_time":1728383254856,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"199f65ae-5ff0-4ac8-b9ae-07d8914f6b1f","file_ids":["74bdb399-f643-4c60-af08-0435670cf958"],"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"_5k2d_zmMhJcPYrj8OxiNw,\"start\",\"end\"","n":{"_5k2d_zmMhJcPYrj8OxiNw,\"start\",\"end\"":{"s":{"x":"_5k2d_zmMhJcPYrj8OxiNw","i":[{"t":"s"},{"t":"t","i":["qokUOmASvAuo",1],"o":"start","l":8,"c":"Untitled"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"2ac29b2f-e2b0-4d3c-b688-7163a7b9475c":{"value":{"id":"2ac29b2f-e2b0-4d3c-b688-7163a7b9475c","version":9,"type":"text","properties":{"title":[["Longhorn 是控制面则是基于 K8s 的，所有资源都以 K8s CRD 提供，通过 Operator 管控，称为 Manager"]]},"format":{"copied_from_pointer":{"id":"5646f910-d14f-4e35-8741-b632d16c020b","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734426,"last_edited_time":1724511734427,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"5646f910-d14f-4e35-8741-b632d16c020b","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"WWk1es_-9swurX5uM28o_A,\"start\",\"end\"","n":{"WWk1es_-9swurX5uM28o_A,\"start\",\"end\"":{"s":{"x":"WWk1es_-9swurX5uM28o_A","i":[{"t":"s"},{"t":"t","i":["QpdPgliPdkMl",1],"o":"start","l":67,"c":"Longhorn 是控制面则是基于 K8s 的，所有资源都以 K8s CRD 提供，通过 Operator 管控，称为 Manager"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"8b5b62ca-50dd-42c8-bb35-c986c2eeefa1":{"value":{"id":"8b5b62ca-50dd-42c8-bb35-c986c2eeefa1","version":7,"type":"text","format":{"copied_from_pointer":{"id":"c706c55c-0d96-42a3-b4ad-99819b5eaef8","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734210,"last_edited_time":1724511734211,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"c706c55c-0d96-42a3-b4ad-99819b5eaef8","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"Rrer1nLC7EQy2l85ngAkfg,\"start\",\"end\"","n":{"Rrer1nLC7EQy2l85ngAkfg,\"start\",\"end\"":{"s":{"x":"Rrer1nLC7EQy2l85ngAkfg","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"7bba1942-4d11-4d38-8f93-93df77e91948":{"value":{"id":"7bba1942-4d11-4d38-8f93-93df77e91948","version":9,"type":"header","properties":{"title":[["V1 Engine"]]},"format":{"copied_from_pointer":{"id":"aa0c7299-d8e2-42f6-ba0e-71a7d7cb82f8","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734430,"last_edited_time":1724511734431,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"aa0c7299-d8e2-42f6-ba0e-71a7d7cb82f8","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"rLRxcvlWA17ai-KVTe93Ng,\"start\",\"end\"","n":{"rLRxcvlWA17ai-KVTe93Ng,\"start\",\"end\"":{"s":{"x":"rLRxcvlWA17ai-KVTe93Ng","i":[{"t":"s"},{"t":"t","i":["k-NW4vj98jKw",1],"o":"start","l":9,"c":"V1 Engine"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"b7063a8f-a46a-4341-81a4-52d52e494be3":{"value":{"id":"b7063a8f-a46a-4341-81a4-52d52e494be3","version":9,"type":"sub_header","properties":{"title":[["Replica"]]},"format":{"copied_from_pointer":{"id":"ce773bf2-57ee-48df-aefe-942bb4836cec","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734082,"last_edited_time":1724511734083,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"ce773bf2-57ee-48df-aefe-942bb4836cec","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"N1i0SEAZKJ1ejEKNwrhDDw,\"start\",\"end\"","n":{"N1i0SEAZKJ1ejEKNwrhDDw,\"start\",\"end\"":{"s":{"x":"N1i0SEAZKJ1ejEKNwrhDDw","i":[{"t":"s"},{"t":"t","i":["Y-4OodwoDjQG",1],"o":"start","l":7,"c":"Replica"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"ac953deb-b229-4ea4-955a-3907f2d4c26e":{"value":{"id":"ac953deb-b229-4ea4-955a-3907f2d4c26e","version":9,"type":"text","properties":{"title":[["Engine 有 V1 和 V2 两个版本，先从 V1 Engine 开始分析，自底向上看，最下面的是 replica。replica server 在启动时就会创建/打开对应的 replica，然后启动两个 grpc server，分别处理控制流和数据流"]]},"format":{"copied_from_pointer":{"id":"e6d00b2d-25e5-4733-9106-e2fceff770b9","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734057,"last_edited_time":1724511734058,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"e6d00b2d-25e5-4733-9106-e2fceff770b9","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"X7-Y3eYz6lN9HefoREPKYA,\"start\",\"end\"","n":{"X7-Y3eYz6lN9HefoREPKYA,\"start\",\"end\"":{"s":{"x":"X7-Y3eYz6lN9HefoREPKYA","i":[{"t":"s"},{"t":"t","i":["2w9PSBm2MKDR",1],"o":"start","l":128,"c":"Engine 有 V1 和 V2 两个版本，先从 V1 Engine 开始分析，自底向上看，最下面的是 replica。replica server 在启动时就会创建/打开对应的 replica，然后启动两个 grpc server，分别处理控制流和数据流"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"948f2c7c-8764-4448-8997-463e10737272":{"value":{"id":"948f2c7c-8764-4448-8997-463e10737272","version":7,"type":"text","format":{"copied_from_pointer":{"id":"3e0ddace-6378-4ef3-a87b-4bafb3caa303","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734028,"last_edited_time":1724511734029,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"3e0ddace-6378-4ef3-a87b-4bafb3caa303","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"LZzXOqyqYv44flABB1vFGQ,\"start\",\"end\"","n":{"LZzXOqyqYv44flABB1vFGQ,\"start\",\"end\"":{"s":{"x":"LZzXOqyqYv44flABB1vFGQ","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"dea92143-e9cc-4454-ac8a-47e67e6deff5":{"value":{"id":"dea92143-e9cc-4454-ac8a-47e67e6deff5","version":9,"type":"text","properties":{"title":[["replica 在节点上对应一组 sparse file，代码中这个结构称为 "],["diffDisk",[["c"]]],["，每个 file 有点类似于 LSM-Tree 中的 layer/level，这里称为 snapshot（除了最新一层叫 head/live data）："]]},"format":{"copied_from_pointer":{"id":"99e5a257-a600-45f2-b4a8-0314d3b13396","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734673,"last_edited_time":1724511734674,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"99e5a257-a600-45f2-b4a8-0314d3b13396","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"78f3TQVWivFpmbVmfsOkqA,\"start\",\"end\"","n":{"78f3TQVWivFpmbVmfsOkqA,\"start\",\"end\"":{"s":{"x":"78f3TQVWivFpmbVmfsOkqA","i":[{"t":"s"},{"t":"t","i":["VfKQUPevKW3P",1],"o":"start","l":39,"c":"replica 在节点上对应一组 sparse file，代码中这个结构称为 "},{"t":"t","i":["VfKQUPevKW3P",40],"o":["VfKQUPevKW3P",39],"l":8,"c":"diffDisk","b":[{"t":"a","x":"78f3TQVWivFpmbVmfsOkqA","l":"","i":["VfKQUPevKW3P",125],"s":{"i":["VfKQUPevKW3P",40],"a":"b"},"e":{"i":["VfKQUPevKW3P",47],"a":"a"},"a":["c"]}],"a":[]},{"t":"t","i":["VfKQUPevKW3P",48],"o":["VfKQUPevKW3P",47],"l":77,"c":"，每个 file 有点类似于 LSM-Tree 中的 layer/level，这里称为 snapshot（除了最新一层叫 head/live data）："},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"c0ea8054-fb66-4660-9340-c9e8e46a1185":{"value":{"id":"c0ea8054-fb66-4660-9340-c9e8e46a1185","version":9,"type":"image","properties":{"size":[["99.6KB"]],"title":[["Untitled"]],"source":[["https://prod-files-secure.s3.us-west-2.amazonaws.com/4cc04375-345a-4a1e-bdf0-3a7c88ef0425/09606cc3-8f19-4e2f-9a02-c9c0ace747f9/Untitled.png"]]},"format":{"block_width":576,"display_source":"https://prod-files-secure.s3.us-west-2.amazonaws.com/4cc04375-345a-4a1e-bdf0-3a7c88ef0425/09606cc3-8f19-4e2f-9a02-c9c0ace747f9/Untitled.png","block_full_width":false,"block_page_width":false,"block_aspect_ratio":0.7504159733777038,"copied_from_pointer":{"id":"facd9efd-0e48-4219-a682-5e95169ef5a6","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"},"block_preserve_scale":true},"created_time":1724511735519,"last_edited_time":1724511735520,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"facd9efd-0e48-4219-a682-5e95169ef5a6","file_ids":["09606cc3-8f19-4e2f-9a02-c9c0ace747f9"],"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"dFrcOnh69CM-ZIGMlu8CVw,\"start\",\"end\"","n":{"dFrcOnh69CM-ZIGMlu8CVw,\"start\",\"end\"":{"s":{"x":"dFrcOnh69CM-ZIGMlu8CVw","i":[{"t":"s"},{"t":"t","i":["WIXNc_znjnwM",1],"o":"start","l":8,"c":"Untitled"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"84d974d4-8474-4992-909a-067236352d38":{"value":{"id":"84d974d4-8474-4992-909a-067236352d38","version":9,"type":"text","properties":{"title":[["每个 "],["diffDisk",[["c"]]],[" 的元数据存在一个 "],["volume.meta",[["c"]]],[" 文件中，还会有一个 "],["revision.counter",[["c"]]],[" 文件记录写入的版本号。每一层 file 划分为多个 4K 大小的 sector，这是写入的最小单元，因为都是 sparse file，所以 Longhorn 的卷自然支持精简配置。file 之间从新到旧连接起来，索引表 "],["location",[["c"]]],[" 则存储 sector 位于哪一个 file 中"]]},"format":{"copied_from_pointer":{"id":"8f485634-3dda-4bbf-904e-574d6c1df1f0","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734142,"last_edited_time":1724511734143,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"8f485634-3dda-4bbf-904e-574d6c1df1f0","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"H370QEUdhFKdg7f8u1nfHg,\"start\",\"end\"","n":{"H370QEUdhFKdg7f8u1nfHg,\"start\",\"end\"":{"s":{"x":"H370QEUdhFKdg7f8u1nfHg","i":[{"t":"s"},{"t":"t","i":["SCBH7mxNtB-n",1],"o":"start","l":3,"c":"每个 "},{"t":"t","i":["SCBH7mxNtB-n",4],"o":["SCBH7mxNtB-n",3],"l":8,"c":"diffDisk","b":[{"t":"a","x":"H370QEUdhFKdg7f8u1nfHg","l":"","i":["SCBH7mxNtB-n",203],"s":{"i":["SCBH7mxNtB-n",4],"a":"b"},"e":{"i":["SCBH7mxNtB-n",11],"a":"a"},"a":["c"]}],"a":[]},{"t":"t","i":["SCBH7mxNtB-n",12],"o":["SCBH7mxNtB-n",11],"l":10,"c":" 的元数据存在一个 "},{"t":"t","i":["SCBH7mxNtB-n",22],"o":["SCBH7mxNtB-n",21],"l":11,"c":"volume.meta","b":[{"t":"a","x":"H370QEUdhFKdg7f8u1nfHg","l":"","i":["SCBH7mxNtB-n",204],"s":{"i":["SCBH7mxNtB-n",22],"a":"b"},"e":{"i":["SCBH7mxNtB-n",32],"a":"a"},"a":["c"]}],"a":[]},{"t":"t","i":["SCBH7mxNtB-n",33],"o":["SCBH7mxNtB-n",32],"l":11,"c":" 文件中，还会有一个 "},{"t":"t","i":["SCBH7mxNtB-n",44],"o":["SCBH7mxNtB-n",43],"l":16,"c":"revision.counter","b":[{"t":"a","x":"H370QEUdhFKdg7f8u1nfHg","l":"","i":["SCBH7mxNtB-n",205],"s":{"i":["SCBH7mxNtB-n",44],"a":"b"},"e":{"i":["SCBH7mxNtB-n",59],"a":"a"},"a":["c"]}],"a":[]},{"t":"t","i":["SCBH7mxNtB-n",60],"o":["SCBH7mxNtB-n",59],"l":111,"c":" 文件记录写入的版本号。每一层 file 划分为多个 4K 大小的 sector，这是写入的最小单元，因为都是 sparse file，所以 Longhorn 的卷自然支持精简配置。file 之间从新到旧连接起来，索引表 "},{"t":"t","i":["SCBH7mxNtB-n",171],"o":["SCBH7mxNtB-n",170],"l":8,"c":"location","b":[{"t":"a","x":"H370QEUdhFKdg7f8u1nfHg","l":"","i":["SCBH7mxNtB-n",206],"s":{"i":["SCBH7mxNtB-n",171],"a":"b"},"e":{"i":["SCBH7mxNtB-n",178],"a":"a"},"a":["c"]}],"a":[]},{"t":"t","i":["SCBH7mxNtB-n",179],"o":["SCBH7mxNtB-n",178],"l":24,"c":" 则存储 sector 位于哪一个 file 中"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"01378c9a-591b-4f45-9435-71fe10dd271f":{"value":{"id":"01378c9a-591b-4f45-9435-71fe10dd271f","version":7,"type":"text","format":{"copied_from_pointer":{"id":"0901e66f-afd6-4a1b-97ee-fb58c4050a8d","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734166,"last_edited_time":1724511734167,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"0901e66f-afd6-4a1b-97ee-fb58c4050a8d","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"Gg95I2vatEcPzD9FMcOa1w,\"start\",\"end\"","n":{"Gg95I2vatEcPzD9FMcOa1w,\"start\",\"end\"":{"s":{"x":"Gg95I2vatEcPzD9FMcOa1w","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"fa074d7b-3d93-4f53-a68d-d46949b39809":{"value":{"id":"fa074d7b-3d93-4f53-a68d-d46949b39809","version":9,"type":"text","properties":{"title":[["读写流程"]]},"format":{"copied_from_pointer":{"id":"0767aab3-a0fc-47f6-836f-8439af7bbada","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734018,"last_edited_time":1724511734019,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"0767aab3-a0fc-47f6-836f-8439af7bbada","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"yt2APP42vwNQ9BoPppR_Xg,\"start\",\"end\"","n":{"yt2APP42vwNQ9BoPppR_Xg,\"start\",\"end\"":{"s":{"x":"yt2APP42vwNQ9BoPppR_Xg","i":[{"t":"s"},{"t":"t","i":["-TUiQDAAVKB-",1],"o":"start","l":4,"c":"读写流程"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"e667a855-3d76-4888-b6c0-c4180da37b75":{"value":{"id":"e667a855-3d76-4888-b6c0-c4180da37b75","version":9,"type":"bulleted_list","properties":{"title":[["写入时先自增 revision，元数据中标为为 dirty，这里 revision 会落盘，但元数据不会。然后在 "],["diffDisk",[["c"]]],[" 只会写入最新的一层，即 live data 或 head，是原地写入的，同时更新索引。前面提到 sector 是写入最小单元，如果写入不够一个 sector，就会先读出原数据，修改后再写"]]},"format":{"copied_from_pointer":{"id":"51f4e867-b977-4b7a-beb4-b7c55070303c","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734597,"last_edited_time":1724511734598,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"51f4e867-b977-4b7a-beb4-b7c55070303c","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"-Fs5f7kPMdhFt9T2kK0edA,\"start\",\"end\"","n":{"-Fs5f7kPMdhFt9T2kK0edA,\"start\",\"end\"":{"s":{"x":"-Fs5f7kPMdhFt9T2kK0edA","i":[{"t":"s"},{"t":"t","i":["EMDJ1n8JABFC",1],"o":"start","l":57,"c":"写入时先自增 revision，元数据中标为为 dirty，这里 revision 会落盘，但元数据不会。然后在 "},{"t":"t","i":["EMDJ1n8JABFC",58],"o":["EMDJ1n8JABFC",57],"l":8,"c":"diffDisk","b":[{"t":"a","x":"-Fs5f7kPMdhFt9T2kK0edA","l":"","i":["EMDJ1n8JABFC",160],"s":{"i":["EMDJ1n8JABFC",58],"a":"b"},"e":{"i":["EMDJ1n8JABFC",65],"a":"a"},"a":["c"]}],"a":[]},{"t":"t","i":["EMDJ1n8JABFC",66],"o":["EMDJ1n8JABFC",65],"l":94,"c":" 只会写入最新的一层，即 live data 或 head，是原地写入的，同时更新索引。前面提到 sector 是写入最小单元，如果写入不够一个 sector，就会先读出原数据，修改后再写"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"b43e4711-0e5a-4c76-ab01-abd21773aa37":{"value":{"id":"b43e4711-0e5a-4c76-ab01-abd21773aa37","version":9,"type":"bulleted_list","properties":{"title":[["读取时从索引中找到 sector 对应第几层的 file，如果找到就直接去读。否则从新到旧的 file 查找，对于每一个 file 使用 FIEMAP ioctl 查询指定范围内是否存在 extent，是则说明 sector 位于这个 file 中，更新索引后读取"]]},"format":{"copied_from_pointer":{"id":"3a63c5fd-9d34-41ad-a2a4-54f1cd748b79","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734139,"last_edited_time":1724511734140,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"3a63c5fd-9d34-41ad-a2a4-54f1cd748b79","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"9dpLC4WLTNpJlr118Zt62w,\"start\",\"end\"","n":{"9dpLC4WLTNpJlr118Zt62w,\"start\",\"end\"":{"s":{"x":"9dpLC4WLTNpJlr118Zt62w","i":[{"t":"s"},{"t":"t","i":["dKe7ghtDXKiI",1],"o":"start","l":132,"c":"读取时从索引中找到 sector 对应第几层的 file，如果找到就直接去读。否则从新到旧的 file 查找，对于每一个 file 使用 FIEMAP ioctl 查询指定范围内是否存在 extent，是则说明 sector 位于这个 file 中，更新索引后读取"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"d00ff361-06d2-4fc2-aec6-4382971c546f":{"value":{"id":"d00ff361-06d2-4fc2-aec6-4382971c546f","version":7,"type":"text","format":{"copied_from_pointer":{"id":"dc9dafe4-321a-46e8-bf3b-bb09c77e596b","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734113,"last_edited_time":1724511734114,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"dc9dafe4-321a-46e8-bf3b-bb09c77e596b","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"nQbMfL6eSSDZbQEVibsCpw,\"start\",\"end\"","n":{"nQbMfL6eSSDZbQEVibsCpw,\"start\",\"end\"":{"s":{"x":"nQbMfL6eSSDZbQEVibsCpw","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"3477863d-f7d6-47a2-9e30-c35ff77d444a":{"value":{"id":"3477863d-f7d6-47a2-9e30-c35ff77d444a","version":9,"type":"text","properties":{"title":[["快照\u0026扩容流程"]]},"format":{"copied_from_pointer":{"id":"e7039d70-48eb-4891-9652-7c783e43a50f","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734638,"last_edited_time":1724511734639,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"e7039d70-48eb-4891-9652-7c783e43a50f","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"JE12vSl_Ccco_Qm7Y2Lxhg,\"start\",\"end\"","n":{"JE12vSl_Ccco_Qm7Y2Lxhg,\"start\",\"end\"":{"s":{"x":"JE12vSl_Ccco_Qm7Y2Lxhg","i":[{"t":"s"},{"t":"t","i":["vFTh9Jfd7avA",1],"o":"start","l":7,"c":"快照\u0026扩容流程"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"31eec863-4d57-4064-839f-5d742db75ef3":{"value":{"id":"31eec863-4d57-4064-839f-5d742db75ef3","version":9,"type":"bulleted_list","properties":{"title":[["快照：快照很简单，只是创建一个新的 head。删除就是将其内容覆盖到上一层 snapshot 中"]]},"format":{"copied_from_pointer":{"id":"a59d262a-c419-4799-b432-0d3824e01cff","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734162,"last_edited_time":1724511734163,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"a59d262a-c419-4799-b432-0d3824e01cff","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"z2BaBjRqY-FdaqaOfJrV9g,\"start\",\"end\"","n":{"z2BaBjRqY-FdaqaOfJrV9g,\"start\",\"end\"":{"s":{"x":"z2BaBjRqY-FdaqaOfJrV9g","i":[{"t":"s"},{"t":"t","i":["ybuDppONXSHS",1],"o":"start","l":48,"c":"快照：快照很简单，只是创建一个新的 head。删除就是将其内容覆盖到上一层 snapshot 中"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"6761eac0-8c07-4bf6-ac15-bb5702cabd8a":{"value":{"id":"6761eac0-8c07-4bf6-ac15-bb5702cabd8a","version":9,"type":"bulleted_list","properties":{"title":[["扩容：创建一个新的 head，相当于打了个快照，head 的大小被 truncate 为扩容后的大小，同时还需要修改元数据。由于 sector 变多了，"],["diffDisk",[["c"]]],[" 内的 "],["location",[["c"]]],[" 索引表也要扩容"]]},"format":{"copied_from_pointer":{"id":"ed66bfad-578c-4317-ba18-f87e97345e51","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734386,"last_edited_time":1724511734387,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"ed66bfad-578c-4317-ba18-f87e97345e51","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"q5TKZ71re1geHqYyaJJ-Ug,\"start\",\"end\"","n":{"q5TKZ71re1geHqYyaJJ-Ug,\"start\",\"end\"":{"s":{"x":"q5TKZ71re1geHqYyaJJ-Ug","i":[{"t":"s"},{"t":"t","i":["rbBoWTQoSOo6",1],"o":"start","l":76,"c":"扩容：创建一个新的 head，相当于打了个快照，head 的大小被 truncate 为扩容后的大小，同时还需要修改元数据。由于 sector 变多了，"},{"t":"t","i":["rbBoWTQoSOo6",77],"o":["rbBoWTQoSOo6",76],"l":8,"c":"diffDisk","b":[{"t":"a","x":"q5TKZ71re1geHqYyaJJ-Ug","l":"","i":["rbBoWTQoSOo6",105],"s":{"i":["rbBoWTQoSOo6",77],"a":"b"},"e":{"i":["rbBoWTQoSOo6",84],"a":"a"},"a":["c"]}],"a":[]},{"t":"t","i":["rbBoWTQoSOo6",85],"o":["rbBoWTQoSOo6",84],"l":4,"c":" 内的 "},{"t":"t","i":["rbBoWTQoSOo6",89],"o":["rbBoWTQoSOo6",88],"l":8,"c":"location","b":[{"t":"a","x":"q5TKZ71re1geHqYyaJJ-Ug","l":"","i":["rbBoWTQoSOo6",106],"s":{"i":["rbBoWTQoSOo6",89],"a":"b"},"e":{"i":["rbBoWTQoSOo6",96],"a":"a"},"a":["c"]}],"a":[]},{"t":"t","i":["rbBoWTQoSOo6",97],"o":["rbBoWTQoSOo6",96],"l":8,"c":" 索引表也要扩容"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"e209bbbc-c5a5-4a7c-a6cb-3196ca30f373":{"value":{"id":"e209bbbc-c5a5-4a7c-a6cb-3196ca30f373","version":7,"type":"text","format":{"copied_from_pointer":{"id":"9b5399be-0a09-442f-8674-aa568eca1614","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734260,"last_edited_time":1724511734261,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"9b5399be-0a09-442f-8674-aa568eca1614","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"R2RG7V882apS6FfpavLFjg,\"start\",\"end\"","n":{"R2RG7V882apS6FfpavLFjg,\"start\",\"end\"":{"s":{"x":"R2RG7V882apS6FfpavLFjg","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"5561d5c9-0b2b-4db6-a6ed-f1b47e382aa1":{"value":{"id":"5561d5c9-0b2b-4db6-a6ed-f1b47e382aa1","version":9,"type":"text","properties":{"title":[["一开始还以为 "],["diffDisk",[["c"]]],[" 会是类似 RocksDB 这种 LSM-Tree based 的存储引擎，但完全不是一回事。它没有存储引擎必须的各种功能，可以说只是一个能支持 snapshot 的数据格式"]]},"format":{"copied_from_pointer":{"id":"daf4b09f-b85d-4002-bf46-ad8cae06d35e","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734796,"last_edited_time":1724511734797,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"daf4b09f-b85d-4002-bf46-ad8cae06d35e","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"iC_tlPtoljwViqrX1UwdKg,\"start\",\"end\"","n":{"iC_tlPtoljwViqrX1UwdKg,\"start\",\"end\"":{"s":{"x":"iC_tlPtoljwViqrX1UwdKg","i":[{"t":"s"},{"t":"t","i":["pPQuDgPXCvTN",1],"o":"start","l":7,"c":"一开始还以为 "},{"t":"t","i":["pPQuDgPXCvTN",8],"o":["pPQuDgPXCvTN",7],"l":8,"c":"diffDisk","b":[{"t":"a","x":"iC_tlPtoljwViqrX1UwdKg","l":"","i":["pPQuDgPXCvTN",103],"s":{"i":["pPQuDgPXCvTN",8],"a":"b"},"e":{"i":["pPQuDgPXCvTN",15],"a":"a"},"a":["c"]}],"a":[]},{"t":"t","i":["pPQuDgPXCvTN",16],"o":["pPQuDgPXCvTN",15],"l":87,"c":" 会是类似 RocksDB 这种 LSM-Tree based 的存储引擎，但完全不是一回事。它没有存储引擎必须的各种功能，可以说只是一个能支持 snapshot 的数据格式"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"f9d9524d-f630-451b-a766-cb16c3c63f75":{"value":{"id":"f9d9524d-f630-451b-a766-cb16c3c63f75","version":9,"type":"text","properties":{"title":[["首先接口语义上，"],["diffDisk",[["c"]]],[" 是为块存储设计的，并不是 key-value 的，或者说 key 就是 offset；也没有删除接口，只有读和写。不过这也问题不大，块存储本身也没有“删除”的概念，真要添加删除接口也可以通过写入墓碑标记实现"]]},"format":{"copied_from_pointer":{"id":"64873e00-70a1-41cb-8cc3-cf487f004a01","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734125,"last_edited_time":1724511734126,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"64873e00-70a1-41cb-8cc3-cf487f004a01","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"nhM3J_aGdAvOEDloLXFyKQ,\"start\",\"end\"","n":{"nhM3J_aGdAvOEDloLXFyKQ,\"start\",\"end\"":{"s":{"x":"nhM3J_aGdAvOEDloLXFyKQ","i":[{"t":"s"},{"t":"t","i":["-Mau_Xo57TWC",1],"o":"start","l":8,"c":"首先接口语义上，"},{"t":"t","i":["-Mau_Xo57TWC",9],"o":["-Mau_Xo57TWC",8],"l":8,"c":"diffDisk","b":[{"t":"a","x":"nhM3J_aGdAvOEDloLXFyKQ","l":"","i":["-Mau_Xo57TWC",121],"s":{"i":["-Mau_Xo57TWC",9],"a":"b"},"e":{"i":["-Mau_Xo57TWC",16],"a":"a"},"a":["c"]}],"a":[]},{"t":"t","i":["-Mau_Xo57TWC",17],"o":["-Mau_Xo57TWC",16],"l":104,"c":" 是为块存储设计的，并不是 key-value 的，或者说 key 就是 offset；也没有删除接口，只有读和写。不过这也问题不大，块存储本身也没有“删除”的概念，真要添加删除接口也可以通过写入墓碑标记实现"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"071e3692-288c-4317-8c67-a3910049b00d":{"value":{"id":"071e3692-288c-4317-8c67-a3910049b00d","version":9,"type":"text","properties":{"title":[["diffDisk",[["c"]]],[" 中单个文件的数据布局和元数据维护是依赖文件系统的 extent 功能实现的，没有定义自己的格式。所以这套实现对文件系统有要求，需要支持 extent 功能，优点是文件很“干净“，这里如果没有 snapshot，实际上就是对单个文件的直接读写。但反之可以说没有任何优化，性能需要打个问号"]]},"format":{"copied_from_pointer":{"id":"f512c294-cfcb-401e-8487-b5df98c4bad8","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734682,"last_edited_time":1724511734683,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"f512c294-cfcb-401e-8487-b5df98c4bad8","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"yhwOzxBeV-pesCfGlUKXNw,\"start\",\"end\"","n":{"yhwOzxBeV-pesCfGlUKXNw,\"start\",\"end\"":{"s":{"x":"yhwOzxBeV-pesCfGlUKXNw","i":[{"t":"s"},{"t":"t","i":["GVM6vzuefHd6",1],"o":"start","l":8,"c":"diffDisk","b":[{"t":"a","x":"yhwOzxBeV-pesCfGlUKXNw","l":"","i":["GVM6vzuefHd6",152],"s":{"i":["GVM6vzuefHd6",1],"a":"b"},"e":{"i":["GVM6vzuefHd6",8],"a":"a"},"a":["c"]}],"a":[]},{"t":"t","i":["GVM6vzuefHd6",9],"o":["GVM6vzuefHd6",8],"l":143,"c":" 中单个文件的数据布局和元数据维护是依赖文件系统的 extent 功能实现的，没有定义自己的格式。所以这套实现对文件系统有要求，需要支持 extent 功能，优点是文件很“干净“，这里如果没有 snapshot，实际上就是对单个文件的直接读写。但反之可以说没有任何优化，性能需要打个问号"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"d7a2c34e-356e-42d0-a698-3d2151404de8":{"value":{"id":"d7a2c34e-356e-42d0-a698-3d2151404de8","version":9,"type":"text","properties":{"title":[["同时它没有 WAL，无法保证崩溃一致性。这种情况需要 rebuild，更不用提快照（revision）读和事务之类的功能了。rebuild 这些操作都依赖上层控制面触发，后续会提到"]]},"format":{"copied_from_pointer":{"id":"a7898ba9-6733-49ac-9cc9-15188d965cbf","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511735915,"last_edited_time":1724511735916,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"a7898ba9-6733-49ac-9cc9-15188d965cbf","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"4yvx9vAtB2ZL_EEhXlqE5w,\"start\",\"end\"","n":{"4yvx9vAtB2ZL_EEhXlqE5w,\"start\",\"end\"":{"s":{"x":"4yvx9vAtB2ZL_EEhXlqE5w","i":[{"t":"s"},{"t":"t","i":["9CRsVVxr_hhE",1],"o":"start","l":90,"c":"同时它没有 WAL，无法保证崩溃一致性。这种情况需要 rebuild，更不用提快照（revision）读和事务之类的功能了。rebuild 这些操作都依赖上层控制面触发，后续会提到"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"80f037a7-48eb-4cde-ad71-a0cad980a13e":{"value":{"id":"80f037a7-48eb-4cde-ad71-a0cad980a13e","version":7,"type":"text","format":{"copied_from_pointer":{"id":"476adc7e-94b4-43c7-a658-9926e77663b4","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734230,"last_edited_time":1724511734231,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"476adc7e-94b4-43c7-a658-9926e77663b4","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"U4t4q9Z7A-zNR4lfR_aVJA,\"start\",\"end\"","n":{"U4t4q9Z7A-zNR4lfR_aVJA,\"start\",\"end\"":{"s":{"x":"U4t4q9Z7A-zNR4lfR_aVJA","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"68047b47-005d-4e7f-8dc2-ec22c348a0ce":{"value":{"id":"68047b47-005d-4e7f-8dc2-ec22c348a0ce","version":9,"type":"sub_header","properties":{"title":[["Controller"]]},"format":{"copied_from_pointer":{"id":"fef857d8-fd87-43e3-8c73-a01af876b421","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734818,"last_edited_time":1724511734819,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"fef857d8-fd87-43e3-8c73-a01af876b421","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"TVVxRhXYc9idLdChTK1nGQ,\"start\",\"end\"","n":{"TVVxRhXYc9idLdChTK1nGQ,\"start\",\"end\"":{"s":{"x":"TVVxRhXYc9idLdChTK1nGQ","i":[{"t":"s"},{"t":"t","i":["cNQZSRJw0NIR",1],"o":"start","l":10,"c":"Controller"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"5b30fff5-ac85-4766-8a0e-4cc9e4e63060":{"value":{"id":"5b30fff5-ac85-4766-8a0e-4cc9e4e63060","version":9,"type":"text","properties":{"title":[["Controller 负责整个 volume 视角的读写，它被调度在和最终 client 的 Pod 相同的节点上，从 frontend 中接受读写请求，往后连接到一个或多个 replica 上，将读写转发给这些 replica"]]},"format":{"copied_from_pointer":{"id":"b1900725-8970-43b3-8c6d-c3f69c9ee12e","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734718,"last_edited_time":1724511734719,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"b1900725-8970-43b3-8c6d-c3f69c9ee12e","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"MBUVcynkUvLf0Oo14nEmqg,\"start\",\"end\"","n":{"MBUVcynkUvLf0Oo14nEmqg,\"start\",\"end\"":{"s":{"x":"MBUVcynkUvLf0Oo14nEmqg","i":[{"t":"s"},{"t":"t","i":["jew97McwRFpd",1],"o":"start","l":114,"c":"Controller 负责整个 volume 视角的读写，它被调度在和最终 client 的 Pod 相同的节点上，从 frontend 中接受读写请求，往后连接到一个或多个 replica 上，将读写转发给这些 replica"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"b740d7c8-ba6b-4d0d-bf45-00769d6b8fa1":{"value":{"id":"b740d7c8-ba6b-4d0d-bf45-00769d6b8fa1","version":9,"type":"text","properties":{"title":[["为了避免和 K8s 中的 Controller 混淆，后面都直接称这个 Controller 为 Engine"]]},"format":{"copied_from_pointer":{"id":"bea182c8-f81c-4c46-8288-f89062b9f6d2","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511735772,"last_edited_time":1724511735773,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"bea182c8-f81c-4c46-8288-f89062b9f6d2","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"GAVFHp1LOR2RWvJexqHZ0Q,\"start\",\"end\"","n":{"GAVFHp1LOR2RWvJexqHZ0Q,\"start\",\"end\"":{"s":{"x":"GAVFHp1LOR2RWvJexqHZ0Q","i":[{"t":"s"},{"t":"t","i":["3N48JhTRu_Gz",1],"o":"start","l":55,"c":"为了避免和 K8s 中的 Controller 混淆，后面都直接称这个 Controller 为 Engine"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"6080c1ce-0625-443b-a0dc-fc07904694e3":{"value":{"id":"6080c1ce-0625-443b-a0dc-fc07904694e3","version":9,"type":"image","properties":{"size":[["65.8KB"]],"title":[["Untitled"]],"source":[["https://prod-files-secure.s3.us-west-2.amazonaws.com/4cc04375-345a-4a1e-bdf0-3a7c88ef0425/d7d422a8-aa34-4ff3-b059-b898eb14bf56/Untitled.png"]]},"format":{"block_width":528,"display_source":"https://prod-files-secure.s3.us-west-2.amazonaws.com/4cc04375-345a-4a1e-bdf0-3a7c88ef0425/d7d422a8-aa34-4ff3-b059-b898eb14bf56/Untitled.png","block_full_width":false,"block_page_width":false,"block_aspect_ratio":0.5862492326580724,"copied_from_pointer":{"id":"b0f76178-8936-47d7-9173-db55d5c81521","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"},"block_preserve_scale":true},"created_time":1724511734126,"last_edited_time":1724511734127,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"b0f76178-8936-47d7-9173-db55d5c81521","file_ids":["d7d422a8-aa34-4ff3-b059-b898eb14bf56"],"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"Ar_a7vcZVtqBsXyh7a6QAA,\"start\",\"end\"","n":{"Ar_a7vcZVtqBsXyh7a6QAA,\"start\",\"end\"":{"s":{"x":"Ar_a7vcZVtqBsXyh7a6QAA","i":[{"t":"s"},{"t":"t","i":["9mSk1YrcLNas",1],"o":"start","l":8,"c":"Untitled"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"b15c19b2-7cf1-414e-8771-0ef828778f27":{"value":{"id":"b15c19b2-7cf1-414e-8771-0ef828778f27","version":7,"type":"text","format":{"copied_from_pointer":{"id":"253ee014-76e0-4ae6-95c5-c6ff299e7a8e","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734238,"last_edited_time":1724511734239,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"253ee014-76e0-4ae6-95c5-c6ff299e7a8e","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"4atMNwvfAMfeu4QIFvynPA,\"start\",\"end\"","n":{"4atMNwvfAMfeu4QIFvynPA,\"start\",\"end\"":{"s":{"x":"4atMNwvfAMfeu4QIFvynPA","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"845f783b-6e76-4863-80cb-a501c2ab288e":{"value":{"id":"845f783b-6e76-4863-80cb-a501c2ab288e","version":9,"type":"text","properties":{"title":[["Engine 启动时会监听一个 UDS（"],["/var/run/longhorn-{volume-name}.sock",[["c"]]],["），同时创建 frontend，frontend 实际上就是一个 iSCSI Target，通过"],["定制的 tgtd",[["a","https://github.com/rancher/tgt"]]],[" 创建，这个定制 tgtd 做的工作不多，主要是能支持将 iSCSI 流量包装成 Longhorn 自己的一个简单协议转发到前面的 UDS 中"]]},"format":{"copied_from_pointer":{"id":"7e1eed84-df8f-4066-b13a-2e1371b846c3","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734234,"last_edited_time":1724511734235,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"7e1eed84-df8f-4066-b13a-2e1371b846c3","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"ksUcf_qfzq95mmlB_VUguw,\"start\",\"end\"","n":{"ksUcf_qfzq95mmlB_VUguw,\"start\",\"end\"":{"s":{"x":"ksUcf_qfzq95mmlB_VUguw","i":[{"t":"s"},{"t":"t","i":["6PMJl3hylsac",1],"o":"start","l":20,"c":"Engine 启动时会监听一个 UDS（"},{"t":"t","i":["6PMJl3hylsac",21],"o":["6PMJl3hylsac",20],"l":36,"c":"/var/run/longhorn-{volume-name}.sock","b":[{"t":"a","x":"ksUcf_qfzq95mmlB_VUguw","l":"","i":["6PMJl3hylsac",184],"s":{"i":["6PMJl3hylsac",21],"a":"b"},"e":{"i":["6PMJl3hylsac",56],"a":"a"},"a":["c"]}],"a":[]},{"t":"t","i":["6PMJl3hylsac",57],"o":["6PMJl3hylsac",56],"l":48,"c":"），同时创建 frontend，frontend 实际上就是一个 iSCSI Target，通过"},{"t":"t","i":["6PMJl3hylsac",105],"o":["6PMJl3hylsac",104],"l":8,"c":"定制的 tgtd","b":[{"t":"a","x":"ksUcf_qfzq95mmlB_VUguw","l":"","i":["6PMJl3hylsac",185],"s":{"i":["6PMJl3hylsac",105],"a":"b"},"e":{"i":["6PMJl3hylsac",112],"a":"a"},"a":["a","https://github.com/rancher/tgt"]}],"a":[]},{"t":"t","i":["6PMJl3hylsac",113],"o":["6PMJl3hylsac",112],"l":71,"c":" 创建，这个定制 tgtd 做的工作不多，主要是能支持将 iSCSI 流量包装成 Longhorn 自己的一个简单协议转发到前面的 UDS 中"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"bfb2ab66-dca2-4e3e-963f-0d9cdbe5db92":{"value":{"id":"bfb2ab66-dca2-4e3e-963f-0d9cdbe5db92","version":9,"type":"text","properties":{"title":[["协议结构如下："]]},"format":{"copied_from_pointer":{"id":"50fac533-6215-4d1f-9989-002a4e32cb4d","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734132,"last_edited_time":1724511734133,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"50fac533-6215-4d1f-9989-002a4e32cb4d","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"vkjL7h8VCFQGoPzJWsA0Kw,\"start\",\"end\"","n":{"vkjL7h8VCFQGoPzJWsA0Kw,\"start\",\"end\"":{"s":{"x":"vkjL7h8VCFQGoPzJWsA0Kw","i":[{"t":"s"},{"t":"t","i":["16V0n2O96aMD",1],"o":"start","l":7,"c":"协议结构如下："},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"ff3f6104-8866-4df0-9eb3-fa7ca05b1226":{"value":{"id":"ff3f6104-8866-4df0-9eb3-fa7ca05b1226","version":9,"type":"code","properties":{"title":[["type Message struct {\n\tMagicVersion uint16\n\tSeq          uint32\n\tType         uint32\n\tOffset       int64\n\tSize         uint32\n\tData         []byte\n}\n\nconst (\n\tTypeRead = iota\n\tTypeWrite\n\tTypeResponse\n\tTypeError\n\tTypeEOF\n\tTypeClose\n\tTypePing\n\tTypeUnmap\n)\n\nconst (\n\tMagicVersion = uint16(0x1b01) // LongHorn01\n)"]],"language":[["Go"]]},"format":{"copied_from_pointer":{"id":"05218b19-0a87-417e-8a10-44cf4d3ea286","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734240,"last_edited_time":1724511734241,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"05218b19-0a87-417e-8a10-44cf4d3ea286","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"AFaD385GdExoggu1wvgL2A,\"start\",\"end\"","n":{"AFaD385GdExoggu1wvgL2A,\"start\",\"end\"":{"s":{"x":"AFaD385GdExoggu1wvgL2A","i":[{"t":"s"},{"t":"t","i":["qNHhezDzB7AC",1],"o":"start","l":309,"c":"type Message struct {\n\tMagicVersion uint16\n\tSeq          uint32\n\tType         uint32\n\tOffset       int64\n\tSize         uint32\n\tData         []byte\n}\n\nconst (\n\tTypeRead = iota\n\tTypeWrite\n\tTypeResponse\n\tTypeError\n\tTypeEOF\n\tTypeClose\n\tTypePing\n\tTypeUnmap\n)\n\nconst (\n\tMagicVersion = uint16(0x1b01) // LongHorn01\n)"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"f58864b6-b95c-4ceb-8dd8-d8f6fea37fe8":{"value":{"id":"f58864b6-b95c-4ceb-8dd8-d8f6fea37fe8","version":9,"type":"text","properties":{"title":[["有了 iSCSI Target 后，还需要启动 iSCSI Initator 连接这个 Target，这步的目的是需要创建出一个块设备，然后通过 mknod 指定相同的主次设备号再创建出 "],["/dev/longhorn/{vol_name}",[["c"]]],["。这就是 client 最终直接操作的设备，对它的 I/O 会一路到 Initator → Target → UDS 上。到此 frontend 就算创建完成"]]},"format":{"copied_from_pointer":{"id":"eb299394-78a1-43bf-a348-68a48ae757ff","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734154,"last_edited_time":1724511734155,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"eb299394-78a1-43bf-a348-68a48ae757ff","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"whWNF1ygz8bwP0s1zKJUyQ,\"start\",\"end\"","n":{"whWNF1ygz8bwP0s1zKJUyQ,\"start\",\"end\"":{"s":{"x":"whWNF1ygz8bwP0s1zKJUyQ","i":[{"t":"s"},{"t":"t","i":["9tMmhD0fttgS",1],"o":"start","l":94,"c":"有了 iSCSI Target 后，还需要启动 iSCSI Initator 连接这个 Target，这步的目的是需要创建出一个块设备，然后通过 mknod 指定相同的主次设备号再创建出 "},{"t":"t","i":["9tMmhD0fttgS",95],"o":["9tMmhD0fttgS",94],"l":24,"c":"/dev/longhorn/{vol_name}","b":[{"t":"a","x":"whWNF1ygz8bwP0s1zKJUyQ","l":"","i":["9tMmhD0fttgS",198],"s":{"i":["9tMmhD0fttgS",95],"a":"b"},"e":{"i":["9tMmhD0fttgS",118],"a":"a"},"a":["c"]}],"a":[]},{"t":"t","i":["9tMmhD0fttgS",119],"o":["9tMmhD0fttgS",118],"l":79,"c":"。这就是 client 最终直接操作的设备，对它的 I/O 会一路到 Initator → Target → UDS 上。到此 frontend 就算创建完成"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"ec72c51e-3484-49f6-9c3c-afe735b4ec2c":{"value":{"id":"ec72c51e-3484-49f6-9c3c-afe735b4ec2c","version":7,"type":"text","format":{"copied_from_pointer":{"id":"3689e87d-081b-4336-a9e7-428888a5fe51","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734135,"last_edited_time":1724511734136,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"3689e87d-081b-4336-a9e7-428888a5fe51","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"9MHYOoSAnIGAMuM2luKq9w,\"start\",\"end\"","n":{"9MHYOoSAnIGAMuM2luKq9w,\"start\",\"end\"":{"s":{"x":"9MHYOoSAnIGAMuM2luKq9w","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"8a914f1f-eca0-4c7e-ac4c-fd909ab9f4b3":{"value":{"id":"8a914f1f-eca0-4c7e-ac4c-fd909ab9f4b3","version":9,"type":"text","properties":{"title":[["Engine 之后为 volume 的每一个 replica 创建对应的 backend(replicator)，并维持心跳。会从前面监听的 UDS 中解析协议并转发给 replica"]]},"format":{"copied_from_pointer":{"id":"9b1dc418-25bd-42c4-80bf-72a34b6d6bb5","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734149,"last_edited_time":1724511734150,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"9b1dc418-25bd-42c4-80bf-72a34b6d6bb5","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"-c9rTpu6OCVzZpGtWCsMDQ,\"start\",\"end\"","n":{"-c9rTpu6OCVzZpGtWCsMDQ,\"start\",\"end\"":{"s":{"x":"-c9rTpu6OCVzZpGtWCsMDQ","i":[{"t":"s"},{"t":"t","i":["sWAe1jQbu-fs",1],"o":"start","l":92,"c":"Engine 之后为 volume 的每一个 replica 创建对应的 backend(replicator)，并维持心跳。会从前面监听的 UDS 中解析协议并转发给 replica"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"f08581e6-2d68-4580-b789-2a44743bc72e":{"value":{"id":"f08581e6-2d68-4580-b789-2a44743bc72e","version":9,"type":"text","properties":{"title":[["具体读写上 Engine 通过一个读写锁控制并发，read 只要任一一个 replica 成功即可，用的 round-robin 的策略做 balance。write 和 unmap 等操作是并发执行的，要求全部成功。IOPS 之类的监控和统计也在这个层级实现"]]},"format":{"copied_from_pointer":{"id":"9a670693-d9ef-4e3e-9882-1e101167f6bc","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734206,"last_edited_time":1724511734207,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"9a670693-d9ef-4e3e-9882-1e101167f6bc","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"Kvz17l1RYVFUw3Pq7IBYKg,\"start\",\"end\"","n":{"Kvz17l1RYVFUw3Pq7IBYKg,\"start\",\"end\"":{"s":{"x":"Kvz17l1RYVFUw3Pq7IBYKg","i":[{"t":"s"},{"t":"t","i":["A8Wdf6N9_Tgp",1],"o":"start","l":130,"c":"具体读写上 Engine 通过一个读写锁控制并发，read 只要任一一个 replica 成功即可，用的 round-robin 的策略做 balance。write 和 unmap 等操作是并发执行的，要求全部成功。IOPS 之类的监控和统计也在这个层级实现"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"2cb0b408-91c0-483a-a64e-f60bdccf5026":{"value":{"id":"2cb0b408-91c0-483a-a64e-f60bdccf5026","version":9,"type":"text","properties":{"title":[["最后 Engine 会再启动一个 grpc server，处理控制流，例如卷扩容、快照等命令，也是通过 backend(replicator) 转发到 replica 上执行的。当然，这里调用的是处理控制流的 grpc server"]]},"format":{"copied_from_pointer":{"id":"1f8e10c5-6387-418d-a097-dd9a3ea55bf5","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734495,"last_edited_time":1724511734496,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"1f8e10c5-6387-418d-a097-dd9a3ea55bf5","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"kA8nOlAlVFi5pd9ralcaDg,\"start\",\"end\"","n":{"kA8nOlAlVFi5pd9ralcaDg,\"start\",\"end\"":{"s":{"x":"kA8nOlAlVFi5pd9ralcaDg","i":[{"t":"s"},{"t":"t","i":["8FZuTKLdbbWe",1],"o":"start","l":116,"c":"最后 Engine 会再启动一个 grpc server，处理控制流，例如卷扩容、快照等命令，也是通过 backend(replicator) 转发到 replica 上执行的。当然，这里调用的是处理控制流的 grpc server"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"88d58d5b-4d6f-4a50-b3ec-76d208033133":{"value":{"id":"88d58d5b-4d6f-4a50-b3ec-76d208033133","version":7,"type":"text","format":{"copied_from_pointer":{"id":"1a3d308a-0b25-4f6e-a9b1-f0a725520951","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734161,"last_edited_time":1724511734162,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"1a3d308a-0b25-4f6e-a9b1-f0a725520951","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"LA649Vj0Ame810V4ldu5sw,\"start\",\"end\"","n":{"LA649Vj0Ame810V4ldu5sw,\"start\",\"end\"":{"s":{"x":"LA649Vj0Ame810V4ldu5sw","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"dfa25c88-d5f3-4517-97c3-60a81e00e59a":{"value":{"id":"dfa25c88-d5f3-4517-97c3-60a81e00e59a","version":9,"type":"text","properties":{"title":[["这里有一个优化，如果 volume 只有一个 replica（单副本）且设置了 struct local 模式。Manager 会将 replica 调度到和 Engine 同一个节点上。Engine 在创建 backend 时就会通过 UDS 连接而不是 TCP 连接。这种本地化的策略能够有效提升 IOPS 和改善延迟，不过这里约束了只能用单副本，限制比较大"]]},"format":{"copied_from_pointer":{"id":"06387df6-d5a2-4ae7-b6a9-a6fc3a7a5320","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734261,"last_edited_time":1724511734262,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"06387df6-d5a2-4ae7-b6a9-a6fc3a7a5320","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"Tf_rZSxPBTnqeS6qQdqVbA,\"start\",\"end\"","n":{"Tf_rZSxPBTnqeS6qQdqVbA,\"start\",\"end\"":{"s":{"x":"Tf_rZSxPBTnqeS6qQdqVbA","i":[{"t":"s"},{"t":"t","i":["4betYzdXCTZJ",1],"o":"start","l":181,"c":"这里有一个优化，如果 volume 只有一个 replica（单副本）且设置了 struct local 模式。Manager 会将 replica 调度到和 Engine 同一个节点上。Engine 在创建 backend 时就会通过 UDS 连接而不是 TCP 连接。这种本地化的策略能够有效提升 IOPS 和改善延迟，不过这里约束了只能用单副本，限制比较大"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"d1435b2b-c5a7-4434-8d36-15e683aebc70":{"value":{"id":"d1435b2b-c5a7-4434-8d36-15e683aebc70","version":9,"type":"text","properties":{"title":[["虽然 Engine 自身是单点，但是它运行在和 client 相同的节点上，因此如果节点故障，一般 client 也会同时不可用，是个不错的策略"]]},"format":{"copied_from_pointer":{"id":"518ae1c5-c0dd-48d9-9968-73eeee1a3707","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511735758,"last_edited_time":1724511735759,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"518ae1c5-c0dd-48d9-9968-73eeee1a3707","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"4Jl4eXD92hwmWayud7hT5A,\"start\",\"end\"","n":{"4Jl4eXD92hwmWayud7hT5A,\"start\",\"end\"":{"s":{"x":"4Jl4eXD92hwmWayud7hT5A","i":[{"t":"s"},{"t":"t","i":["YQSPkGmIZMV7",1],"o":"start","l":72,"c":"虽然 Engine 自身是单点，但是它运行在和 client 相同的节点上，因此如果节点故障，一般 client 也会同时不可用，是个不错的策略"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"9d5c6878-fd17-43ff-bc06-d9bf48d7ae83":{"value":{"id":"9d5c6878-fd17-43ff-bc06-d9bf48d7ae83","version":7,"type":"text","format":{"copied_from_pointer":{"id":"8ba51840-ab0f-496f-9086-14a40cbbb318","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734241,"last_edited_time":1724511734242,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"8ba51840-ab0f-496f-9086-14a40cbbb318","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"Co7ExiDee96pIMoVm8_Gkg,\"start\",\"end\"","n":{"Co7ExiDee96pIMoVm8_Gkg,\"start\",\"end\"":{"s":{"x":"Co7ExiDee96pIMoVm8_Gkg","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"1f5cc878-3c96-4b37-8a81-a49efab11384":{"value":{"id":"1f5cc878-3c96-4b37-8a81-a49efab11384","version":9,"type":"header","properties":{"title":[["Manager"]]},"format":{"copied_from_pointer":{"id":"a1518bfb-bc3c-40ef-a9b7-309ef245af04","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734275,"last_edited_time":1724511734276,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"a1518bfb-bc3c-40ef-a9b7-309ef245af04","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"u2YvSaY2hf4IMrF-IWo9cw,\"start\",\"end\"","n":{"u2YvSaY2hf4IMrF-IWo9cw,\"start\",\"end\"":{"s":{"x":"u2YvSaY2hf4IMrF-IWo9cw","i":[{"t":"s"},{"t":"t","i":["cQinXtU5U8Pe",1],"o":"start","l":7,"c":"Manager"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"a6622edd-4b28-456a-8263-1d11a44b11d6":{"value":{"id":"a6622edd-4b28-456a-8263-1d11a44b11d6","version":9,"type":"text","properties":{"title":[["一开始提到，Longhorn 的控制面是作为 K8s Operator 实现的，称为 Manager。Longhorn 里所有元数据，包括 Engine 和 Replica 都以 CRD 呈现。"]]},"format":{"copied_from_pointer":{"id":"0d9b510c-70d2-4506-9797-718c6e0cb3dd","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734484,"last_edited_time":1724511734485,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"0d9b510c-70d2-4506-9797-718c6e0cb3dd","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"YZUj2jTk1U7TQbI2jEu-Dw,\"start\",\"end\"","n":{"YZUj2jTk1U7TQbI2jEu-Dw,\"start\",\"end\"":{"s":{"x":"YZUj2jTk1U7TQbI2jEu-Dw","i":[{"t":"s"},{"t":"t","i":["knxeg72yPBXO",1],"o":"start","l":97,"c":"一开始提到，Longhorn 的控制面是作为 K8s Operator 实现的，称为 Manager。Longhorn 里所有元数据，包括 Engine 和 Replica 都以 CRD 呈现。"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"493cb66e-845a-4ecd-852d-50700e1ee1ac":{"value":{"id":"493cb66e-845a-4ecd-852d-50700e1ee1ac","version":9,"type":"text","properties":{"title":[["这套方案的优点是很多东西都能依赖 K8s 的能力提供和管理，还能很好地融入生态。但同样很多元数据操作的链路都要通过 K8s，感觉还是会比较慢，也限制了规模和能力"]]},"format":{"copied_from_pointer":{"id":"9b269fc5-8002-4d76-8d9c-36195770807f","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734220,"last_edited_time":1724511734221,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"9b269fc5-8002-4d76-8d9c-36195770807f","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"q1bByXfV2LcUmTOr04CHvA,\"start\",\"end\"","n":{"q1bByXfV2LcUmTOr04CHvA,\"start\",\"end\"":{"s":{"x":"q1bByXfV2LcUmTOr04CHvA","i":[{"t":"s"},{"t":"t","i":["38mcTqeG2kpz",1],"o":"start","l":80,"c":"这套方案的优点是很多东西都能依赖 K8s 的能力提供和管理，还能很好地融入生态。但同样很多元数据操作的链路都要通过 K8s，感觉还是会比较慢，也限制了规模和能力"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"7ec3e975-990b-4556-8d81-90e2e4baaba9":{"value":{"id":"7ec3e975-990b-4556-8d81-90e2e4baaba9","version":7,"type":"text","format":{"copied_from_pointer":{"id":"c182fcbf-0ba9-4c24-a3e2-4450024c32af","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734145,"last_edited_time":1724511734146,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"c182fcbf-0ba9-4c24-a3e2-4450024c32af","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"kLYzeNj268pjeU9mNSaoAQ,\"start\",\"end\"","n":{"kLYzeNj268pjeU9mNSaoAQ,\"start\",\"end\"":{"s":{"x":"kLYzeNj268pjeU9mNSaoAQ","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"5302560a-92db-4fe1-828e-e3481a827c60":{"value":{"id":"5302560a-92db-4fe1-828e-e3481a827c60","version":9,"type":"sub_header","properties":{"title":[["rebuild \u0026 add replica"]]},"format":{"copied_from_pointer":{"id":"0c927ddd-1c5c-4098-bd3f-8517a24273d8","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734282,"last_edited_time":1724511734283,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"0c927ddd-1c5c-4098-bd3f-8517a24273d8","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"4L-YSEkcdUFzO45jGHCk1g,\"start\",\"end\"","n":{"4L-YSEkcdUFzO45jGHCk1g,\"start\",\"end\"":{"s":{"x":"4L-YSEkcdUFzO45jGHCk1g","i":[{"t":"s"},{"t":"t","i":["NF5jTx0Q5K-5",1],"o":"start","l":21,"c":"rebuild \u0026 add replica"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"fbd6f38a-b64f-4cc0-9772-0f73a67f3d07":{"value":{"id":"fbd6f38a-b64f-4cc0-9772-0f73a67f3d07","version":9,"type":"text","properties":{"title":[["如果 Engine 到某个 replica 心跳失败或读写或控制流命令错误，或发现 replica 的 revision 不是最新的，这个 replica 的 mode 就被设置为 ERR 不再读写"]]},"format":{"copied_from_pointer":{"id":"0591e9bb-1b07-40ed-a8c9-f0fbef3e3589","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734406,"last_edited_time":1724511734407,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"0591e9bb-1b07-40ed-a8c9-f0fbef3e3589","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"cCAyIKXlbBC7yDPClw-rtw,\"start\",\"end\"","n":{"cCAyIKXlbBC7yDPClw-rtw,\"start\",\"end\"":{"s":{"x":"cCAyIKXlbBC7yDPClw-rtw","i":[{"t":"s"},{"t":"t","i":["q1fOjUV1lhg3",1],"o":"start","l":99,"c":"如果 Engine 到某个 replica 心跳失败或读写或控制流命令错误，或发现 replica 的 revision 不是最新的，这个 replica 的 mode 就被设置为 ERR 不再读写"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"12a5cdc8-ab43-4bb8-b1f6-86b36052524b":{"value":{"id":"12a5cdc8-ab43-4bb8-b1f6-86b36052524b","version":9,"type":"text","properties":{"title":[["Manager 中的 monitor 会定时请求 Engine 中处理控制流的 grpc server 获取其所有的 replica 信息，更新到 Engine CR 的 status 中。因此当在 Manager 中的 Engine Controller 对该 Engin CR 进行 reconcile 时就能检测到 replica 处于 ERR mode 或不存在，调用 Engine 触发 rebuild"]]},"format":{"copied_from_pointer":{"id":"b2814c40-865c-4fdf-9720-9a7902b94137","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734687,"last_edited_time":1724511734688,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"b2814c40-865c-4fdf-9720-9a7902b94137","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"f4PJyKa6xg61s_xxzv-TMw,\"start\",\"end\"","n":{"f4PJyKa6xg61s_xxzv-TMw,\"start\",\"end\"":{"s":{"x":"f4PJyKa6xg61s_xxzv-TMw","i":[{"t":"s"},{"t":"t","i":["g75pgLxMsJY4",1],"o":"start","l":206,"c":"Manager 中的 monitor 会定时请求 Engine 中处理控制流的 grpc server 获取其所有的 replica 信息，更新到 Engine CR 的 status 中。因此当在 Manager 中的 Engine Controller 对该 Engin CR 进行 reconcile 时就能检测到 replica 处于 ERR mode 或不存在，调用 Engine 触发 rebuild"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"a729190e-0c85-4c5d-afeb-d900206f656c":{"value":{"id":"a729190e-0c85-4c5d-afeb-d900206f656c","version":7,"type":"text","format":{"copied_from_pointer":{"id":"49ac31e1-e9e9-4e80-82e4-c69f7ce9304b","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734624,"last_edited_time":1724511734625,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"49ac31e1-e9e9-4e80-82e4-c69f7ce9304b","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"yGZFO1DXOOGmllpH765xWw,\"start\",\"end\"","n":{"yGZFO1DXOOGmllpH765xWw,\"start\",\"end\"":{"s":{"x":"yGZFO1DXOOGmllpH765xWw","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"a55f5c5f-9ae5-4823-bde0-1f309bb0d7d0":{"value":{"id":"a55f5c5f-9ae5-4823-bde0-1f309bb0d7d0","version":9,"type":"text","properties":{"title":[["V1 Engine 的 rebuild 最终执行了 AddReplica Task，所以 rebuild 实际上流程和新增 replica 一致"]]},"format":{"copied_from_pointer":{"id":"e5b3cc79-59de-4dd5-bf57-e0c9e0c23140","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511736096,"last_edited_time":1724511736097,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"e5b3cc79-59de-4dd5-bf57-e0c9e0c23140","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"8wkI3aUI7rvnGG6m2jiUwQ,\"start\",\"end\"","n":{"8wkI3aUI7rvnGG6m2jiUwQ,\"start\",\"end\"":{"s":{"x":"8wkI3aUI7rvnGG6m2jiUwQ","i":[{"t":"s"},{"t":"t","i":["TmeFRGfOymKb",1],"o":"start","l":72,"c":"V1 Engine 的 rebuild 最终执行了 AddReplica Task，所以 rebuild 实际上流程和新增 replica 一致"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"5385dda7-4bc5-4d37-a1fd-dff3b825b70e":{"value":{"id":"5385dda7-4bc5-4d37-a1fd-dff3b825b70e","version":9,"type":"bulleted_list","properties":{"title":[["Engine 在创建新 replica 之前，会先对其他 replica 打一个快照，然后创建一个 WO（仅写入）模式的新 replica，因此它马上就可以接收写入"]]},"format":{"copied_from_pointer":{"id":"59ab7be1-8c44-47d4-b282-338cc0c40ad4","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734271,"last_edited_time":1724511734272,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"59ab7be1-8c44-47d4-b282-338cc0c40ad4","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"ZWoVpPyrbkTYCGuTAJWyOA,\"start\",\"end\"","n":{"ZWoVpPyrbkTYCGuTAJWyOA,\"start\",\"end\"":{"s":{"x":"ZWoVpPyrbkTYCGuTAJWyOA","i":[{"t":"s"},{"t":"t","i":["SuNqNUy3jryW",1],"o":"start","l":82,"c":"Engine 在创建新 replica 之前，会先对其他 replica 打一个快照，然后创建一个 WO（仅写入）模式的新 replica，因此它马上就可以接收写入"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"badafa3b-b61f-439b-b6af-239a9545bd51":{"value":{"id":"badafa3b-b61f-439b-b6af-239a9545bd51","version":9,"type":"bulleted_list","properties":{"title":[["然后从已有的 replica 中将 "],["diffDisk",[["c"]]],[" 的元数据和剩下 snapshot 给 sync 过去。在 sync 完成后，通知 Engine 重新检验合法性，此时 replica 正式可用，设置回 RW 模式，启动对新 replica 的心跳"]]},"format":{"copied_from_pointer":{"id":"199cc200-d2d3-4b5d-a9ce-139596d29ea1","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734226,"last_edited_time":1724511734227,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"199cc200-d2d3-4b5d-a9ce-139596d29ea1","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"8xnVnUnGJNkmogPTLi5s3g,\"start\",\"end\"","n":{"8xnVnUnGJNkmogPTLi5s3g,\"start\",\"end\"":{"s":{"x":"8xnVnUnGJNkmogPTLi5s3g","i":[{"t":"s"},{"t":"t","i":["prCNYRboDA8d",1],"o":"start","l":18,"c":"然后从已有的 replica 中将 "},{"t":"t","i":["prCNYRboDA8d",19],"o":["prCNYRboDA8d",18],"l":8,"c":"diffDisk","b":[{"t":"a","x":"8xnVnUnGJNkmogPTLi5s3g","l":"","i":["prCNYRboDA8d",126],"s":{"i":["prCNYRboDA8d",19],"a":"b"},"e":{"i":["prCNYRboDA8d",26],"a":"a"},"a":["c"]}],"a":[]},{"t":"t","i":["prCNYRboDA8d",27],"o":["prCNYRboDA8d",26],"l":99,"c":" 的元数据和剩下 snapshot 给 sync 过去。在 sync 完成后，通知 Engine 重新检验合法性，此时 replica 正式可用，设置回 RW 模式，启动对新 replica 的心跳"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"895459d5-394d-4433-857a-0b297e72f044":{"value":{"id":"895459d5-394d-4433-857a-0b297e72f044","version":9,"type":"text","properties":{"title":[["这里在打完快照后，新 replica 的写入就全都在 head/live data 上了，写入是安全的。snapshot 的 sync 在后台异步进行，利用了 "],["diffDisk",[["c"]]],[" 的特性和快照实现了在线 rebuild"]]},"format":{"copied_from_pointer":{"id":"6adde800-0ec9-481d-8c2b-76f4221daeee","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734405,"last_edited_time":1724511734406,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"6adde800-0ec9-481d-8c2b-76f4221daeee","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"d0ds0ldDWmhU2s6cZHrzOg,\"start\",\"end\"","n":{"d0ds0ldDWmhU2s6cZHrzOg,\"start\",\"end\"":{"s":{"x":"d0ds0ldDWmhU2s6cZHrzOg","i":[{"t":"s"},{"t":"t","i":["qJcmSEtK7ZvG",1],"o":"start","l":80,"c":"这里在打完快照后，新 replica 的写入就全都在 head/live data 上了，写入是安全的。snapshot 的 sync 在后台异步进行，利用了 "},{"t":"t","i":["qJcmSEtK7ZvG",81],"o":["qJcmSEtK7ZvG",80],"l":8,"c":"diffDisk","b":[{"t":"a","x":"d0ds0ldDWmhU2s6cZHrzOg","l":"","i":["qJcmSEtK7ZvG",109],"s":{"i":["qJcmSEtK7ZvG",81],"a":"b"},"e":{"i":["qJcmSEtK7ZvG",88],"a":"a"},"a":["c"]}],"a":[]},{"t":"t","i":["qJcmSEtK7ZvG",89],"o":["qJcmSEtK7ZvG",88],"l":20,"c":" 的特性和快照实现了在线 rebuild"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"aa4a4965-7412-479a-b045-9d4061d971fe":{"value":{"id":"aa4a4965-7412-479a-b045-9d4061d971fe","version":9,"type":"image","properties":{"size":[["68.9KB"]],"title":[["Untitled"]],"source":[["https://prod-files-secure.s3.us-west-2.amazonaws.com/4cc04375-345a-4a1e-bdf0-3a7c88ef0425/4984c535-3b59-4ae9-b363-c56f764adf27/Untitled.png"]]},"format":{"block_width":528,"display_source":"https://prod-files-secure.s3.us-west-2.amazonaws.com/4cc04375-345a-4a1e-bdf0-3a7c88ef0425/4984c535-3b59-4ae9-b363-c56f764adf27/Untitled.png","block_full_width":false,"block_page_width":false,"block_aspect_ratio":0.9637826961770624,"copied_from_pointer":{"id":"c21e200a-e1cb-4095-94cc-0f8aae8431d0","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"},"block_preserve_scale":true},"created_time":1724511735067,"last_edited_time":1724511735068,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"c21e200a-e1cb-4095-94cc-0f8aae8431d0","file_ids":["4984c535-3b59-4ae9-b363-c56f764adf27"],"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"Ln6ODLGImiiKg5JlNXh7BQ,\"start\",\"end\"","n":{"Ln6ODLGImiiKg5JlNXh7BQ,\"start\",\"end\"":{"s":{"x":"Ln6ODLGImiiKg5JlNXh7BQ","i":[{"t":"s"},{"t":"t","i":["zKw_2iVTWJxR",1],"o":"start","l":8,"c":"Untitled"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"e6a2ecb9-2ae6-4051-801d-13b4a3aa0ffc":{"value":{"id":"e6a2ecb9-2ae6-4051-801d-13b4a3aa0ffc","version":7,"type":"text","format":{"copied_from_pointer":{"id":"10d40d1d-f30d-4e8e-8bb2-4e6591f23540","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511736153,"last_edited_time":1724511736154,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"10d40d1d-f30d-4e8e-8bb2-4e6591f23540","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"frgGq057YSO7YLqWJKmY_w,\"start\",\"end\"","n":{"frgGq057YSO7YLqWJKmY_w,\"start\",\"end\"":{"s":{"x":"frgGq057YSO7YLqWJKmY_w","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"f492b362-aba2-4373-bcfd-1865eeda3ea6":{"value":{"id":"f492b362-aba2-4373-bcfd-1865eeda3ea6","version":9,"type":"header","properties":{"title":[["File storage"]]},"format":{"copied_from_pointer":{"id":"a62d27df-fa7b-4d2a-aba7-975b8c327a77","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734224,"last_edited_time":1724511734225,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"a62d27df-fa7b-4d2a-aba7-975b8c327a77","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"SHn3sCATUAw_hn2s66UX-A,\"start\",\"end\"","n":{"SHn3sCATUAw_hn2s66UX-A,\"start\",\"end\"":{"s":{"x":"SHn3sCATUAw_hn2s66UX-A","i":[{"t":"s"},{"t":"t","i":["ka-ZIQGW62GM",1],"o":"start","l":12,"c":"File storage"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"68860309-7b4a-488a-8c2c-74cabaa7cfad":{"value":{"id":"68860309-7b4a-488a-8c2c-74cabaa7cfad","version":9,"type":"text","properties":{"title":[["Longhorn 提供的 CSI 不支持 Block PVC 的 RWX 挂载，因为块层无法感知更高层（文件系统）的写入模式和内容，多个 client 写入就会把挂载的文件系统元数据写坏。为了支持 RWX 的 PVC，Longhorn 额外通过 Share Manager 组件提供了文件存储。这里有意思的是，它不叫 Filesystem Manager 而是叫 Share Manager，可以看出是完全以 K8s 视角考虑的"]]},"format":{"copied_from_pointer":{"id":"be3b9030-f278-403b-a5c9-f859c4406216","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734220,"last_edited_time":1724511734221,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"be3b9030-f278-403b-a5c9-f859c4406216","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"oUrvYO70N2zxyLs-ngFRzw,\"start\",\"end\"","n":{"oUrvYO70N2zxyLs-ngFRzw,\"start\",\"end\"":{"s":{"x":"oUrvYO70N2zxyLs-ngFRzw","i":[{"t":"s"},{"t":"t","i":["1bvUiMAwRndl",1],"o":"start","l":214,"c":"Longhorn 提供的 CSI 不支持 Block PVC 的 RWX 挂载，因为块层无法感知更高层（文件系统）的写入模式和内容，多个 client 写入就会把挂载的文件系统元数据写坏。为了支持 RWX 的 PVC，Longhorn 额外通过 Share Manager 组件提供了文件存储。这里有意思的是，它不叫 Filesystem Manager 而是叫 Share Manager，可以看出是完全以 K8s 视角考虑的"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"fe2898a8-b325-42b0-b198-071835532d84":{"value":{"id":"fe2898a8-b325-42b0-b198-071835532d84","version":7,"type":"text","format":{"copied_from_pointer":{"id":"a7027487-1982-4cdb-8887-0060baf7930e","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734719,"last_edited_time":1724511734720,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"a7027487-1982-4cdb-8887-0060baf7930e","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"KojVew5RpITcNz11QjwkvQ,\"start\",\"end\"","n":{"KojVew5RpITcNz11QjwkvQ,\"start\",\"end\"":{"s":{"x":"KojVew5RpITcNz11QjwkvQ","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"216da7e2-fe81-4906-b122-2f304a5dfca4":{"value":{"id":"216da7e2-fe81-4906-b122-2f304a5dfca4","version":9,"type":"text","properties":{"title":[["当创建 RWX 的 volume （Longhorn 的 CR，非 PVC）时，Manager 中 volume controller 会创建对应的 share manager CR。share manager controller 再创建 share manager pod 并修改 volume 让其实际挂载在这个 share manager pod 的节点上"]]},"format":{"copied_from_pointer":{"id":"3d6588a6-4807-43fa-9fd1-355e12ee35c1","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734502,"last_edited_time":1724511734503,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"3d6588a6-4807-43fa-9fd1-355e12ee35c1","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"V4e79ptSlVKW9dKvDqbtjA,\"start\",\"end\"","n":{"V4e79ptSlVKW9dKvDqbtjA,\"start\",\"end\"":{"s":{"x":"V4e79ptSlVKW9dKvDqbtjA","i":[{"t":"s"},{"t":"t","i":["FU-sVE315oCb",1],"o":"start","l":182,"c":"当创建 RWX 的 volume （Longhorn 的 CR，非 PVC）时，Manager 中 volume controller 会创建对应的 share manager CR。share manager controller 再创建 share manager pod 并修改 volume 让其实际挂载在这个 share manager pod 的节点上"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"157938c8-dd74-4694-96dd-340cfd82336e":{"value":{"id":"157938c8-dd74-4694-96dd-340cfd82336e","version":9,"type":"text","properties":{"title":[["controller 检测到 pod 启动之后，就会给其发起 RPC 请求将 "],["/dev/longhorn/{vol_name}",[["c"]]],[" 块设备格式化为指定文件系统挂载到 "],["/export/{vol_name}",[["c"]]],[" 中"]]},"format":{"copied_from_pointer":{"id":"a12b4e63-4338-40d8-a2b5-8209034e3a7d","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734417,"last_edited_time":1724511734418,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"a12b4e63-4338-40d8-a2b5-8209034e3a7d","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"D3AhJqE9vseR-lg75HIuKw,\"start\",\"end\"","n":{"D3AhJqE9vseR-lg75HIuKw,\"start\",\"end\"":{"s":{"x":"D3AhJqE9vseR-lg75HIuKw","i":[{"t":"s"},{"t":"t","i":["NxndF47GJumL",1],"o":"start","l":39,"c":"controller 检测到 pod 启动之后，就会给其发起 RPC 请求将 "},{"t":"t","i":["NxndF47GJumL",40],"o":["NxndF47GJumL",39],"l":24,"c":"/dev/longhorn/{vol_name}","b":[{"t":"a","x":"D3AhJqE9vseR-lg75HIuKw","l":"","i":["NxndF47GJumL",102],"s":{"i":["NxndF47GJumL",40],"a":"b"},"e":{"i":["NxndF47GJumL",63],"a":"a"},"a":["c"]}],"a":[]},{"t":"t","i":["NxndF47GJumL",64],"o":["NxndF47GJumL",63],"l":18,"c":" 块设备格式化为指定文件系统挂载到 "},{"t":"t","i":["NxndF47GJumL",82],"o":["NxndF47GJumL",81],"l":18,"c":"/export/{vol_name}","b":[{"t":"a","x":"D3AhJqE9vseR-lg75HIuKw","l":"","i":["NxndF47GJumL",103],"s":{"i":["NxndF47GJumL",82],"a":"b"},"e":{"i":["NxndF47GJumL",99],"a":"a"},"a":["c"]}],"a":[]},{"t":"t","i":["NxndF47GJumL",100],"o":["NxndF47GJumL",99],"l":2,"c":" 中"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"5124f1f3-028f-4cc9-a6a0-7ab9f3274d8e":{"value":{"id":"5124f1f3-028f-4cc9-a6a0-7ab9f3274d8e","version":9,"type":"text","properties":{"title":[["share manager 内运行了一个 nfs ganesha，作为 NFS server。最后 share manager 更新 nfs ganesha 配置，将 "],["/export/{vol_name}",[["c"]]],[" 导出"]]},"format":{"copied_from_pointer":{"id":"b941a64d-ce3e-4b05-b9ab-98128a7e0fe0","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734752,"last_edited_time":1724511734753,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"b941a64d-ce3e-4b05-b9ab-98128a7e0fe0","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"m0i7JdiJprUMrDrX-0A1NA,\"start\",\"end\"","n":{"m0i7JdiJprUMrDrX-0A1NA,\"start\",\"end\"":{"s":{"x":"m0i7JdiJprUMrDrX-0A1NA","i":[{"t":"s"},{"t":"t","i":["hH3utDOxIRiW",1],"o":"start","l":84,"c":"share manager 内运行了一个 nfs ganesha，作为 NFS server。最后 share manager 更新 nfs ganesha 配置，将 "},{"t":"t","i":["hH3utDOxIRiW",85],"o":["hH3utDOxIRiW",84],"l":18,"c":"/export/{vol_name}","b":[{"t":"a","x":"m0i7JdiJprUMrDrX-0A1NA","l":"","i":["hH3utDOxIRiW",106],"s":{"i":["hH3utDOxIRiW",85],"a":"b"},"e":{"i":["hH3utDOxIRiW",102],"a":"a"},"a":["c"]}],"a":[]},{"t":"t","i":["hH3utDOxIRiW",103],"o":["hH3utDOxIRiW",102],"l":3,"c":" 导出"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"8855c871-7ddb-4bbc-9a85-3acae891457c":{"value":{"id":"8855c871-7ddb-4bbc-9a85-3acae891457c","version":9,"type":"text","properties":{"title":[["share manager 和 volume 的 status 在 controller reconcile 中被更新，设置 NFS 连接信息，现在 CSI 就可以获取到 NFS 连接配置，完成最终的用户 Pod 挂载流程"]]},"format":{"copied_from_pointer":{"id":"3be01f7b-b033-48f3-98f7-dba1ec4451c0","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734818,"last_edited_time":1724511734819,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"3be01f7b-b033-48f3-98f7-dba1ec4451c0","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"LE1BDkfuRzYTvZ034kJ5XQ,\"start\",\"end\"","n":{"LE1BDkfuRzYTvZ034kJ5XQ,\"start\",\"end\"":{"s":{"x":"LE1BDkfuRzYTvZ034kJ5XQ","i":[{"t":"s"},{"t":"t","i":["YMy1-bkg6gH-",1],"o":"start","l":111,"c":"share manager 和 volume 的 status 在 controller reconcile 中被更新，设置 NFS 连接信息，现在 CSI 就可以获取到 NFS 连接配置，完成最终的用户 Pod 挂载流程"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"30cca0e4-3eeb-4644-83e6-a121dc1ec3a0":{"value":{"id":"30cca0e4-3eeb-4644-83e6-a121dc1ec3a0","version":9,"type":"image","properties":{"size":[["61.5KB"]],"title":[["Untitled"]],"source":[["https://prod-files-secure.s3.us-west-2.amazonaws.com/4cc04375-345a-4a1e-bdf0-3a7c88ef0425/634f0ba3-651c-4cb3-ade9-b46c64d446bb/Untitled.png"]]},"format":{"block_width":624,"display_source":"https://prod-files-secure.s3.us-west-2.amazonaws.com/4cc04375-345a-4a1e-bdf0-3a7c88ef0425/634f0ba3-651c-4cb3-ade9-b46c64d446bb/Untitled.png","block_full_width":false,"block_page_width":false,"block_aspect_ratio":0.8784355179704016,"copied_from_pointer":{"id":"75c096e0-4fe5-4818-82fd-8f6427434a39","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"},"block_preserve_scale":true},"created_time":1724511734817,"last_edited_time":1724511734818,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"75c096e0-4fe5-4818-82fd-8f6427434a39","file_ids":["634f0ba3-651c-4cb3-ade9-b46c64d446bb"],"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"ZqkJrcQM0WhMATUWdHxlbw,\"start\",\"end\"","n":{"ZqkJrcQM0WhMATUWdHxlbw,\"start\",\"end\"":{"s":{"x":"ZqkJrcQM0WhMATUWdHxlbw","i":[{"t":"s"},{"t":"t","i":["rONdib5CRR4w",1],"o":"start","l":8,"c":"Untitled"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"1cef134c-9421-4c29-ac92-dbc7771ddd4f":{"value":{"id":"1cef134c-9421-4c29-ac92-dbc7771ddd4f","version":7,"type":"text","format":{"copied_from_pointer":{"id":"6ace679a-92ab-4289-8ba5-0d028880f8fd","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734201,"last_edited_time":1724511734202,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"6ace679a-92ab-4289-8ba5-0d028880f8fd","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"oe8GTCDSqGJpdr4C6a8RzA,\"start\",\"end\"","n":{"oe8GTCDSqGJpdr4C6a8RzA,\"start\",\"end\"":{"s":{"x":"oe8GTCDSqGJpdr4C6a8RzA","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"eb6f16d4-ea0d-4932-b61c-a1c85055695c":{"value":{"id":"eb6f16d4-ea0d-4932-b61c-a1c85055695c","version":9,"type":"text","properties":{"title":[["这里 NFS server 是一个单点的 gateway。为了故障恢复，Longhorn 修改 nfs ganesha 添加了一个新的 recovery backend 类型 longhorn，这个定制的 recovery backend 的作用是将 nfs ganesha 的内部状态信息存储到 K8s ConfigMap 中"]]},"format":{"copied_from_pointer":{"id":"63e2244e-9122-4b34-9523-d7dcfd0db521","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734773,"last_edited_time":1724511734774,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"63e2244e-9122-4b34-9523-d7dcfd0db521","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"ojmw104X6EI785k13hTOOg,\"start\",\"end\"","n":{"ojmw104X6EI785k13hTOOg,\"start\",\"end\"":{"s":{"x":"ojmw104X6EI785k13hTOOg","i":[{"t":"s"},{"t":"t","i":["Vp9XxZU6qnib",1],"o":"start","l":164,"c":"这里 NFS server 是一个单点的 gateway。为了故障恢复，Longhorn 修改 nfs ganesha 添加了一个新的 recovery backend 类型 longhorn，这个定制的 recovery backend 的作用是将 nfs ganesha 的内部状态信息存储到 K8s ConfigMap 中"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"ca9b3750-3b20-433a-85b5-877a4f3e51ad":{"value":{"id":"ca9b3750-3b20-433a-85b5-877a4f3e51ad","version":9,"type":"text","properties":{"title":[["当发生故障，新的 share manager pod 被创建出来后，nfs ganesha 就能从 ConfigMap 中恢复状态，nfs client 可以配置一定宽限期，此时再重试请求就能成功，恢复运行"]]},"format":{"copied_from_pointer":{"id":"f1143a33-728b-4a2c-86dc-1093920e3c47","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734816,"last_edited_time":1724511734817,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"f1143a33-728b-4a2c-86dc-1093920e3c47","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"XPTvzOYbHZcbQxs8QJjm8g,\"start\",\"end\"","n":{"XPTvzOYbHZcbQxs8QJjm8g,\"start\",\"end\"":{"s":{"x":"XPTvzOYbHZcbQxs8QJjm8g","i":[{"t":"s"},{"t":"t","i":["iAkFMbv84xBb",1],"o":"start","l":103,"c":"当发生故障，新的 share manager pod 被创建出来后，nfs ganesha 就能从 ConfigMap 中恢复状态，nfs client 可以配置一定宽限期，此时再重试请求就能成功，恢复运行"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"b5e2e343-a9a7-46b7-a31b-b5fa4b7a04ec":{"value":{"id":"b5e2e343-a9a7-46b7-a31b-b5fa4b7a04ec","version":7,"type":"text","format":{"copied_from_pointer":{"id":"a7cb0b47-0b68-4fdc-a991-43ad6a9efd98","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734411,"last_edited_time":1724511734412,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"a7cb0b47-0b68-4fdc-a991-43ad6a9efd98","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"t69WszIywQc99H3aJSFO1Q,\"start\",\"end\"","n":{"t69WszIywQc99H3aJSFO1Q,\"start\",\"end\"":{"s":{"x":"t69WszIywQc99H3aJSFO1Q","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"d376ba71-b271-424d-8060-d08d2e53d349":{"value":{"id":"d376ba71-b271-424d-8060-d08d2e53d349","version":9,"type":"text","properties":{"title":[["实际上 NFS server 可以配置 active/active（多活）和 active/passive（主备） 模式。这样恢复速度能比等待重建快得多，可以做到高可用，但目前看起来在这套架构上并不好实现"]]},"format":{"copied_from_pointer":{"id":"d08e1e7d-ff8f-4499-8503-d2d8c1578325","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734219,"last_edited_time":1724511734220,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"d08e1e7d-ff8f-4499-8503-d2d8c1578325","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"gNZlFvXkQRnmHfZg7wUg7w,\"start\",\"end\"","n":{"gNZlFvXkQRnmHfZg7wUg7w,\"start\",\"end\"":{"s":{"x":"gNZlFvXkQRnmHfZg7wUg7w","i":[{"t":"s"},{"t":"t","i":["fz6tig8k3SYA",1],"o":"start","l":102,"c":"实际上 NFS server 可以配置 active/active（多活）和 active/passive（主备） 模式。这样恢复速度能比等待重建快得多，可以做到高可用，但目前看起来在这套架构上并不好实现"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"27e019a0-4b36-4049-bf72-944745e9ac6c":{"value":{"id":"27e019a0-4b36-4049-bf72-944745e9ac6c","version":9,"type":"text","properties":{"title":[["首先这里 NFS server 本身就是跑在 iSCSI 块设备上的，无法处理多 client 写入，这就回到一开始的情况了，因此无法做到 active/active。而 Engine 则限制了必须和 Pod 在同一节点上，目前不支持存在一个备用的 Engine 连接同样的 Replica，自然也无法做到 active/passive"]]},"format":{"copied_from_pointer":{"id":"291c6dfc-af4f-4af3-a059-26ca41d7033f","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734340,"last_edited_time":1724511734341,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"291c6dfc-af4f-4af3-a059-26ca41d7033f","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"-shQsg3BLYh11iL-H_qHTw,\"start\",\"end\"","n":{"-shQsg3BLYh11iL-H_qHTw,\"start\",\"end\"":{"s":{"x":"-shQsg3BLYh11iL-H_qHTw","i":[{"t":"s"},{"t":"t","i":["DzSs9UkeI2cf",1],"o":"start","l":168,"c":"首先这里 NFS server 本身就是跑在 iSCSI 块设备上的，无法处理多 client 写入，这就回到一开始的情况了，因此无法做到 active/active。而 Engine 则限制了必须和 Pod 在同一节点上，目前不支持存在一个备用的 Engine 连接同样的 Replica，自然也无法做到 active/passive"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"8dc4380a-3dbf-41d0-9cea-b0af03074b40":{"value":{"id":"8dc4380a-3dbf-41d0-9cea-b0af03074b40","version":7,"type":"text","format":{"copied_from_pointer":{"id":"d7db75b8-ac34-4825-9ef1-5ed0ed385f2b","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734463,"last_edited_time":1724511734464,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"d7db75b8-ac34-4825-9ef1-5ed0ed385f2b","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"lmJhyEbbbHIgKe3893Q0Fw,\"start\",\"end\"","n":{"lmJhyEbbbHIgKe3893Q0Fw,\"start\",\"end\"":{"s":{"x":"lmJhyEbbbHIgKe3893Q0Fw","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"c02bf569-3f05-4580-b098-f52d09297f11":{"value":{"id":"c02bf569-3f05-4580-b098-f52d09297f11","version":9,"type":"header","properties":{"title":[["V2 Engine"]]},"format":{"copied_from_pointer":{"id":"d441f00e-a5cb-44d3-b26a-82595ac0e0db","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734542,"last_edited_time":1724511734543,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"d441f00e-a5cb-44d3-b26a-82595ac0e0db","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"tNUn_WKheIsolWfXHGzrzQ,\"start\",\"end\"","n":{"tNUn_WKheIsolWfXHGzrzQ,\"start\",\"end\"":{"s":{"x":"tNUn_WKheIsolWfXHGzrzQ","i":[{"t":"s"},{"t":"t","i":["blt4adZNZsQN",1],"o":"start","l":9,"c":"V2 Engine"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"0abfa260-4079-4ca8-8d46-02c04448568c":{"value":{"id":"0abfa260-4079-4ca8-8d46-02c04448568c","version":9,"type":"text","properties":{"title":[["V2 Engine 使用了 SPDK，基本是复用了 SPDK 自带的功能，Go 只是调用来创建，不会再直接处理 I/O，性能应该能得到很大提高。V2 Engine 目前还是 preview feature，一些功能支持的不完善，例如扩容"]]},"format":{"copied_from_pointer":{"id":"2032b073-8743-4e1d-969b-678f42eaacb6","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734210,"last_edited_time":1724511734211,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"2032b073-8743-4e1d-969b-678f42eaacb6","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"y0a9s41ykbg69QnoA-C3vA,\"start\",\"end\"","n":{"y0a9s41ykbg69QnoA-C3vA,\"start\",\"end\"":{"s":{"x":"y0a9s41ykbg69QnoA-C3vA","i":[{"t":"s"},{"t":"t","i":["XteeHt8Hn7Q9",1],"o":"start","l":118,"c":"V2 Engine 使用了 SPDK，基本是复用了 SPDK 自带的功能，Go 只是调用来创建，不会再直接处理 I/O，性能应该能得到很大提高。V2 Engine 目前还是 preview feature，一些功能支持的不完善，例如扩容"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"e8b93937-f7b8-427a-b87b-f8c4800bcd91":{"value":{"id":"e8b93937-f7b8-427a-b87b-f8c4800bcd91","version":7,"type":"text","format":{"copied_from_pointer":{"id":"59cb1c52-3f6c-4bc7-8709-e8ad1e8fafff","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511736135,"last_edited_time":1724511736136,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"59cb1c52-3f6c-4bc7-8709-e8ad1e8fafff","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"Kj-D14ctWE4DveD6ZUlt9g,\"start\",\"end\"","n":{"Kj-D14ctWE4DveD6ZUlt9g,\"start\",\"end\"":{"s":{"x":"Kj-D14ctWE4DveD6ZUlt9g","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"6b50d509-6270-4f2e-9587-67eb032c21d6":{"value":{"id":"6b50d509-6270-4f2e-9587-67eb032c21d6","version":9,"type":"text","properties":{"title":[["在 V2 Engine 上，总体设计也类似于 V1 Engine，Engine 连接多个 Replica。Replica 就是一个 SPDK 的 lvol bdev（逻辑卷），还包括一个 NVMf Target 将 bdev 暴露出去。剩下的例如精简配置、快照等功能都是 SPDK 自身已经支持的，直接通过 JSON-RPC 调用即可"]]},"format":{"copied_from_pointer":{"id":"5cda381a-68c2-4eba-a94f-460116f03049","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734486,"last_edited_time":1724511734487,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"5cda381a-68c2-4eba-a94f-460116f03049","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"pMrT5V7MtUayJVvDljt42w,\"start\",\"end\"","n":{"pMrT5V7MtUayJVvDljt42w,\"start\",\"end\"":{"s":{"x":"pMrT5V7MtUayJVvDljt42w","i":[{"t":"s"},{"t":"t","i":["yJqX1d3tZecn",1],"o":"start","l":167,"c":"在 V2 Engine 上，总体设计也类似于 V1 Engine，Engine 连接多个 Replica。Replica 就是一个 SPDK 的 lvol bdev（逻辑卷），还包括一个 NVMf Target 将 bdev 暴露出去。剩下的例如精简配置、快照等功能都是 SPDK 自身已经支持的，直接通过 JSON-RPC 调用即可"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"44824160-de3d-43d5-a6c9-915fdffdaf24":{"value":{"id":"44824160-de3d-43d5-a6c9-915fdffdaf24","version":9,"type":"image","properties":{"size":[["48.5KB"]],"title":[["Untitled"]],"source":[["https://prod-files-secure.s3.us-west-2.amazonaws.com/4cc04375-345a-4a1e-bdf0-3a7c88ef0425/acdac30c-0f7c-4d5d-a678-43c4dfb4897b/Untitled.png"]]},"format":{"block_width":720,"display_source":"https://prod-files-secure.s3.us-west-2.amazonaws.com/4cc04375-345a-4a1e-bdf0-3a7c88ef0425/acdac30c-0f7c-4d5d-a678-43c4dfb4897b/Untitled.png","block_full_width":false,"block_page_width":true,"block_aspect_ratio":0.4817629179331307,"copied_from_pointer":{"id":"708023e8-0603-474a-ad9f-06aa7766c75d","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"},"block_preserve_scale":true},"created_time":1724511734517,"last_edited_time":1724511734518,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"708023e8-0603-474a-ad9f-06aa7766c75d","file_ids":["acdac30c-0f7c-4d5d-a678-43c4dfb4897b"],"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"3ekUQsNBZ3-873Yblvh_bg,\"start\",\"end\"","n":{"3ekUQsNBZ3-873Yblvh_bg,\"start\",\"end\"":{"s":{"x":"3ekUQsNBZ3-873Yblvh_bg","i":[{"t":"s"},{"t":"t","i":["VCyobHz44tZZ",1],"o":"start","l":8,"c":"Untitled"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"dfc590a4-a8c8-4edd-8982-32d3a8e5c77b":{"value":{"id":"dfc590a4-a8c8-4edd-8982-32d3a8e5c77b","version":9,"type":"text","properties":{"title":[["Replica 已经暴露了 NVMf bdev，Engine 同样通过 SPDK 连接到每个 Replica 的 NVMf bdev，再组成 RAID1 bdev，这样又利用了 SPDK 直接实现了多副本，最后暴露出 NVMf Target 给 client 连接"]]},"format":{"copied_from_pointer":{"id":"642c8289-96c0-4395-bc8c-1189158ba0cd","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511737343,"last_edited_time":1724511737344,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"642c8289-96c0-4395-bc8c-1189158ba0cd","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"ZX-6c8_RpkBtSLX3uoAlvg,\"start\",\"end\"","n":{"ZX-6c8_RpkBtSLX3uoAlvg,\"start\",\"end\"":{"s":{"x":"ZX-6c8_RpkBtSLX3uoAlvg","i":[{"t":"s"},{"t":"t","i":["3Q-Kc2OLg6me",1],"o":"start","l":132,"c":"Replica 已经暴露了 NVMf bdev，Engine 同样通过 SPDK 连接到每个 Replica 的 NVMf bdev，再组成 RAID1 bdev，这样又利用了 SPDK 直接实现了多副本，最后暴露出 NVMf Target 给 client 连接"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"6e079fd5-54fa-4c0f-8fd9-9c090bea781e":{"value":{"id":"6e079fd5-54fa-4c0f-8fd9-9c090bea781e","version":9,"type":"image","properties":{"size":[["69.0KB"]],"title":[["Untitled"]],"source":[["https://prod-files-secure.s3.us-west-2.amazonaws.com/4cc04375-345a-4a1e-bdf0-3a7c88ef0425/dcf8bbf2-409a-4d6c-bff0-bf9dc67fdcc1/Untitled.png"]]},"format":{"block_width":528,"display_source":"https://prod-files-secure.s3.us-west-2.amazonaws.com/4cc04375-345a-4a1e-bdf0-3a7c88ef0425/dcf8bbf2-409a-4d6c-bff0-bf9dc67fdcc1/Untitled.png","block_full_width":false,"block_page_width":false,"block_aspect_ratio":0.6245421245421245,"copied_from_pointer":{"id":"9488adec-1213-423b-9b87-3c4b6daa862f","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"},"block_preserve_scale":true},"created_time":1724511735962,"last_edited_time":1724511735963,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"9488adec-1213-423b-9b87-3c4b6daa862f","file_ids":["dcf8bbf2-409a-4d6c-bff0-bf9dc67fdcc1"],"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"rwcnuTOZVaY55Q9vIMDYBQ,\"start\",\"end\"","n":{"rwcnuTOZVaY55Q9vIMDYBQ,\"start\",\"end\"":{"s":{"x":"rwcnuTOZVaY55Q9vIMDYBQ","i":[{"t":"s"},{"t":"t","i":["YilFK_kzUhGk",1],"o":"start","l":8,"c":"Untitled"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"fb0a3e9f-ce5c-4c3a-af83-b31a9fe55903":{"value":{"id":"fb0a3e9f-ce5c-4c3a-af83-b31a9fe55903","version":7,"type":"text","format":{"copied_from_pointer":{"id":"66c1cf7a-dbfc-4296-8577-f4aebb55165a","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734212,"last_edited_time":1724511734213,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"66c1cf7a-dbfc-4296-8577-f4aebb55165a","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"hrMy_aq34pM86XmcT01k4g,\"start\",\"end\"","n":{"hrMy_aq34pM86XmcT01k4g,\"start\",\"end\"":{"s":{"x":"hrMy_aq34pM86XmcT01k4g","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"f4b352dd-caba-43ae-9a31-6b09879a3ab0":{"value":{"id":"f4b352dd-caba-43ae-9a31-6b09879a3ab0","version":9,"type":"text","properties":{"title":[["由于并不插手 I/O 流程，这里的容错处理稍微被动些。健康检查不再是心跳，而是定期（3s）获取 replica 上的 SPDK bdev 列表，在这个过程中更新一些统计数据。当 bdev 不存在或信息不一致时，就会设置为 ERR mode 让其 rebuild"]]},"format":{"copied_from_pointer":{"id":"548cb74e-0478-4a0e-90f8-4a600f30276e","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511737883,"last_edited_time":1724511737884,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"548cb74e-0478-4a0e-90f8-4a600f30276e","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"Cl9h2rVpqQw8gDWvWYPzqg,\"start\",\"end\"","n":{"Cl9h2rVpqQw8gDWvWYPzqg,\"start\",\"end\"":{"s":{"x":"Cl9h2rVpqQw8gDWvWYPzqg","i":[{"t":"s"},{"t":"t","i":["ta3TLxsnsMGc",1],"o":"start","l":130,"c":"由于并不插手 I/O 流程，这里的容错处理稍微被动些。健康检查不再是心跳，而是定期（3s）获取 replica 上的 SPDK bdev 列表，在这个过程中更新一些统计数据。当 bdev 不存在或信息不一致时，就会设置为 ERR mode 让其 rebuild"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"8800227d-91f7-4455-8053-5c8e5cceb673":{"value":{"id":"8800227d-91f7-4455-8053-5c8e5cceb673","version":9,"type":"text","properties":{"title":[["V2 Engine 中 rebuild 和 add replica 流程和 V1 Engine 大体类似："]]},"format":{"copied_from_pointer":{"id":"b867205f-0a3e-4ad5-9ec5-e806b360977b","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734537,"last_edited_time":1724511734538,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"b867205f-0a3e-4ad5-9ec5-e806b360977b","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"y9BwsrOe9mOKdKUIGwdRyg,\"start\",\"end\"","n":{"y9BwsrOe9mOKdKUIGwdRyg,\"start\",\"end\"":{"s":{"x":"y9BwsrOe9mOKdKUIGwdRyg","i":[{"t":"s"},{"t":"t","i":["U0jWo4xLOOQG",1],"o":"start","l":53,"c":"V2 Engine 中 rebuild 和 add replica 流程和 V1 Engine 大体类似："},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"2dbe78dd-c429-4bc6-9720-ca89ee62ecf0":{"value":{"id":"2dbe78dd-c429-4bc6-9720-ca89ee62ecf0","version":9,"type":"numbered_list","properties":{"title":[["首先打快照，然后让新的 replica 直接通过 NVMf 连接源 replica 的 bdev，作为 external snapshot 创建新的 lvol bdev"]]},"format":{"copied_from_pointer":{"id":"c8942a04-5cae-4aad-92c0-c677a2159f78","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511737697,"last_edited_time":1724511737698,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"c8942a04-5cae-4aad-92c0-c677a2159f78","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"2jQ790xg0eYb3nWKAoOYcQ,\"start\",\"end\"","n":{"2jQ790xg0eYb3nWKAoOYcQ,\"start\",\"end\"":{"s":{"x":"2jQ790xg0eYb3nWKAoOYcQ","i":[{"t":"s"},{"t":"t","i":["v_qppGSKlb6H",1],"o":"start","l":84,"c":"首先打快照，然后让新的 replica 直接通过 NVMf 连接源 replica 的 bdev，作为 external snapshot 创建新的 lvol bdev"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"51eb40a6-9040-4a43-8505-b0b2ab13876d":{"value":{"id":"51eb40a6-9040-4a43-8505-b0b2ab13876d","version":9,"type":"numbered_list","properties":{"title":[["回到 V2 Engine，现在新 replica 的 lvol bdev 已经存在了，可以连接并添加到 RAID1 bdev 中。虽然这时也给新 replica 设置了 WO mode，但 Engine 已经不在 I/O 流程中了 管不着，SPDK 仍然可能从新的 bdev 中读，SPDK 能正确处理，但会有一定性能下降"]]},"format":{"copied_from_pointer":{"id":"ea964bca-5598-4570-871c-24ea6ed97965","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511738013,"last_edited_time":1724511738014,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"ea964bca-5598-4570-871c-24ea6ed97965","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"6c4BD9UAxLW0rRqlpbyFHQ,\"start\",\"end\"","n":{"6c4BD9UAxLW0rRqlpbyFHQ,\"start\",\"end\"":{"s":{"x":"6c4BD9UAxLW0rRqlpbyFHQ","i":[{"t":"s"},{"t":"t","i":["xN3URfVgLvmA",1],"o":"start","l":161,"c":"回到 V2 Engine，现在新 replica 的 lvol bdev 已经存在了，可以连接并添加到 RAID1 bdev 中。虽然这时也给新 replica 设置了 WO mode，但 Engine 已经不在 I/O 流程中了 管不着，SPDK 仍然可能从新的 bdev 中读，SPDK 能正确处理，但会有一定性能下降"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"42b41672-8d6e-4431-aa2c-af3e688887fd":{"value":{"id":"42b41672-8d6e-4431-aa2c-af3e688887fd","version":9,"type":"numbered_list","properties":{"title":[["虽然新 replica 的 bdev 中已经有了完整数据（RAID1 bdev 会自动处理），但它上面并没有源 replica 上那些历史快照链，还需要一个恢复快照链的过程。这里会再创建一个新的 rebuilding lvol，使用 shallow copy 将源 replica 的快照一层层 copy 过去，每 copy 完一层就给 rebuilding lvol 打一次快照。这样从头给 rebuilding lvol 构建历史快照链"]]},"format":{"copied_from_pointer":{"id":"402cb307-1edd-4e0d-b9e9-2a3808531f39","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734528,"last_edited_time":1724511734529,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"402cb307-1edd-4e0d-b9e9-2a3808531f39","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"PQkeN_0w7OEamhuZ3PPBGA,\"start\",\"end\"","n":{"PQkeN_0w7OEamhuZ3PPBGA,\"start\",\"end\"":{"s":{"x":"PQkeN_0w7OEamhuZ3PPBGA","i":[{"t":"s"},{"t":"t","i":["2bxZuPWkagkU",1],"o":"start","l":220,"c":"虽然新 replica 的 bdev 中已经有了完整数据（RAID1 bdev 会自动处理），但它上面并没有源 replica 上那些历史快照链，还需要一个恢复快照链的过程。这里会再创建一个新的 rebuilding lvol，使用 shallow copy 将源 replica 的快照一层层 copy 过去，每 copy 完一层就给 rebuilding lvol 打一次快照。这样从头给 rebuilding lvol 构建历史快照链"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"f43a75e3-a936-49ef-9650-4ce452c81e7c":{"value":{"id":"f43a75e3-a936-49ef-9650-4ce452c81e7c","version":9,"type":"numbered_list","properties":{"title":[["最后再将第 1 步中的新 lvol 的 parent 从 external snapshot 改为 rebuilding lvol"]]},"format":{"copied_from_pointer":{"id":"b10d9339-c91e-4bbb-9972-5b64a492742c","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734350,"last_edited_time":1724511734351,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"b10d9339-c91e-4bbb-9972-5b64a492742c","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"7HXYYT3KtPnDNO-neHKDKg,\"start\",\"end\"","n":{"7HXYYT3KtPnDNO-neHKDKg,\"start\",\"end\"":{"s":{"x":"7HXYYT3KtPnDNO-neHKDKg","i":[{"t":"s"},{"t":"t","i":["I0TMQsX8e-NS",1],"o":"start","l":65,"c":"最后再将第 1 步中的新 lvol 的 parent 从 external snapshot 改为 rebuilding lvol"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"912714e5-daaa-4647-b3b1-7413e3f0da44":{"value":{"id":"912714e5-daaa-4647-b3b1-7413e3f0da44","version":7,"type":"text","format":{"copied_from_pointer":{"id":"c7df9c4f-3dc3-48a6-8f9d-3a97768cb361","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734374,"last_edited_time":1724511734375,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"c7df9c4f-3dc3-48a6-8f9d-3a97768cb361","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"jKRMvnfoNAJqNkogV6U6EA,\"start\",\"end\"","n":{"jKRMvnfoNAJqNkogV6U6EA,\"start\",\"end\"":{"s":{"x":"jKRMvnfoNAJqNkogV6U6EA","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"d32b007e-2338-4eb7-858b-3d37620a8c83":{"value":{"id":"d32b007e-2338-4eb7-858b-3d37620a8c83","version":9,"type":"text","properties":{"title":[["V2 Engine 的模式让我想起了 Kafka，Kafka 虽然是 Java 实现，但实际上 Java 本身没有做太多 key path 上的数据处理，而是 offload 到 kernel 去做，避免了 Java 的性能劣势。从这个角度来说，Kafka 的数据面更像一个细粒度的对 kernel 的控制面。Longhorn 的 V2 Engine 也是如此，基本就是对 SPDK 的控制面"]]},"format":{"copied_from_pointer":{"id":"e8e4ea21-036a-481c-a95f-e80c7fcb08ff","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734428,"last_edited_time":1724511734429,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"e8e4ea21-036a-481c-a95f-e80c7fcb08ff","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"hqbq7MPxvgL_fGjpi2xsVw,\"start\",\"end\"","n":{"hqbq7MPxvgL_fGjpi2xsVw,\"start\",\"end\"":{"s":{"x":"hqbq7MPxvgL_fGjpi2xsVw","i":[{"t":"s"},{"t":"t","i":["BgtzjQe8Hpgy",1],"o":"start","l":196,"c":"V2 Engine 的模式让我想起了 Kafka，Kafka 虽然是 Java 实现，但实际上 Java 本身没有做太多 key path 上的数据处理，而是 offload 到 kernel 去做，避免了 Java 的性能劣势。从这个角度来说，Kafka 的数据面更像一个细粒度的对 kernel 的控制面。Longhorn 的 V2 Engine 也是如此，基本就是对 SPDK 的控制面"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"39530a36-f376-4bb1-8113-d7206968fa8d":{"value":{"id":"39530a36-f376-4bb1-8113-d7206968fa8d","version":7,"type":"text","format":{"copied_from_pointer":{"id":"467cfa21-cdb2-48e7-b2cb-d7517b9df120","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734343,"last_edited_time":1724511734344,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"467cfa21-cdb2-48e7-b2cb-d7517b9df120","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"1CBLnpfFrixeC_smJVLG7Q,\"start\",\"end\"","n":{"1CBLnpfFrixeC_smJVLG7Q,\"start\",\"end\"":{"s":{"x":"1CBLnpfFrixeC_smJVLG7Q","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"87890865-c795-4251-9af2-9a263964d1bb":{"value":{"id":"87890865-c795-4251-9af2-9a263964d1bb","version":9,"type":"header","properties":{"title":[["Performance"]]},"format":{"copied_from_pointer":{"id":"46a6c7cd-ec31-4ca9-9f91-2ebe89a6b3e2","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734550,"last_edited_time":1724511734551,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"46a6c7cd-ec31-4ca9-9f91-2ebe89a6b3e2","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"sgh0fqMBcE0fwkBP-ZZ6AA,\"start\",\"end\"","n":{"sgh0fqMBcE0fwkBP-ZZ6AA,\"start\",\"end\"":{"s":{"x":"sgh0fqMBcE0fwkBP-ZZ6AA","i":[{"t":"s"},{"t":"t","i":["vZCUJdQBMmEY",1],"o":"start","l":11,"c":"Performance"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"9207b00d-dbac-4819-9dea-f25292352e0d":{"value":{"id":"9207b00d-dbac-4819-9dea-f25292352e0d","version":9,"type":"text","properties":{"title":[["看一下性能，benchmark 可以看到，V1 Engine 的性能比较差，也在预期之内。不过这里测试用的 SSD 比较一般，完全没发挥出 SPDK 的性能，但到了那种程度网络也是瓶颈了，Longhorn 目前还不支持 RDMA"]]},"format":{"copied_from_pointer":{"id":"b11945b7-7783-40b3-a3c1-03aa0b2b4478","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734250,"last_edited_time":1724511734251,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"b11945b7-7783-40b3-a3c1-03aa0b2b4478","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"2w3IK7R9k6i-nyyY_V_sfw,\"start\",\"end\"","n":{"2w3IK7R9k6i-nyyY_V_sfw,\"start\",\"end\"":{"s":{"x":"2w3IK7R9k6i-nyyY_V_sfw","i":[{"t":"s"},{"t":"t","i":["6svZoa6dZrhA",1],"o":"start","l":114,"c":"看一下性能，benchmark 可以看到，V1 Engine 的性能比较差，也在预期之内。不过这里测试用的 SSD 比较一般，完全没发挥出 SPDK 的性能，但到了那种程度网络也是瓶颈了，Longhorn 目前还不支持 RDMA"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"7c840412-5919-4a47-bf3b-2417b4e8b9a8":{"value":{"id":"7c840412-5919-4a47-bf3b-2417b4e8b9a8","version":9,"type":"image","properties":{"size":[["38.4KB"]],"title":[["Untitled"]],"source":[["https://prod-files-secure.s3.us-west-2.amazonaws.com/4cc04375-345a-4a1e-bdf0-3a7c88ef0425/79cf5471-dca4-4a90-a6ee-9ec25beb9771/Untitled.png"]]},"format":{"block_width":708,"display_source":"https://prod-files-secure.s3.us-west-2.amazonaws.com/4cc04375-345a-4a1e-bdf0-3a7c88ef0425/79cf5471-dca4-4a90-a6ee-9ec25beb9771/Untitled.png","block_full_width":false,"block_page_width":true,"block_aspect_ratio":0.3741319444444444,"copied_from_pointer":{"id":"f5723e6a-d0c3-4e40-bdeb-0711b0a7eeb6","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"},"block_preserve_scale":true},"created_time":1724511734717,"last_edited_time":1724511734718,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"f5723e6a-d0c3-4e40-bdeb-0711b0a7eeb6","file_ids":["79cf5471-dca4-4a90-a6ee-9ec25beb9771"],"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"YvTervaKVd9eWWwnT85wUg,\"start\",\"end\"","n":{"YvTervaKVd9eWWwnT85wUg,\"start\",\"end\"":{"s":{"x":"YvTervaKVd9eWWwnT85wUg","i":[{"t":"s"},{"t":"t","i":["08tj5h6wbiCV",1],"o":"start","l":8,"c":"Untitled"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"9374f8ca-0db0-46d6-8a44-bd8f825d731e":{"value":{"id":"9374f8ca-0db0-46d6-8a44-bd8f825d731e","version":7,"type":"text","format":{"copied_from_pointer":{"id":"ede23c45-4eb4-428b-8494-d4fcc950c2f1","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734397,"last_edited_time":1724511734398,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"ede23c45-4eb4-428b-8494-d4fcc950c2f1","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"IozfzMuwNyOqF797pnS5yA,\"start\",\"end\"","n":{"IozfzMuwNyOqF797pnS5yA,\"start\",\"end\"":{"s":{"x":"IozfzMuwNyOqF797pnS5yA","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"7c1c4ce9-4e19-43d7-86b5-6207c665bbf9":{"value":{"id":"7c1c4ce9-4e19-43d7-86b5-6207c665bbf9","version":11,"type":"image","properties":{"size":[["41.4KB"]],"title":[["Untitled"]],"source":[["https://prod-files-secure.s3.us-west-2.amazonaws.com/4cc04375-345a-4a1e-bdf0-3a7c88ef0425/22ca52d1-17b5-4860-aa1b-4da95b25cc58/Untitled.png"]]},"format":{"block_width":707.9921875,"display_source":"https://prod-files-secure.s3.us-west-2.amazonaws.com/4cc04375-345a-4a1e-bdf0-3a7c88ef0425/22ca52d1-17b5-4860-aa1b-4da95b25cc58/Untitled.png","block_full_width":false,"block_page_width":true,"block_aspect_ratio":0.3741319444444444,"copied_from_pointer":{"id":"135bd376-0884-422a-b90c-90e7a2ada4cd","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"},"block_preserve_scale":true},"created_time":1724511734529,"last_edited_time":1728383254658,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"135bd376-0884-422a-b90c-90e7a2ada4cd","file_ids":["22ca52d1-17b5-4860-aa1b-4da95b25cc58"],"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"ptjJK3WvoI078degskO6fA,\"start\",\"end\"","n":{"ptjJK3WvoI078degskO6fA,\"start\",\"end\"":{"s":{"x":"ptjJK3WvoI078degskO6fA","i":[{"t":"s"},{"t":"t","i":["ZlusbgCsQ4Q6",1],"o":"start","l":8,"c":"Untitled"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"0ecfb0ba-a047-4a58-ac81-55cb200e0303":{"value":{"id":"0ecfb0ba-a047-4a58-ac81-55cb200e0303","version":11,"type":"image","properties":{"size":[["38.3KB"]],"title":[["Untitled"]],"source":[["https://prod-files-secure.s3.us-west-2.amazonaws.com/4cc04375-345a-4a1e-bdf0-3a7c88ef0425/e9c48585-311b-4ce5-a5c7-3c73dabcbc57/Untitled.png"]]},"format":{"block_width":707.9921875,"display_source":"https://prod-files-secure.s3.us-west-2.amazonaws.com/4cc04375-345a-4a1e-bdf0-3a7c88ef0425/e9c48585-311b-4ce5-a5c7-3c73dabcbc57/Untitled.png","block_full_width":false,"block_page_width":true,"block_aspect_ratio":0.3741319444444444,"copied_from_pointer":{"id":"3e3a8887-3e4f-41ae-a8e0-c73007ba135a","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"},"block_preserve_scale":true},"created_time":1724511734517,"last_edited_time":1728383254637,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"3e3a8887-3e4f-41ae-a8e0-c73007ba135a","file_ids":["e9c48585-311b-4ce5-a5c7-3c73dabcbc57"],"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"O3x0yxgb_LcHSGsCNG25sA,\"start\",\"end\"","n":{"O3x0yxgb_LcHSGsCNG25sA,\"start\",\"end\"":{"s":{"x":"O3x0yxgb_LcHSGsCNG25sA","i":[{"t":"s"},{"t":"t","i":["yUX13RJ4kebo",1],"o":"start","l":8,"c":"Untitled"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"3061abd7-6d2b-46b6-b730-aa48e3f77b10":{"value":{"id":"3061abd7-6d2b-46b6-b730-aa48e3f77b10","version":7,"type":"text","format":{"copied_from_pointer":{"id":"138ad408-5d5a-4730-a010-aeea97619966","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734554,"last_edited_time":1724511734555,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"138ad408-5d5a-4730-a010-aeea97619966","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"9JvOsfHzpeku9VXgKbnycA,\"start\",\"end\"","n":{"9JvOsfHzpeku9VXgKbnycA,\"start\",\"end\"":{"s":{"x":"9JvOsfHzpeku9VXgKbnycA","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"686b6265-1ca1-4dfb-b625-582ee5e0884a":{"value":{"id":"686b6265-1ca1-4dfb-b625-582ee5e0884a","version":9,"type":"header","properties":{"title":[["Summary"]]},"format":{"copied_from_pointer":{"id":"b8d6a237-95cb-498b-b1d4-2754da06f777","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734559,"last_edited_time":1724511734560,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"b8d6a237-95cb-498b-b1d4-2754da06f777","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"lc2JjJzcbArbFALBM6lUDA,\"start\",\"end\"","n":{"lc2JjJzcbArbFALBM6lUDA,\"start\",\"end\"":{"s":{"x":"lc2JjJzcbArbFALBM6lUDA","i":[{"t":"s"},{"t":"t","i":["LqV0-2Vb5giV",1],"o":"start","l":7,"c":"Summary"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"5f3918d4-e456-458a-a4f3-1d9cae3ccefb":{"value":{"id":"5f3918d4-e456-458a-a4f3-1d9cae3ccefb","version":20,"type":"text","properties":{"title":[["总的来说，Longhorn 架构简洁，基于简单朴素的想法构建，又很好地复用了已有的成熟组件，无论是基于 K8s 的控制面，还是 V1 Engine 中的 sparse file，tgtd，nfs ganesha，V2 Engine 的 SPDK，都是这种想法的体现。使用起来也很友好"]]},"format":{"copied_from_pointer":{"id":"5a964d6f-03ef-449a-b81a-a8cc8759f200","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511737027,"last_edited_time":1725376126510,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"5a964d6f-03ef-449a-b81a-a8cc8759f200","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"Eib-0cP0CKwyHEsAQpKk2Q,\"start\",\"end\"","n":{"Eib-0cP0CKwyHEsAQpKk2Q,\"start\",\"end\"":{"s":{"x":"Eib-0cP0CKwyHEsAQpKk2Q","i":[{"t":"s"},{"t":"t","i":["smFzSNSi2v_Q",1],"o":"start","l":141,"c":"总的来说，Longhorn 架构简洁，基于简单朴素的想法构建，又很好地复用了已有的成熟组件，无论是基于 K8s 的控制面，还是 V1 Engine 中的 sparse file，tgtd，nfs ganesha，V2 Engine 的 SPDK，都是这种想法的体现。使用起来也很友好"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"6d3d53a8-874b-4d2a-8fa4-21e088da8416":{"value":{"id":"6d3d53a8-874b-4d2a-8fa4-21e088da8416","version":398,"type":"text","properties":{"title":[["缺点是一旦有舒适区内无法满足的需求，就会比较麻烦。例如现在已经修改了 tgtd 和 nfs ganesha，但这种零碎的修改又很难维护，特别是 SPDK 不是简单包装一下就可以产品化的，这在未来可能会是一个挑战。另外，存算融合也可能会导致负载互相影响，进一步降低性能，控制面的调度收敛速度估计也受限于 K8s，万卷规模时各种 CR 可能就数十万个了，而 etcd 还是单 Raft Group 的，瓶颈明显"]]},"format":{"copied_from_pointer":{"id":"2c988f6e-5776-4daa-93ca-3a530c4a207c","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734920,"last_edited_time":1726287669216,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"2c988f6e-5776-4daa-93ca-3a530c4a207c","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"cjTo3nWp829dz_CPJuMjWg,\"start\",\"end\"","n":{"cjTo3nWp829dz_CPJuMjWg,\"start\",\"end\"":{"s":{"x":"cjTo3nWp829dz_CPJuMjWg","i":[{"t":"s"},{"t":"t","i":["dl6FyOm8k0kT",1],"o":"start","l":203,"c":"缺点是一旦有舒适区内无法满足的需求，就会比较麻烦。例如现在已经修改了 tgtd 和 nfs ganesha，但这种零碎的修改又很难维护，特别是 SPDK 不是简单包装一下就可以产品化的，这在未来可能会是一个挑战。另外，存算融合也可能会导致负载互相影响，进一步降低性能，控制面的调度收敛速度估计也受限于 K8s，万卷规模时各种 CR 可能就数十万个了，而 etcd 还是单 Raft Group 的，瓶颈明显"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"9d6ff8c0-b08d-4ba5-9e87-10d7409735b8":{"value":{"id":"9d6ff8c0-b08d-4ba5-9e87-10d7409735b8","version":7,"type":"text","format":{"copied_from_pointer":{"id":"942f6fef-53d5-49cf-9e59-187ed6d15590","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734643,"last_edited_time":1724511734644,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"942f6fef-53d5-49cf-9e59-187ed6d15590","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"lbdS4XsxezTS2dvpdBja8A,\"start\",\"end\"","n":{"lbdS4XsxezTS2dvpdBja8A,\"start\",\"end\"":{"s":{"x":"lbdS4XsxezTS2dvpdBja8A","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"9ab0b35f-8474-4bda-ab45-6c0090f7e85a":{"value":{"id":"9ab0b35f-8474-4bda-ab45-6c0090f7e85a","version":9,"type":"text","properties":{"title":[["后续可以考虑的优化点不少，首先存储层就不支持 chunk/block 之类的 partition，这直接限制了单个卷能提供的容量，而且没有细粒度的 partition，容错和调度都会不够灵活。现在 rebuild 都是全量的，不仅影响速度，在大卷时这样的流量对集群也有压力。最后是一些业务功能，例如 QoS 等比较刚需的还不支持"]]},"format":{"copied_from_pointer":{"id":"24d1c10e-19b3-4dce-90bd-419a00f2e451","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734916,"last_edited_time":1724511734917,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"24d1c10e-19b3-4dce-90bd-419a00f2e451","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"IpTZKi5b-aFpfU5nemb-LQ,\"start\",\"end\"","n":{"IpTZKi5b-aFpfU5nemb-LQ,\"start\",\"end\"":{"s":{"x":"IpTZKi5b-aFpfU5nemb-LQ","i":[{"t":"s"},{"t":"t","i":["D7OCtk8ROgdu",1],"o":"start","l":164,"c":"后续可以考虑的优化点不少，首先存储层就不支持 chunk/block 之类的 partition，这直接限制了单个卷能提供的容量，而且没有细粒度的 partition，容错和调度都会不够灵活。现在 rebuild 都是全量的，不仅影响速度，在大卷时这样的流量对集群也有压力。最后是一些业务功能，例如 QoS 等比较刚需的还不支持"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"0c280a67-7c33-4976-a0cf-4f6c5163704c":{"value":{"id":"0c280a67-7c33-4976-a0cf-4f6c5163704c","version":8,"type":"text","properties":{"title":[["Longhorn 的性能、扩展性和容错可以说都是很差的，但却仍然有着不少的应用，这不禁让我想起同事说过的一句话：「大部分客户和场景根本不在乎性能，只关注成本、易用性和稳定性」"]]},"created_time":1725376151186,"last_edited_time":1725376151441,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"yHMk0kn4U9Grllts6gMoHQ,\"start\",\"end\"","n":{"yHMk0kn4U9Grllts6gMoHQ,\"start\",\"end\"":{"s":{"x":"yHMk0kn4U9Grllts6gMoHQ","i":[{"t":"s"},{"t":"t","i":["2xGMmGM5NET2",1],"o":"start","l":87,"c":"Longhorn 的性能、扩展性和容错可以说都是很差的，但却仍然有着不少的应用，这不禁让我想起同事说过的一句话：「大部分客户和场景根本不在乎性能，只关注成本、易用性和稳定性」"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"c393f09a-44db-483d-bcb2-644c4df77ce0":{"value":{"id":"c393f09a-44db-483d-bcb2-644c4df77ce0","version":9,"type":"text","properties":{"title":[["值得一提的是 Longhorn 的文档写的很不错，大部分 feature 都有详细提案文档和需求来源追溯，这点非常好，还是很适合作为入门学习的分布式存储项目"]]},"format":{"copied_from_pointer":{"id":"d2fb03f8-47c5-455c-8fc7-75e3991c340f","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734898,"last_edited_time":1724511734899,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"d2fb03f8-47c5-455c-8fc7-75e3991c340f","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"aw2bKfSxAI13vwT5ImbzoA,\"start\",\"end\"","n":{"aw2bKfSxAI13vwT5ImbzoA,\"start\",\"end\"":{"s":{"x":"aw2bKfSxAI13vwT5ImbzoA","i":[{"t":"s"},{"t":"t","i":["CTrZRz2yGRhr",1],"o":"start","l":78,"c":"值得一提的是 Longhorn 的文档写的很不错，大部分 feature 都有详细提案文档和需求来源追溯，这点非常好，还是很适合作为入门学习的分布式存储项目"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"c069cf00-c156-44ed-ab96-a083efce6fd1":{"value":{"id":"c069cf00-c156-44ed-ab96-a083efce6fd1","version":5,"type":"text","created_time":1725376153388,"last_edited_time":1725376153394,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"q57iVjcTfLN4yG5ev_cG-w,\"start\",\"end\"","n":{"q57iVjcTfLN4yG5ev_cG-w,\"start\",\"end\"":{"s":{"x":"q57iVjcTfLN4yG5ev_cG-w","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"2140495b-b704-4178-900a-da12d68daed7":{"value":{"id":"2140495b-b704-4178-900a-da12d68daed7","version":7,"type":"text","format":{"copied_from_pointer":{"id":"b8dc01b8-c03d-4930-ba7d-2293937040a3","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734425,"last_edited_time":1724511734426,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"b8dc01b8-c03d-4930-ba7d-2293937040a3","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"FZfjO2u3YyUAofGeJ6EP-w,\"start\",\"end\"","n":{"FZfjO2u3YyUAofGeJ6EP-w,\"start\",\"end\"":{"s":{"x":"FZfjO2u3YyUAofGeJ6EP-w","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"c09c9fd4-e8e9-4e64-84bf-861b297ba597":{"value":{"id":"c09c9fd4-e8e9-4e64-84bf-861b297ba597","version":9,"type":"text","properties":{"title":[["Ref："]]},"format":{"copied_from_pointer":{"id":"cbb43301-180e-4316-8654-796a187175e0","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734899,"last_edited_time":1724511734900,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"cbb43301-180e-4316-8654-796a187175e0","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"4Dv0lFYdKP23zUorRFTt_w,\"start\",\"end\"","n":{"4Dv0lFYdKP23zUorRFTt_w,\"start\",\"end\"":{"s":{"x":"4Dv0lFYdKP23zUorRFTt_w","i":[{"t":"s"},{"t":"t","i":["trxMucowhsaP",1],"o":"start","l":4,"c":"Ref："},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"1bed0ccd-d957-4d18-aab8-44bde9182313":{"value":{"id":"1bed0ccd-d957-4d18-aab8-44bde9182313","version":5,"type":"bulleted_list","properties":{"title":[["Longhorn | Architecture and Concepts",[["a","https://longhorn.io/docs/1.6.2/concepts/"]]]]},"created_time":1724518461002,"last_edited_time":1724518461013,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"BD70ctfDwBZ6_SYnT9KjtQ,\"start\",\"end\"","n":{"BD70ctfDwBZ6_SYnT9KjtQ,\"start\",\"end\"":{"s":{"x":"BD70ctfDwBZ6_SYnT9KjtQ","i":[{"t":"s"},{"t":"t","i":["xJ95K2Ax-8QG",1],"o":"start","l":36,"c":"Longhorn | Architecture and Concepts","b":[{"t":"a","x":"BD70ctfDwBZ6_SYnT9KjtQ","l":"","i":["xJ95K2Ax-8QG",37],"s":{"i":["xJ95K2Ax-8QG",1],"a":"b"},"e":{"i":["xJ95K2Ax-8QG",36],"a":"a"},"a":["a","https://longhorn.io/docs/1.6.2/concepts/"]}],"a":[]},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"98e5ad31-8f3b-4a14-aa61-430ea78f5412":{"value":{"id":"98e5ad31-8f3b-4a14-aa61-430ea78f5412","version":5,"type":"bulleted_list","properties":{"title":[["Architecture Overview For Developers",[["a","https://github.com/longhorn/longhorn/wiki/Architecture-Overview-For-Developers"]]]]},"created_time":1724518461003,"last_edited_time":1724518461013,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"rj1ET8Bwrz9uXBUAlSR7lg,\"start\",\"end\"","n":{"rj1ET8Bwrz9uXBUAlSR7lg,\"start\",\"end\"":{"s":{"x":"rj1ET8Bwrz9uXBUAlSR7lg","i":[{"t":"s"},{"t":"t","i":["HVzRIxw6OSIw",1],"o":"start","l":36,"c":"Architecture Overview For Developers","b":[{"t":"a","x":"rj1ET8Bwrz9uXBUAlSR7lg","l":"","i":["HVzRIxw6OSIw",37],"s":{"i":["HVzRIxw6OSIw",1],"a":"b"},"e":{"i":["HVzRIxw6OSIw",36],"a":"a"},"a":["a","https://github.com/longhorn/longhorn/wiki/Architecture-Overview-For-Developers"]}],"a":[]},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"dadebf59-a65e-4de4-b087-2c5d075b1ab5":{"value":{"id":"dadebf59-a65e-4de4-b087-2c5d075b1ab5","version":5,"type":"bulleted_list","properties":{"title":[["longhorn-engine 源码分析 - Peter Yang's Blog",[["a","https://peteryj.github.io/2020/10/11/longhorn-engine-code-analysis/"]]]]},"created_time":1724518461004,"last_edited_time":1724518461013,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"oxatl3jZyimF9tsN-qtWyg,\"start\",\"end\"","n":{"oxatl3jZyimF9tsN-qtWyg,\"start\",\"end\"":{"s":{"x":"oxatl3jZyimF9tsN-qtWyg","i":[{"t":"s"},{"t":"t","i":["q1QZzwkVMh0j",1],"o":"start","l":40,"c":"longhorn-engine 源码分析 - Peter Yang's Blog","b":[{"t":"a","x":"oxatl3jZyimF9tsN-qtWyg","l":"","i":["q1QZzwkVMh0j",41],"s":{"i":["q1QZzwkVMh0j",1],"a":"b"},"e":{"i":["q1QZzwkVMh0j",40],"a":"a"},"a":["a","https://peteryj.github.io/2020/10/11/longhorn-engine-code-analysis/"]}],"a":[]},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"56a447e1-bf3b-457b-b5ca-22cd6ffade12":{"value":{"id":"56a447e1-bf3b-457b-b5ca-22cd6ffade12","version":5,"type":"bulleted_list","properties":{"title":[["20221123-local-volume.md",[["a","https://github.com/longhorn/longhorn/blob/master/enhancements/20221123-local-volume.md"]]]]},"created_time":1724518461004,"last_edited_time":1724518461013,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"rN8-CzIbQ7udYs8pLozE-g,\"start\",\"end\"","n":{"rN8-CzIbQ7udYs8pLozE-g,\"start\",\"end\"":{"s":{"x":"rN8-CzIbQ7udYs8pLozE-g","i":[{"t":"s"},{"t":"t","i":["h7LiieDVm_8d",1],"o":"start","l":24,"c":"20221123-local-volume.md","b":[{"t":"a","x":"rN8-CzIbQ7udYs8pLozE-g","l":"","i":["h7LiieDVm_8d",25],"s":{"i":["h7LiieDVm_8d",1],"a":"b"},"e":{"i":["h7LiieDVm_8d",24],"a":"a"},"a":["a","https://github.com/longhorn/longhorn/blob/master/enhancements/20221123-local-volume.md"]}],"a":[]},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"f68dbe3d-3301-4bff-8b82-3140ef4fa3e6":{"value":{"id":"f68dbe3d-3301-4bff-8b82-3140ef4fa3e6","version":5,"type":"bulleted_list","properties":{"title":[["Longhorn 的正确使用姿势：如何处理增量 replica 与其中的 snapshot/backup",[["a","https://mp.weixin.qq.com/s/9eFYJ5OFRrShaKJezxV6Bg"]]]]},"created_time":1724518461004,"last_edited_time":1724518461013,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"xuzWkVGMfDtd1kPffkWOUQ,\"start\",\"end\"","n":{"xuzWkVGMfDtd1kPffkWOUQ,\"start\",\"end\"":{"s":{"x":"xuzWkVGMfDtd1kPffkWOUQ","i":[{"t":"s"},{"t":"t","i":["-08BFJi3dhuh",1],"o":"start","l":52,"c":"Longhorn 的正确使用姿势：如何处理增量 replica 与其中的 snapshot/backup","b":[{"t":"a","x":"xuzWkVGMfDtd1kPffkWOUQ","l":"","i":["-08BFJi3dhuh",53],"s":{"i":["-08BFJi3dhuh",1],"a":"b"},"e":{"i":["-08BFJi3dhuh",52],"a":"a"},"a":["a","https://mp.weixin.qq.com/s/9eFYJ5OFRrShaKJezxV6Bg"]}],"a":[]},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"83198b20-b262-4546-98b6-2893f220808e":{"value":{"id":"83198b20-b262-4546-98b6-2893f220808e","version":5,"type":"bulleted_list","properties":{"title":[["Longhorn | ReadWriteMany (RWX) Volume",[["a","https://longhorn.io/docs/1.6.2/nodes-and-volumes/volumes/rwx-volumes/"]]]]},"created_time":1724518461004,"last_edited_time":1724518461013,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"Wb6RexKHmZSPQBRpxcFMvw,\"start\",\"end\"","n":{"Wb6RexKHmZSPQBRpxcFMvw,\"start\",\"end\"":{"s":{"x":"Wb6RexKHmZSPQBRpxcFMvw","i":[{"t":"s"},{"t":"t","i":["CeAz-xexXzmH",1],"o":"start","l":37,"c":"Longhorn | ReadWriteMany (RWX) Volume","b":[{"t":"a","x":"Wb6RexKHmZSPQBRpxcFMvw","l":"","i":["CeAz-xexXzmH",38],"s":{"i":["CeAz-xexXzmH",1],"a":"b"},"e":{"i":["CeAz-xexXzmH",37],"a":"a"},"a":["a","https://longhorn.io/docs/1.6.2/nodes-and-volumes/volumes/rwx-volumes/"]}],"a":[]},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"e775ef1a-31f5-42a4-9a95-cef860c10fe3":{"value":{"id":"e775ef1a-31f5-42a4-9a95-cef860c10fe3","version":5,"type":"bulleted_list","properties":{"title":[["20201220-rwx-volume-support.md",[["a","https://github.com/longhorn/longhorn/blob/master/enhancements/20201220-rwx-volume-support.md"]]]]},"created_time":1724518461004,"last_edited_time":1724518461013,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"RtS006sq_XZ9HmiRWoTg3Q,\"start\",\"end\"","n":{"RtS006sq_XZ9HmiRWoTg3Q,\"start\",\"end\"":{"s":{"x":"RtS006sq_XZ9HmiRWoTg3Q","i":[{"t":"s"},{"t":"t","i":["9-O6bbLFBrdD",1],"o":"start","l":30,"c":"20201220-rwx-volume-support.md","b":[{"t":"a","x":"RtS006sq_XZ9HmiRWoTg3Q","l":"","i":["9-O6bbLFBrdD",31],"s":{"i":["9-O6bbLFBrdD",1],"a":"b"},"e":{"i":["9-O6bbLFBrdD",30],"a":"a"},"a":["a","https://github.com/longhorn/longhorn/blob/master/enhancements/20201220-rwx-volume-support.md"]}],"a":[]},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"04a72dc6-b4cd-42a9-b679-7b9ed1c9727a":{"value":{"id":"04a72dc6-b4cd-42a9-b679-7b9ed1c9727a","version":5,"type":"bulleted_list","properties":{"title":[["20220727-dedicated-recovery-backend-for-rwx-volume-nfs-server.md",[["a","https://github.com/longhorn/longhorn/blob/d5e8a44104f5e03c310870b47da7c8ab55f671b3/enhancements/20220727-dedicated-recovery-backend-for-rwx-volume-nfs-server.md"]]]]},"created_time":1724518461005,"last_edited_time":1724518461013,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"Z-h8uer_RXQK3tMnOW3L-g,\"start\",\"end\"","n":{"Z-h8uer_RXQK3tMnOW3L-g,\"start\",\"end\"":{"s":{"x":"Z-h8uer_RXQK3tMnOW3L-g","i":[{"t":"s"},{"t":"t","i":["ipLn9JdmHLq1",1],"o":"start","l":64,"c":"20220727-dedicated-recovery-backend-for-rwx-volume-nfs-server.md","b":[{"t":"a","x":"Z-h8uer_RXQK3tMnOW3L-g","l":"","i":["ipLn9JdmHLq1",65],"s":{"i":["ipLn9JdmHLq1",1],"a":"b"},"e":{"i":["ipLn9JdmHLq1",64],"a":"a"},"a":["a","https://github.com/longhorn/longhorn/blob/d5e8a44104f5e03c310870b47da7c8ab55f671b3/enhancements/20220727-dedicated-recovery-backend-for-rwx-volume-nfs-server.md"]}],"a":[]},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"e1d05407-c208-4f5c-9af0-1c1621143b4d":{"value":{"id":"e1d05407-c208-4f5c-9af0-1c1621143b4d","version":5,"type":"bulleted_list","properties":{"title":[["20230619-spdk-engine.md",[["a","https://github.com/longhorn/longhorn/blob/master/enhancements/20230619-spdk-engine.md"]]]]},"created_time":1724518461005,"last_edited_time":1724518461013,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"EYZPXmdUoKpmqa28ayA6IA,\"start\",\"end\"","n":{"EYZPXmdUoKpmqa28ayA6IA,\"start\",\"end\"":{"s":{"x":"EYZPXmdUoKpmqa28ayA6IA","i":[{"t":"s"},{"t":"t","i":["J7lP3hBlvar8",1],"o":"start","l":23,"c":"20230619-spdk-engine.md","b":[{"t":"a","x":"EYZPXmdUoKpmqa28ayA6IA","l":"","i":["J7lP3hBlvar8",24],"s":{"i":["J7lP3hBlvar8",1],"a":"b"},"e":{"i":["J7lP3hBlvar8",23],"a":"a"},"a":["a","https://github.com/longhorn/longhorn/blob/master/enhancements/20230619-spdk-engine.md"]}],"a":[]},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"cd732eaa-43e7-4483-a122-e424226f982d":{"value":{"id":"cd732eaa-43e7-4483-a122-e424226f982d","version":5,"type":"bulleted_list","properties":{"title":[["SPDK: Logical Volumes",[["a","https://spdk.io/doc/logical_volumes.html"]]]]},"created_time":1724518461005,"last_edited_time":1724518461013,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"J8eSZx5LAvdYHkki8F3hkA,\"start\",\"end\"","n":{"J8eSZx5LAvdYHkki8F3hkA,\"start\",\"end\"":{"s":{"x":"J8eSZx5LAvdYHkki8F3hkA","i":[{"t":"s"},{"t":"t","i":["zannucwdvyth",1],"o":"start","l":21,"c":"SPDK: Logical Volumes","b":[{"t":"a","x":"J8eSZx5LAvdYHkki8F3hkA","l":"","i":["zannucwdvyth",22],"s":{"i":["zannucwdvyth",1],"a":"b"},"e":{"i":["zannucwdvyth",21],"a":"a"},"a":["a","https://spdk.io/doc/logical_volumes.html"]}],"a":[]},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"e17fae7a-31b6-4bbd-b325-5589cf7abcd3":{"value":{"id":"e17fae7a-31b6-4bbd-b325-5589cf7abcd3","version":5,"type":"bulleted_list","properties":{"title":[["SPDK: NVMe over Fabrics Target",[["a","https://spdk.io/doc/nvmf.html"]]]]},"created_time":1724518461005,"last_edited_time":1724518461013,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"6BslcgAfTbDkrFe0Z9btWg,\"start\",\"end\"","n":{"6BslcgAfTbDkrFe0Z9btWg,\"start\",\"end\"":{"s":{"x":"6BslcgAfTbDkrFe0Z9btWg","i":[{"t":"s"},{"t":"t","i":["gfai80zz2Nee",1],"o":"start","l":30,"c":"SPDK: NVMe over Fabrics Target","b":[{"t":"a","x":"6BslcgAfTbDkrFe0Z9btWg","l":"","i":["gfai80zz2Nee",31],"s":{"i":["gfai80zz2Nee",1],"a":"b"},"e":{"i":["gfai80zz2Nee",30],"a":"a"},"a":["a","https://spdk.io/doc/nvmf.html"]}],"a":[]},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"5f63c08e-8e7c-4c32-ab83-ecb2a9a3c6e1":{"value":{"id":"5f63c08e-8e7c-4c32-ab83-ecb2a9a3c6e1","version":5,"type":"bulleted_list","properties":{"title":[["SPDK: Block Device User Guide",[["a","https://spdk.io/doc/bdev.html"]]]]},"created_time":1724518461005,"last_edited_time":1724518461013,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"qmajgwMZRwJb1qvXEVYKUg,\"start\",\"end\"","n":{"qmajgwMZRwJb1qvXEVYKUg,\"start\",\"end\"":{"s":{"x":"qmajgwMZRwJb1qvXEVYKUg","i":[{"t":"s"},{"t":"t","i":["_UHHMbvVYhVP",1],"o":"start","l":29,"c":"SPDK: Block Device User Guide","b":[{"t":"a","x":"qmajgwMZRwJb1qvXEVYKUg","l":"","i":["_UHHMbvVYhVP",30],"s":{"i":["_UHHMbvVYhVP",1],"a":"b"},"e":{"i":["_UHHMbvVYhVP",29],"a":"a"},"a":["a","https://spdk.io/doc/bdev.html"]}],"a":[]},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"cf49f8d4-38da-4731-9a0a-e82178d7bf33":{"value":{"id":"cf49f8d4-38da-4731-9a0a-e82178d7bf33","version":5,"type":"bulleted_list","properties":{"title":[["v2 volume replica online rebuilding",[["a","https://github.com/longhorn/longhorn/issues/7199"]]]]},"created_time":1724518461005,"last_edited_time":1724518461013,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"iiPM4riUBs88tBtWm0q-eA,\"start\",\"end\"","n":{"iiPM4riUBs88tBtWm0q-eA,\"start\",\"end\"":{"s":{"x":"iiPM4riUBs88tBtWm0q-eA","i":[{"t":"s"},{"t":"t","i":["sKp4PXMNUziY",1],"o":"start","l":35,"c":"v2 volume replica online rebuilding","b":[{"t":"a","x":"iiPM4riUBs88tBtWm0q-eA","l":"","i":["sKp4PXMNUziY",36],"s":{"i":["sKp4PXMNUziY",1],"a":"b"},"e":{"i":["sKp4PXMNUziY",35],"a":"a"},"a":["a","https://github.com/longhorn/longhorn/issues/7199"]}],"a":[]},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"e45463e9-4b21-4574-84b3-b20328c00b1e":{"value":{"id":"e45463e9-4b21-4574-84b3-b20328c00b1e","version":5,"type":"bulleted_list","properties":{"title":[["20231030-spdk-raid-delta-copy.md",[["a","https://github.com/longhorn/longhorn/blob/b58a7a3849e12fa4674723c1ce0dfe708fd8423a/enhancements/20231030-spdk-raid-delta-copy.md"]]]]},"created_time":1724518461005,"last_edited_time":1724518461013,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"m3LemQ2IlospcHO3mV6A5A,\"start\",\"end\"","n":{"m3LemQ2IlospcHO3mV6A5A,\"start\",\"end\"":{"s":{"x":"m3LemQ2IlospcHO3mV6A5A","i":[{"t":"s"},{"t":"t","i":["NkoxWYK78xKG",1],"o":"start","l":32,"c":"20231030-spdk-raid-delta-copy.md","b":[{"t":"a","x":"m3LemQ2IlospcHO3mV6A5A","l":"","i":["NkoxWYK78xKG",33],"s":{"i":["NkoxWYK78xKG",1],"a":"b"},"e":{"i":["NkoxWYK78xKG",32],"a":"a"},"a":["a","https://github.com/longhorn/longhorn/blob/b58a7a3849e12fa4674723c1ce0dfe708fd8423a/enhancements/20231030-spdk-raid-delta-copy.md"]}],"a":[]},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"22612c4b-1c3b-468b-a2c8-af7dacb56a95":{"value":{"id":"22612c4b-1c3b-468b-a2c8-af7dacb56a95","version":5,"type":"bulleted_list","properties":{"title":[["Longhorn | Performance",[["a","https://longhorn.io/docs/1.6.2/v2-data-engine/performance/"]]]]},"created_time":1724518461005,"last_edited_time":1724518461013,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"feS0E4FsbVpgeFUgT0IDtA,\"start\",\"end\"","n":{"feS0E4FsbVpgeFUgT0IDtA,\"start\",\"end\"":{"s":{"x":"feS0E4FsbVpgeFUgT0IDtA","i":[{"t":"s"},{"t":"t","i":["tB4YaHkBbAfG",1],"o":"start","l":22,"c":"Longhorn | Performance","b":[{"t":"a","x":"feS0E4FsbVpgeFUgT0IDtA","l":"","i":["tB4YaHkBbAfG",23],"s":{"i":["tB4YaHkBbAfG",1],"a":"b"},"e":{"i":["tB4YaHkBbAfG",22],"a":"a"},"a":["a","https://longhorn.io/docs/1.6.2/v2-data-engine/performance/"]}],"a":[]},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"},"5df8b116-0c77-4e2d-af6a-52a44b086766":{"value":{"id":"5df8b116-0c77-4e2d-af6a-52a44b086766","version":7,"type":"text","format":{"copied_from_pointer":{"id":"410faafa-fc03-4302-8fdb-d0129baa6203","table":"block","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"}},"created_time":1724511734526,"last_edited_time":1724511734527,"parent_id":"bde25ba8-2381-4da6-bb5e-5787ace45def","parent_table":"block","alive":true,"copied_from":"410faafa-fc03-4302-8fdb-d0129baa6203","space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","crdt_format_version":1,"crdt_data":{"title":{"r":"wxR83MbGiQcZzA-dsfub8A,\"start\",\"end\"","n":{"wxR83MbGiQcZzA-dsfub8A,\"start\",\"end\"":{"s":{"x":"wxR83MbGiQcZzA-dsfub8A","i":[{"t":"s"},{"t":"e"}],"l":""},"c":[]}}}}},"role":"reader"}},"collection":{"0bb2e606-8d0c-4f7c-aca9-70986e90c055":{"value":{"id":"0bb2e606-8d0c-4f7c-aca9-70986e90c055","version":85,"name":[["x³u³"]],"description":[["🗒 碎碎念"]],"schema":{"@NcA":{"name":"password","type":"text"},"Dj]h":{"name":"icon","type":"text"},"NX\\Q":{"name":"date","type":"date","date_format":"YYYY/MM/DD"},"`gQ~":{"name":"type","type":"select","options":[{"id":"5aff2f95-fd1e-489b-8840-bf10bc9519cb","color":"purple","value":"Post","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"374d2bc6-a144-4832-8ca4-474aaae0ea1f","color":"orange","value":"Page","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"95b7fea5-98b3-476e-892f-79e8f36d0633","color":"brown","value":"Notice","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"2287395b-9f64-4852-b46f-ff3df4b4acef","color":"yellow","value":"Menu","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"50fefd65-c28e-4806-9183-aa12995f11f3","color":"pink","value":"SubMenu","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"b945f57d-dbcc-4603-9fab-5cfe447aad1b","color":"red","value":"Config","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]}]},"bB{M":{"name":"category","type":"select"},"d]hq":{"name":"slug","type":"text"},"sD^m":{"name":"tags","type":"multi_select","options":[{"id":"a027d99d-be10-412d-b94a-8c61f6eacc29","color":"default","value":"存储","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"4bd9608a-d7d6-4597-beb7-d4849da04909","color":"gray","value":"分布式系统","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"ad04c718-fd54-4374-bfed-6c7e9dc65e01","color":"blue","value":"折腾","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"25bff120-77fb-40f1-9531-00997afcb444","color":"purple","value":"Linux","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"e12d005d-ec78-4876-950d-2399744abbaa","color":"blue","value":"内核","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"c7950cbd-8d2c-4cbe-8bb1-679fb433a74f","color":"red","value":"碎碎念","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"be9970b9-6fe4-4351-92c2-1e3e41d2a3e3","color":"brown","value":"Cloud Native","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"61c97435-c65a-40b1-9e95-2c6345b6f9d3","color":"pink","value":"Vim","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"d18e22d6-cbbb-4311-9928-7c5b58124456","color":"orange","value":"论文阅读","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"526115da-04f3-4be2-8a47-c83c7576b0de","color":"green","value":"Kubernetes","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"12016016-3ecc-4ee7-92c6-6973678fdd05","color":"yellow","value":"数据库","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"1edc83b3-f351-4a21-aafc-3b059d0c0f22","color":"brown","value":"Raft","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"158014da-08eb-49f4-97ad-1ce6f6e0ee5c","color":"orange","value":"Rust","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"e93f6dd2-caed-4531-9ee1-28fc2cbf1811","color":"yellow","value":"旅行","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"c885be61-3b71-4d5f-86cc-4da1586e660a","color":"blue","value":"PVE","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"d4f1c8d8-1d0f-47af-a440-4dc14b658610","color":"blue","value":"日语","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"be95bbc7-1806-4b7e-8b58-1f540ac0f223","color":"red","value":"网络","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"9bb01875-d8ae-4914-a41b-5eccd75e824f","color":"blue","value":"操作系统","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"66d0fb9a-8f36-4f9e-98ed-af4057a1773f","color":"default","value":"Nix","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"4e4791ca-d6ec-48f9-9bd6-ad6f4572993a","color":"red","value":"NixOS","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]}]},"wz|S":{"name":"summary","type":"text"},"title":{"name":"title","type":"title"},"f211bdc0-ee00-4186-9a7d-f68c055ec2ee":{"name":"status","type":"select","options":[{"id":"7abc61d4-b405-480d-b699-12588755fa65","color":"red","value":"Published","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"d1242312-e0a8-456d-b8f0-6e998e2c4fb2","color":"orange","value":"Invisible","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]},{"id":"41d5f5c6-b53c-42bc-8e0f-fc9402048480","color":"yellow","value":"Draft","collectionIds":["0bb2e606-8d0c-4f7c-aca9-70986e90c055"]}]}},"icon":"https://prod-files-secure.s3.us-west-2.amazonaws.com/4cc04375-345a-4a1e-bdf0-3a7c88ef0425/49b4570c-b2f0-457b-81b7-b68e2693a471/avatar.png","cover":"https://prod-files-secure.s3.us-west-2.amazonaws.com/4cc04375-345a-4a1e-bdf0-3a7c88ef0425/a9af1d6b-f284-4734-ba06-990353cf3f84/Elaina.jpg","format":{"copied_from_pointer":{"id":"4379bc14-5d22-453b-a153-12639616fc01","table":"collection","spaceId":"6c096b44-beb9-48ee-8f92-1efdde47f3a3"},"property_visibility":[{"property":"`gQ~","visibility":"show"},{"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee","visibility":"show"},{"property":"NX\\Q","visibility":"show"},{"property":"d]hq","visibility":"show"},{"property":"wz|S","visibility":"show"},{"property":"sD^m","visibility":"show"},{"property":"bB{M","visibility":"show"},{"property":"Dj]h","visibility":"hide_if_empty"},{"property":"uHoD","visibility":"show"},{"property":"kiCR","visibility":"hide"}],"ai_suggested_properties":[{"name":"created by","type":"person"},{"name":"updated at","type":"date"},{"name":"priority","type":"select","options":[{"id":"OqCJ","color":"purple","value":"low"},{"id":"X{Pz","color":"pink","value":"medium"},{"id":"LRCx","color":"red","value":"high"},{"id":"VY?=","color":"yellow","value":"urgent"}]},{"name":"visibility","type":"select","options":[{"id":"Q=_{","color":"red","value":"public"},{"id":"A|Nj","color":"green","value":"private"},{"id":"MWlx","color":"gray","value":"restricted"}]},{"name":"attachments","type":"file"},{"name":"related links","type":"multi_select","options":[{"id":"I^W\u003e","color":"default","value":"documentation"},{"id":"\u003cg\\P","color":"yellow","value":"tutorials"},{"id":"RMVI","color":"gray","value":"references"}]},{"name":"estimated completion","type":"date"},{"name":"contact email","type":"email"},{"name":"contact phone","type":"phone_number"},{"name":"is active","type":"checkbox"}],"collection_cover_position":0.6486,"collection_page_properties":[{"visible":false,"property":"`gQ~"},{"visible":false,"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"visible":false,"property":"NX\\Q"},{"visible":false,"property":"d]hq"},{"visible":false,"property":"wz|S"},{"visible":false,"property":"sD^m"},{"visible":true,"property":"bB{M"},{"visible":true,"property":"Dj]h"},{"visible":true,"property":"@NcA"},{"visible":true,"property":"ckw_"}],"collection_default_template":{"template_page_id":"2eace25c-842c-46fd-9ccb-e9190981b6c3"}},"parent_id":"0dc306ca-50a6-4917-9b5a-85a61f0f66f5","parent_table":"block","alive":true,"file_ids":["6cf3dc36-2f98-4f0e-9679-1bdbb1485129","5520bd92-e709-4c0d-ad58-06923f23f7e9","624d393a-62e3-4464-a1bf-1c79ecd4fbda","d52f6766-3e32-4c3d-8529-46e1f214360f","abe3a0aa-2aff-4274-81bb-c2443d4ef9e2","a2a32795-101d-46aa-a7f6-eb35b8750166","29db38d2-d5fa-4fa6-8a92-3b527cfe80d1","49b4570c-b2f0-457b-81b7-b68e2693a471","a9af1d6b-f284-4734-ba06-990353cf3f84"],"copied_from":"4379bc14-5d22-453b-a153-12639616fc01","template_pages":["2eace25c-842c-46fd-9ccb-e9190981b6c3"],"migrated":true,"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"},"role":"reader"}},"collection_view":{"2efe7048-0d5f-4e04-8b4e-2a3793ad6aef":{"value":{"id":"2efe7048-0d5f-4e04-8b4e-2a3793ad6aef","version":128,"type":"table","name":"All","format":{"table_wrap":false,"show_page_icon":true,"property_filters":[{"id":"860c7b26-627e-4972-b471-8e8bfca0d897","filter":{"filter":{"value":{"type":"exact"},"operator":"enum_is"},"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"}},{"id":"1c5b2709-6f35-4692-b4db-cb219a62e22d","filter":{"filter":{"value":{"type":"exact"},"operator":"enum_is"},"property":"`gQ~"}}],"table_properties":[{"wrap":false,"width":100,"visible":true,"property":"`gQ~"},{"wrap":false,"width":263,"visible":true,"property":"title"},{"wrap":false,"width":233,"visible":true,"property":"wz|S"},{"wrap":false,"width":100,"visible":true,"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"wrap":false,"width":219,"visible":true,"property":"sD^m"},{"wrap":false,"width":184,"visible":true,"property":"d]hq"},{"wrap":false,"width":111,"visible":true,"property":"NX\\Q"},{"wrap":false,"width":100,"visible":false,"property":"bB{M"},{"wrap":false,"width":117,"visible":false,"property":"Dj]h"},{"wrap":false,"width":100,"visible":false,"property":"@NcA"}],"collection_pointer":{"id":"0bb2e606-8d0c-4f7c-aca9-70986e90c055","table":"collection","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"},"table_frozen_column_index":-1,"collection_view_default_template":{"template_page_id":"2eace25c-842c-46fd-9ccb-e9190981b6c3"}},"parent_id":"0dc306ca-50a6-4917-9b5a-85a61f0f66f5","parent_table":"block","alive":true,"page_sort":["cc459e5b-0f15-4a0c-83db-bb6bf2001aa3","a9bfecc8-9761-4987-9aca-af79d4ebbd0c","7aa40ad8-1e69-4d56-b245-d135d3101cec","e4eefa7d-e2f2-44ed-83f6-fd6951d50900","0f9b7a0d-ad15-4ece-8a8b-948d96b50ff7","58a216ce-4d8d-4b60-906c-6097c5fd8d41","b824f35b-aee9-4a22-81c9-d44b65f99f43","ba565c08-0d2f-46cb-9fcb-5eeface44dfb","560c76dd-c69f-429b-827d-7974407bb23f","0533a861-81cc-40fa-8ab8-5be721800b86","3578fa31-ea0a-4e07-82dc-28704e0dc685","f2625c60-ca69-493b-858c-bf38979f468c","96b14e20-e592-42f6-b7d2-357f4693f18c","fe8fafec-6d1b-4fbb-8a7a-fb079a6bb8e4","9345db3a-b8bd-4e02-b296-9734958eddb6","26e8ddc4-10b4-4765-a96d-e87290556164","840f0871-b58b-428d-8a28-0861947974b4","5787bc4f-06a4-4158-a27f-6c81fb9b1efe","e1bff221-486f-42c8-9cf3-6379f83f3510","2db01777-47d0-4230-bbe8-ef65ab694707","ab0d5acb-9230-4656-9c49-1aff13aba865","98330ff5-71d2-4ea9-945a-ba76fc282e9d","71439e60-5784-4dc5-b71f-e4cd7b0c4304","bfe53f5c-d4bd-4df7-a071-84db62310ad2","0606268b-9014-490d-b84d-d41d4be8df11","c09a05a2-6ab7-41e1-b23c-9e442cd61f6e","13a88756-3979-80cb-a5e6-fd37fcff6613","8bc2fda4-9fb5-4a89-95b8-c8c175e462c2","459c966a-bb34-47d2-ba4c-b1f0509ab033","022b3625-9f9f-42e0-a8a4-64bae1929d2f","d1a9da33-04a6-4f8b-8458-83aabde787be","40557fff-8f06-4643-be33-a0aab52b28be","fee7a505-5f8e-4186-9b2d-4c80ebee5077","df084444-e2d8-412a-bd56-c6b2c1046d5d","10d88756-3979-807a-bc25-cf64eed2ccce","14088756-3979-8047-9d4d-c9c8e2152b95","15c88756-3979-8089-acb1-e4ae25bf3f4f","16488756-3979-80aa-9bba-cf28c50dec07","b1c009da-991f-4449-b945-6bc4584cca98","1c588756-3979-8066-b5ce-f3d0811aa47e","25d88756-3979-8023-9a5a-d926873b7b9b","16e88756-3979-8010-aeb9-d7e49f597453","14688756-3979-80f8-8f88-d0bb8697b4a4","14688756-3979-806c-af3c-f23f4c85d88e","12988756-3979-8065-aeb4-e6ec1258ed90","94e03781-e74c-41d0-89f7-df2e2a7ad93f","11688756-3979-8028-b7d8-ce8bf2ec4253","11d88756-3979-8080-877d-cf9a2d058532","4e5d7fc0-68d5-4165-ba12-b2d8bfc7d92c","5b4b2d85-43c0-4edb-ad2d-0f14d79b4c4b","a06c26b2-5941-43ea-a89e-d0bebab47add","bde25ba8-2381-4da6-bb5e-5787ace45def","0e96a78e-dec9-4620-b0e8-a2b889017cb7","832b2511-aada-4c80-903c-1aadd7db46ce","2672b128-6cb0-4b3a-b54b-6b356a4ffbdd","634565f7-7a6e-4c4e-ac58-77b12c21f7ab","6e0bb534-679f-424e-80b3-e9bee483b7e8","da88c0a2-fce1-4336-97e7-61bc4149027a","0ee52933-5891-4387-a10c-921468884ab4","f086cce1-bf32-4be2-9fab-8529a2186ba3","e50dd6f9-49d4-4c3a-b723-da54361b34d5","3f554fe3-c9cb-4f63-99b2-f90f395308f6","eaf25f44-f59e-48d1-b475-a28066593688","af6f6570-0d18-4c3d-9145-3ee677a60c35","4c1d6186-e507-4ca2-9c02-d32dfbe2cca5","ff668a4c-0b15-45ec-9716-42f1af578ece","ce720858-10b7-4c0c-8083-906f29150a81","9ee7cbfe-3f95-4fc7-aab6-0d03c30a1e1b","3a554c07-e77f-43fa-ba66-ff39cf1e0ca5","4194acae-3f4b-4c08-98b9-907a0b5bd4b9","ce969492-bca9-4a45-8730-9ae753bdd027","368e5462-3dca-4c8b-ab1f-595cb04c56e0","d26ce18a-fa8d-4df4-8b82-69c419c5b621","3327d648-8e54-4edf-a38e-a9cba8884a1a","d5fd419b-4cb7-44c8-a8d7-0c8ed44c1963","deaccfa2-4562-437c-874e-fc5041f3fad5","f26f0a34-d6f1-419a-b91b-e0ea3639fe4b","a23d61e0-cc90-4068-bfb0-986afaf60ac5","cc463e20-63ea-4132-acea-84fc7307dde8","1eecd7c4-1e60-4aff-adbf-ccc85f820ef2","514ae2e3-a0d5-414c-86e5-ed5f8a9eb9c8","7b0eb02d-8b44-45f3-b593-52c0a62f4595","37c4cfd9-62a3-41bb-9989-f9df38c45d04","8aa3f594-ff5d-4f99-b0a2-fa09bb32ba84","806f9f46-c738-4c87-9957-e73d11ec44bd","64ac0e55-b2ae-4c80-8226-7a1f4b4ed8da","4d7cb2a6-768c-42c7-aad0-8e56168076d5","1e5f4845-8e82-4ab1-aad9-0d4c9eed2fde","37e5fc82-97ee-4a59-9d0b-1f44e2977cc9","1ccc4db8-78ca-45b9-947b-5d216a3e0667","f3550fb0-346c-4212-b57f-86433738b50b","7d2888d0-b55f-4909-97bf-944e56f19c0e","d9436315-195f-458c-93ac-09e5b8780171","51b42828-cae5-456b-9c2f-9b4b2232380e","280fbd32-0621-4ccb-babb-5790a693090e","1ffb90ba-821d-4d16-8520-e46604a470d7","adc7c47b-6dd7-439f-9e06-6075256c91a7","d6ba00e3-fb3f-4f30-9fa7-23c0b0712cdd","2eb83ae6-642d-45a1-a8a4-04463c20dc4b","c248bc92-b7a1-4f5b-a0a9-f1d5186a8dae","9900ca48-1c4f-44e3-9dae-ab5bd1633d6c","f9e566d7-45f7-4335-afe7-506247cd0b8e","17788756-3979-808b-90e9-c0a0d9602ea0","a0b1590c-24bd-41dd-a6e0-b3cdac7bb4e6","8c6e229b-cbd3-4dc6-9b49-34f701a8aead","1467d162-f107-4606-b5dc-ec538ede0fdd","09bb7c8f-a916-4a39-bd01-2786a14bacc4","9e017f37-5917-4cda-afb8-92072abdbdba","8aafeb2c-85b4-4c4e-af36-3b9efacb167c","6d0e0705-57f3-4223-8745-a27295245029","dec89a30-7004-499f-a99e-05b2842cad2b","7efc83d4-2645-4578-b588-a9cffb15524a","1769e8de-bebe-4687-a28a-34c15859ed98","203f2c30-a3cd-4f70-95b3-07df9f996428","2a0b435c-6f77-4db8-be6b-831d177bd762","eac01009-c323-46fd-8339-09c282e6597e","c4b37f96-4ab0-4a0b-a16e-55bac3e32990","4ad5c69e-0dab-4d66-b548-360da7d53568","72d89744-ac04-4dd4-be8b-9d629acd7c11","32dc3358-e954-4934-9e71-cf1dfbca5b91","961e45bd-8bed-4ebc-b3d8-1f0e63736d04"],"query2":{"aggregations":[{"property":"title","aggregator":"count"}]},"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425","created_time":1743233875731,"last_edited_time":1756748880461,"created_by_table":"notion_user","created_by_id":"919e7400-5a69-4402-b2e1-f7d99cc48131"},"role":"reader"},"14688756-3979-80e7-97c9-000c212f8370":{"value":{"id":"14688756-3979-80e7-97c9-000c212f8370","version":3,"type":"table","name":"Published Post","format":{"table_wrap":false,"show_page_icon":true,"property_filters":[{"id":"1c5b2709-6f35-4692-b4db-cb219a62e22d","filter":{"filter":{"value":{"type":"exact","value":"Post"},"operator":"enum_is"},"property":"`gQ~"}},{"id":"860c7b26-627e-4972-b471-8e8bfca0d897","filter":{"filter":{"value":{"type":"exact","value":"Published"},"operator":"enum_is"},"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"}}],"table_properties":[{"wrap":false,"width":100,"visible":true,"property":"`gQ~"},{"wrap":false,"width":263,"visible":true,"property":"title"},{"wrap":false,"width":233,"visible":true,"property":"wz|S"},{"wrap":false,"width":100,"visible":true,"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"wrap":false,"width":219,"visible":true,"property":"sD^m"},{"wrap":false,"width":184,"visible":true,"property":"d]hq"},{"wrap":false,"width":111,"visible":true,"property":"NX\\Q"},{"wrap":false,"width":100,"visible":false,"property":"bB{M"},{"wrap":false,"width":117,"visible":false,"property":"Dj]h"},{"wrap":false,"width":100,"visible":false,"property":"@NcA"}],"collection_pointer":{"id":"0bb2e606-8d0c-4f7c-aca9-70986e90c055","table":"collection","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"},"table_frozen_column_index":-1,"collection_view_default_template":{"template_page_id":"2eace25c-842c-46fd-9ccb-e9190981b6c3"}},"parent_id":"0dc306ca-50a6-4917-9b5a-85a61f0f66f5","parent_table":"block","alive":true,"page_sort":["cc459e5b-0f15-4a0c-83db-bb6bf2001aa3","a9bfecc8-9761-4987-9aca-af79d4ebbd0c","7aa40ad8-1e69-4d56-b245-d135d3101cec","e4eefa7d-e2f2-44ed-83f6-fd6951d50900","0f9b7a0d-ad15-4ece-8a8b-948d96b50ff7","58a216ce-4d8d-4b60-906c-6097c5fd8d41","b824f35b-aee9-4a22-81c9-d44b65f99f43","ba565c08-0d2f-46cb-9fcb-5eeface44dfb","560c76dd-c69f-429b-827d-7974407bb23f","0533a861-81cc-40fa-8ab8-5be721800b86","3578fa31-ea0a-4e07-82dc-28704e0dc685","f2625c60-ca69-493b-858c-bf38979f468c","96b14e20-e592-42f6-b7d2-357f4693f18c","fe8fafec-6d1b-4fbb-8a7a-fb079a6bb8e4","9345db3a-b8bd-4e02-b296-9734958eddb6","26e8ddc4-10b4-4765-a96d-e87290556164","840f0871-b58b-428d-8a28-0861947974b4","5787bc4f-06a4-4158-a27f-6c81fb9b1efe","e1bff221-486f-42c8-9cf3-6379f83f3510","2db01777-47d0-4230-bbe8-ef65ab694707","ab0d5acb-9230-4656-9c49-1aff13aba865","98330ff5-71d2-4ea9-945a-ba76fc282e9d","71439e60-5784-4dc5-b71f-e4cd7b0c4304","bfe53f5c-d4bd-4df7-a071-84db62310ad2","0606268b-9014-490d-b84d-d41d4be8df11","c09a05a2-6ab7-41e1-b23c-9e442cd61f6e","13a88756-3979-80cb-a5e6-fd37fcff6613","8bc2fda4-9fb5-4a89-95b8-c8c175e462c2","459c966a-bb34-47d2-ba4c-b1f0509ab033","022b3625-9f9f-42e0-a8a4-64bae1929d2f","d1a9da33-04a6-4f8b-8458-83aabde787be","40557fff-8f06-4643-be33-a0aab52b28be","b1c009da-991f-4449-b945-6bc4584cca98","fee7a505-5f8e-4186-9b2d-4c80ebee5077","df084444-e2d8-412a-bd56-c6b2c1046d5d","10d88756-3979-807a-bc25-cf64eed2ccce","14088756-3979-8047-9d4d-c9c8e2152b95","14688756-3979-806c-af3c-f23f4c85d88e","12988756-3979-8065-aeb4-e6ec1258ed90","94e03781-e74c-41d0-89f7-df2e2a7ad93f","11688756-3979-8028-b7d8-ce8bf2ec4253","11d88756-3979-8080-877d-cf9a2d058532","4e5d7fc0-68d5-4165-ba12-b2d8bfc7d92c","5b4b2d85-43c0-4edb-ad2d-0f14d79b4c4b","a06c26b2-5941-43ea-a89e-d0bebab47add","bde25ba8-2381-4da6-bb5e-5787ace45def","0e96a78e-dec9-4620-b0e8-a2b889017cb7","832b2511-aada-4c80-903c-1aadd7db46ce","2672b128-6cb0-4b3a-b54b-6b356a4ffbdd","634565f7-7a6e-4c4e-ac58-77b12c21f7ab","6e0bb534-679f-424e-80b3-e9bee483b7e8","da88c0a2-fce1-4336-97e7-61bc4149027a","0ee52933-5891-4387-a10c-921468884ab4","f086cce1-bf32-4be2-9fab-8529a2186ba3","e50dd6f9-49d4-4c3a-b723-da54361b34d5","3f554fe3-c9cb-4f63-99b2-f90f395308f6","eaf25f44-f59e-48d1-b475-a28066593688","af6f6570-0d18-4c3d-9145-3ee677a60c35","4c1d6186-e507-4ca2-9c02-d32dfbe2cca5","ff668a4c-0b15-45ec-9716-42f1af578ece","ce720858-10b7-4c0c-8083-906f29150a81","9ee7cbfe-3f95-4fc7-aab6-0d03c30a1e1b","3a554c07-e77f-43fa-ba66-ff39cf1e0ca5","4194acae-3f4b-4c08-98b9-907a0b5bd4b9","ce969492-bca9-4a45-8730-9ae753bdd027","368e5462-3dca-4c8b-ab1f-595cb04c56e0","d26ce18a-fa8d-4df4-8b82-69c419c5b621","3327d648-8e54-4edf-a38e-a9cba8884a1a","d5fd419b-4cb7-44c8-a8d7-0c8ed44c1963","deaccfa2-4562-437c-874e-fc5041f3fad5","f26f0a34-d6f1-419a-b91b-e0ea3639fe4b","a23d61e0-cc90-4068-bfb0-986afaf60ac5","cc463e20-63ea-4132-acea-84fc7307dde8","1eecd7c4-1e60-4aff-adbf-ccc85f820ef2","514ae2e3-a0d5-414c-86e5-ed5f8a9eb9c8","7b0eb02d-8b44-45f3-b593-52c0a62f4595","37c4cfd9-62a3-41bb-9989-f9df38c45d04","8aa3f594-ff5d-4f99-b0a2-fa09bb32ba84","806f9f46-c738-4c87-9957-e73d11ec44bd","64ac0e55-b2ae-4c80-8226-7a1f4b4ed8da","4d7cb2a6-768c-42c7-aad0-8e56168076d5","1e5f4845-8e82-4ab1-aad9-0d4c9eed2fde","37e5fc82-97ee-4a59-9d0b-1f44e2977cc9","1ccc4db8-78ca-45b9-947b-5d216a3e0667","f3550fb0-346c-4212-b57f-86433738b50b","7d2888d0-b55f-4909-97bf-944e56f19c0e","d9436315-195f-458c-93ac-09e5b8780171","51b42828-cae5-456b-9c2f-9b4b2232380e","280fbd32-0621-4ccb-babb-5790a693090e","1ffb90ba-821d-4d16-8520-e46604a470d7","adc7c47b-6dd7-439f-9e06-6075256c91a7","d6ba00e3-fb3f-4f30-9fa7-23c0b0712cdd","2eb83ae6-642d-45a1-a8a4-04463c20dc4b","c248bc92-b7a1-4f5b-a0a9-f1d5186a8dae","9900ca48-1c4f-44e3-9dae-ab5bd1633d6c","f9e566d7-45f7-4335-afe7-506247cd0b8e","a0b1590c-24bd-41dd-a6e0-b3cdac7bb4e6","8c6e229b-cbd3-4dc6-9b49-34f701a8aead","1467d162-f107-4606-b5dc-ec538ede0fdd","09bb7c8f-a916-4a39-bd01-2786a14bacc4","9e017f37-5917-4cda-afb8-92072abdbdba","8aafeb2c-85b4-4c4e-af36-3b9efacb167c","6d0e0705-57f3-4223-8745-a27295245029","dec89a30-7004-499f-a99e-05b2842cad2b","7efc83d4-2645-4578-b588-a9cffb15524a","1769e8de-bebe-4687-a28a-34c15859ed98","203f2c30-a3cd-4f70-95b3-07df9f996428","2a0b435c-6f77-4db8-be6b-831d177bd762","eac01009-c323-46fd-8339-09c282e6597e","c4b37f96-4ab0-4a0b-a16e-55bac3e32990","4ad5c69e-0dab-4d66-b548-360da7d53568","72d89744-ac04-4dd4-be8b-9d629acd7c11","32dc3358-e954-4934-9e71-cf1dfbca5b91","961e45bd-8bed-4ebc-b3d8-1f0e63736d04"],"query2":{"sort":[{"property":"NX\\Q","direction":"descending"}],"aggregations":[{"property":"title","aggregator":"count"}]},"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"},"role":"reader"},"14588756-3979-8039-9990-000cefddccf8":{"value":{"id":"14588756-3979-8039-9990-000cefddccf8","version":11,"type":"table","name":"All Post","format":{"table_wrap":false,"show_page_icon":true,"property_filters":[{"id":"eacd5736-8f45-4d4d-97ce-21001f75dceb","filter":{"filter":{"value":{"type":"exact","value":"Post"},"operator":"enum_is"},"property":"`gQ~"}}],"table_properties":[{"wrap":false,"width":100,"visible":true,"property":"`gQ~"},{"wrap":false,"width":263,"visible":true,"property":"title"},{"wrap":false,"width":233,"visible":true,"property":"wz|S"},{"wrap":false,"width":100,"visible":true,"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"wrap":false,"width":219,"visible":true,"property":"sD^m"},{"wrap":false,"width":184,"visible":true,"property":"d]hq"},{"wrap":false,"width":111,"visible":true,"property":"NX\\Q"},{"wrap":false,"width":100,"visible":false,"property":"bB{M"},{"wrap":false,"width":117,"visible":false,"property":"Dj]h"},{"wrap":false,"width":100,"visible":false,"property":"@NcA"}],"collection_pointer":{"id":"0bb2e606-8d0c-4f7c-aca9-70986e90c055","table":"collection","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"},"table_frozen_column_index":-1,"collection_view_default_template":{"template_page_id":"2eace25c-842c-46fd-9ccb-e9190981b6c3"}},"parent_id":"0dc306ca-50a6-4917-9b5a-85a61f0f66f5","parent_table":"block","alive":true,"page_sort":["cc459e5b-0f15-4a0c-83db-bb6bf2001aa3","a9bfecc8-9761-4987-9aca-af79d4ebbd0c","7aa40ad8-1e69-4d56-b245-d135d3101cec","e4eefa7d-e2f2-44ed-83f6-fd6951d50900","0f9b7a0d-ad15-4ece-8a8b-948d96b50ff7","58a216ce-4d8d-4b60-906c-6097c5fd8d41","b824f35b-aee9-4a22-81c9-d44b65f99f43","ba565c08-0d2f-46cb-9fcb-5eeface44dfb","560c76dd-c69f-429b-827d-7974407bb23f","0533a861-81cc-40fa-8ab8-5be721800b86","3578fa31-ea0a-4e07-82dc-28704e0dc685","f2625c60-ca69-493b-858c-bf38979f468c","96b14e20-e592-42f6-b7d2-357f4693f18c","fe8fafec-6d1b-4fbb-8a7a-fb079a6bb8e4","9345db3a-b8bd-4e02-b296-9734958eddb6","26e8ddc4-10b4-4765-a96d-e87290556164","840f0871-b58b-428d-8a28-0861947974b4","5787bc4f-06a4-4158-a27f-6c81fb9b1efe","e1bff221-486f-42c8-9cf3-6379f83f3510","2db01777-47d0-4230-bbe8-ef65ab694707","ab0d5acb-9230-4656-9c49-1aff13aba865","98330ff5-71d2-4ea9-945a-ba76fc282e9d","71439e60-5784-4dc5-b71f-e4cd7b0c4304","bfe53f5c-d4bd-4df7-a071-84db62310ad2","0606268b-9014-490d-b84d-d41d4be8df11","c09a05a2-6ab7-41e1-b23c-9e442cd61f6e","13a88756-3979-80cb-a5e6-fd37fcff6613","8bc2fda4-9fb5-4a89-95b8-c8c175e462c2","459c966a-bb34-47d2-ba4c-b1f0509ab033","022b3625-9f9f-42e0-a8a4-64bae1929d2f","d1a9da33-04a6-4f8b-8458-83aabde787be","40557fff-8f06-4643-be33-a0aab52b28be","b1c009da-991f-4449-b945-6bc4584cca98","fee7a505-5f8e-4186-9b2d-4c80ebee5077","df084444-e2d8-412a-bd56-c6b2c1046d5d","10d88756-3979-807a-bc25-cf64eed2ccce","14088756-3979-8047-9d4d-c9c8e2152b95","14688756-3979-80f8-8f88-d0bb8697b4a4","14688756-3979-806c-af3c-f23f4c85d88e","12988756-3979-8065-aeb4-e6ec1258ed90","94e03781-e74c-41d0-89f7-df2e2a7ad93f","11688756-3979-8028-b7d8-ce8bf2ec4253","11d88756-3979-8080-877d-cf9a2d058532","4e5d7fc0-68d5-4165-ba12-b2d8bfc7d92c","5b4b2d85-43c0-4edb-ad2d-0f14d79b4c4b","a06c26b2-5941-43ea-a89e-d0bebab47add","bde25ba8-2381-4da6-bb5e-5787ace45def","0e96a78e-dec9-4620-b0e8-a2b889017cb7","832b2511-aada-4c80-903c-1aadd7db46ce","2672b128-6cb0-4b3a-b54b-6b356a4ffbdd","634565f7-7a6e-4c4e-ac58-77b12c21f7ab","6e0bb534-679f-424e-80b3-e9bee483b7e8","da88c0a2-fce1-4336-97e7-61bc4149027a","0ee52933-5891-4387-a10c-921468884ab4","f086cce1-bf32-4be2-9fab-8529a2186ba3","e50dd6f9-49d4-4c3a-b723-da54361b34d5","3f554fe3-c9cb-4f63-99b2-f90f395308f6","eaf25f44-f59e-48d1-b475-a28066593688","af6f6570-0d18-4c3d-9145-3ee677a60c35","4c1d6186-e507-4ca2-9c02-d32dfbe2cca5","ff668a4c-0b15-45ec-9716-42f1af578ece","ce720858-10b7-4c0c-8083-906f29150a81","9ee7cbfe-3f95-4fc7-aab6-0d03c30a1e1b","3a554c07-e77f-43fa-ba66-ff39cf1e0ca5","4194acae-3f4b-4c08-98b9-907a0b5bd4b9","ce969492-bca9-4a45-8730-9ae753bdd027","368e5462-3dca-4c8b-ab1f-595cb04c56e0","d26ce18a-fa8d-4df4-8b82-69c419c5b621","3327d648-8e54-4edf-a38e-a9cba8884a1a","d5fd419b-4cb7-44c8-a8d7-0c8ed44c1963","deaccfa2-4562-437c-874e-fc5041f3fad5","f26f0a34-d6f1-419a-b91b-e0ea3639fe4b","a23d61e0-cc90-4068-bfb0-986afaf60ac5","cc463e20-63ea-4132-acea-84fc7307dde8","1eecd7c4-1e60-4aff-adbf-ccc85f820ef2","514ae2e3-a0d5-414c-86e5-ed5f8a9eb9c8","7b0eb02d-8b44-45f3-b593-52c0a62f4595","37c4cfd9-62a3-41bb-9989-f9df38c45d04","8aa3f594-ff5d-4f99-b0a2-fa09bb32ba84","806f9f46-c738-4c87-9957-e73d11ec44bd","64ac0e55-b2ae-4c80-8226-7a1f4b4ed8da","4d7cb2a6-768c-42c7-aad0-8e56168076d5","1e5f4845-8e82-4ab1-aad9-0d4c9eed2fde","37e5fc82-97ee-4a59-9d0b-1f44e2977cc9","1ccc4db8-78ca-45b9-947b-5d216a3e0667","f3550fb0-346c-4212-b57f-86433738b50b","7d2888d0-b55f-4909-97bf-944e56f19c0e","d9436315-195f-458c-93ac-09e5b8780171","51b42828-cae5-456b-9c2f-9b4b2232380e","280fbd32-0621-4ccb-babb-5790a693090e","1ffb90ba-821d-4d16-8520-e46604a470d7","adc7c47b-6dd7-439f-9e06-6075256c91a7","d6ba00e3-fb3f-4f30-9fa7-23c0b0712cdd","2eb83ae6-642d-45a1-a8a4-04463c20dc4b","c248bc92-b7a1-4f5b-a0a9-f1d5186a8dae","9900ca48-1c4f-44e3-9dae-ab5bd1633d6c","f9e566d7-45f7-4335-afe7-506247cd0b8e","a0b1590c-24bd-41dd-a6e0-b3cdac7bb4e6","8c6e229b-cbd3-4dc6-9b49-34f701a8aead","1467d162-f107-4606-b5dc-ec538ede0fdd","09bb7c8f-a916-4a39-bd01-2786a14bacc4","9e017f37-5917-4cda-afb8-92072abdbdba","8aafeb2c-85b4-4c4e-af36-3b9efacb167c","6d0e0705-57f3-4223-8745-a27295245029","dec89a30-7004-499f-a99e-05b2842cad2b","7efc83d4-2645-4578-b588-a9cffb15524a","1769e8de-bebe-4687-a28a-34c15859ed98","203f2c30-a3cd-4f70-95b3-07df9f996428","2a0b435c-6f77-4db8-be6b-831d177bd762","eac01009-c323-46fd-8339-09c282e6597e","c4b37f96-4ab0-4a0b-a16e-55bac3e32990","4ad5c69e-0dab-4d66-b548-360da7d53568","72d89744-ac04-4dd4-be8b-9d629acd7c11","32dc3358-e954-4934-9e71-cf1dfbca5b91","961e45bd-8bed-4ebc-b3d8-1f0e63736d04"],"query2":{"sort":[{"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee","direction":"descending"},{"property":"NX\\Q","direction":"descending"}],"aggregations":[{"property":"title","aggregator":"count"}]},"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"},"role":"reader"},"55d7f55d-3bd1-4a1a-97c9-a6c8354ecd3d":{"value":{"id":"55d7f55d-3bd1-4a1a-97c9-a6c8354ecd3d","version":1,"type":"table","name":"Config","format":{"gallery_cover":{"type":"page_content"},"list_properties":[{"visible":true,"property":"NX\\Q"},{"visible":true,"property":"d]hq"},{"visible":true,"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"visible":true,"property":"sD^m"},{"visible":true,"property":"`gQ~"},{"visible":false,"property":"wz|S"},{"visible":false,"property":"bB{M"},{"visible":false,"property":"Dj]h"},{"visible":false,"property":"@NcA"}],"property_filters":[{"id":"b54a6c88-635d-4de4-946e-5a855a1f4069","filter":{"filter":{"value":[{"type":"exact","value":"Notice"},{"type":"exact","value":"Menu"},{"type":"exact","value":"Config"},{"type":"exact","value":"SubMenu"},{"type":"exact","value":"Page"}],"operator":"enum_is"},"property":"`gQ~"}}],"table_properties":[{"width":116,"visible":true,"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"width":118,"visible":true,"property":"`gQ~"},{"width":219,"visible":true,"property":"title"},{"width":326,"visible":true,"property":"d]hq"},{"width":352,"visible":true,"property":"wz|S"},{"width":111,"visible":true,"property":"NX\\Q"},{"width":116,"visible":true,"property":"bB{M"},{"width":142,"visible":true,"property":"sD^m"},{"width":100,"visible":true,"property":"@NcA"},{"width":117,"visible":true,"property":"Dj]h"}],"collection_pointer":{"id":"0bb2e606-8d0c-4f7c-aca9-70986e90c055","table":"collection","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"},"gallery_properties":[{"visible":true,"property":"title"},{"visible":true,"property":"d]hq"},{"visible":true,"property":"`gQ~"},{"visible":true,"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"visible":false,"property":"bB{M"},{"visible":false,"property":"NX\\Q"},{"visible":false,"property":"Dj]h"},{"visible":false,"property":"@NcA"},{"visible":false,"property":"wz|S"},{"visible":false,"property":"sD^m"}],"table_frozen_column_index":-1,"table_subitem_toggle_column":"title"},"parent_id":"0dc306ca-50a6-4917-9b5a-85a61f0f66f5","parent_table":"block","alive":true,"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"},"role":"reader"},"8dfd415c-71af-41f9-b984-e7182bf2210b":{"value":{"id":"8dfd415c-71af-41f9-b984-e7182bf2210b","version":1,"type":"board","name":"Post Board","format":{"board_columns":[{"value":{"type":"select","value":"Draft"},"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"value":{"type":"select","value":"Invisible"},"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"value":{"type":"select","value":"Published"},"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"value":{"type":"select"},"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"}],"board_columns_by":{"sort":{"type":"manual"},"type":"select","property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},"board_properties":[{"visible":true,"property":"title"},{"visible":true,"property":"bB{M"},{"visible":true,"property":"sD^m"},{"visible":true,"property":"wz|S"},{"visible":false,"property":"NX\\Q"},{"visible":false,"property":"Dj]h"},{"visible":false,"property":"@NcA"},{"visible":false,"property":"d]hq"},{"visible":false,"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"visible":false,"property":"`gQ~"}],"table_properties":[{"width":100,"visible":true,"property":"`gQ~"},{"width":116,"visible":true,"property":"bB{M"},{"width":142,"visible":true,"property":"sD^m"},{"width":219,"visible":true,"property":"title"},{"width":100,"visible":true,"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"width":155,"visible":true,"property":"d]hq"},{"width":352,"visible":true,"property":"wz|S"},{"width":111,"visible":true,"property":"NX\\Q"},{"width":100,"visible":true,"property":"@NcA"},{"width":117,"visible":true,"property":"Dj]h"}],"collection_pointer":{"id":"0bb2e606-8d0c-4f7c-aca9-70986e90c055","table":"collection","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"},"table_subitem_toggle_column":"title"},"parent_id":"0dc306ca-50a6-4917-9b5a-85a61f0f66f5","parent_table":"block","alive":true,"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"},"role":"reader"},"3c2f93d8-6810-42a1-87da-55f1ecda9bca":{"value":{"id":"3c2f93d8-6810-42a1-87da-55f1ecda9bca","version":74,"type":"chart","name":"Tag","format":{"chart_config":{"type":"column","dataConfig":{"type":"groups_reducer","groupBy":{"sort":{"type":"manual"},"type":"multi_select","property":"sD^m","hideEmptyGroups":false},"aggregationConfig":{"aggregation":{"aggregator":"count"},"seriesFormat":{"displayType":"column"}}},"chartFormat":{"mainSort":"manual","hideLegend":false,"axisCumulative":false,"axisGroupStyle":"normal","donutHideValue":false,"donutDataLabels":"value","axisShowDataLabels":true,"axisHideEmptyGroups":false}},"property_filters":[{"id":"01739a9c-9312-4d0d-bf7d-de1204300bdb","filter":{"filter":{"value":{"type":"exact","value":"Post"},"operator":"enum_is"},"property":"`gQ~"}},{"id":"3e615570-2c44-41d9-ae7c-603eabc9056e","filter":{"filter":{"value":{"type":"exact","value":"Published"},"operator":"enum_is"},"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"}}],"table_properties":[{"width":100,"visible":true,"property":"`gQ~"},{"width":247,"visible":true,"property":"title"},{"width":233,"visible":true,"property":"wz|S"},{"width":100,"visible":true,"property":"f211bdc0-ee00-4186-9a7d-f68c055ec2ee"},{"width":219,"visible":true,"property":"sD^m"},{"width":184,"visible":true,"property":"d]hq"},{"width":111,"visible":true,"property":"NX\\Q"},{"width":100,"visible":false,"property":"bB{M"},{"width":117,"visible":false,"property":"Dj]h"},{"width":100,"visible":false,"property":"@NcA"}],"collection_pointer":{"id":"0bb2e606-8d0c-4f7c-aca9-70986e90c055","table":"collection","spaceId":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"},"subitem_display_mode":"flattened","table_subitem_toggle_column":"title"},"parent_id":"0dc306ca-50a6-4917-9b5a-85a61f0f66f5","parent_table":"block","alive":true,"space_id":"4cc04375-345a-4a1e-bdf0-3a7c88ef0425"},"role":"reader"}},"notion_user":{},"collection_query":{},"signed_urls":{}}},"prev":{"id":"a06c26b2-5941-43ea-a89e-d0bebab47add","date":{"start_date":"2024-08-25","date_format":"relative"},"type":"Post","slug":"post/migrate-blog-to-notion","tags":["折腾"],"summary":"Make Notion Great Again！","title":"迁移博客到 Notion","status":"Published","category":"","comment":"","publishDate":1724544000000,"publishDay":"2024-8-25","lastEditedDate":"2024-11-17T13:06:23.285Z","lastEditedDay":"2024-11-17","fullWidth":false,"pageIcon":"","pageCover":"","pageCoverThumbnail":"","ext":{},"tagItems":[{"name":"折腾","color":"blue"}],"href":"/post/migrate-blog-to-notion","target":"_self","password":""},"next":{"id":"0e96a78e-dec9-4620-b0e8-a2b889017cb7","date":{"start_date":"2024-01-04","date_format":"relative"},"type":"Post","slug":"post/kernel-rwlock","tags":["Linux","操作系统"],"summary":"前段时间看了《Linux内核设计与实现》，第 10 章「内核同步方法」中提到了几种内核中的读写锁。它们分别代表了几种比较典型的读写锁设计，非常值得学习，这里记录一下，讨论是基于 2.6 内核和 x86 体系结构的基础上进行的","title":"从 Linux 内核看读写锁设计","status":"Published","category":"","comment":"","publishDate":1704326400000,"publishDay":"2024-1-4","lastEditedDate":"2024-11-22T13:43:47.075Z","lastEditedDay":"2024-11-22","fullWidth":false,"pageIcon":"","pageCover":"","pageCoverThumbnail":"","ext":{},"tagItems":[{"name":"Linux","color":"purple"},{"name":"操作系统","color":"blue"}],"href":"/post/kernel-rwlock","target":"_self","password":""},"recommendPosts":[{"id":"14688756-3979-80f8-8f88-d0bb8697b4a4","date":{"start_date":"2024-12-21","date_format":"relative"},"type":"Post","slug":"post/deterministic-simulator","tags":["分布式系统"],"summary":"最初接触到确定性模拟的概念是在 2022 年 Rust China Conf 上听的一场演讲，后续一直持续关注着这个领域，也在腾讯组内分享过相关议题","title":"确定性模拟器","status":"Published","category":"","comment":"","publishDate":1734739200000,"publishDay":"2024-12-21","lastEditedDate":"2024-12-21T17:14:04.799Z","lastEditedDay":"2024-12-21","fullWidth":false,"pageIcon":"","pageCover":"","pageCoverThumbnail":"","ext":{},"tagItems":[{"name":"分布式系统","color":"gray"}],"href":"/post/deterministic-simulator","target":"_self","password":""},{"id":"12988756-3979-8065-aeb4-e6ec1258ed90","date":{"start_date":"2024-11-17","date_format":"relative"},"type":"Post","slug":"post/memorydb","tags":["分布式系统","数据库","论文阅读"],"summary":"MemoryDB 是 Amazon 的一个 Redis 兼容的 KV 数据库，论文发表在 SIGMOD 2024 上","title":"MemoryDB: Redis + Remote Log","status":"Published","category":"","comment":"","publishDate":1731801600000,"publishDay":"2024-11-17","lastEditedDate":"2024-11-18T03:17:24.167Z","lastEditedDay":"2024-11-18","fullWidth":false,"pageIcon":"","pageCover":"","pageCoverThumbnail":"","ext":{},"tagItems":[{"name":"分布式系统","color":"gray"},{"name":"数据库","color":"yellow"},{"name":"论文阅读","color":"orange"}],"href":"/post/memorydb","target":"_self","password":""},{"id":"1eecd7c4-1e60-4aff-adbf-ccc85f820ef2","date":{"start_date":"2022-02-14","date_format":"relative"},"type":"Post","slug":"post/gfs-paper","tags":["论文阅读","分布式系统"],"title":"The Google File System 论文概览","status":"Published","category":"","comment":"","publishDate":1644796800000,"publishDay":"2022-2-14","lastEditedDate":"2025-04-15T02:57:01.735Z","lastEditedDay":"2025-4-15","fullWidth":false,"pageIcon":"","pageCover":"","pageCoverThumbnail":"","ext":{},"tagItems":[{"name":"论文阅读","color":"orange"},{"name":"分布式系统","color":"gray"}],"href":"/post/gfs-paper","target":"_self","password":""},{"id":"514ae2e3-a0d5-414c-86e5-ed5f8a9eb9c8","date":{"start_date":"2022-02-12","date_format":"relative"},"type":"Post","slug":"post/mit6824-lab1-mapreduce","tags":["分布式系统"],"title":"MIT6.824 Lab1 MapReduce","status":"Published","category":"","comment":"","publishDate":1644624000000,"publishDay":"2022-2-12","lastEditedDate":"2024-08-27T15:25:13.837Z","lastEditedDay":"2024-8-27","fullWidth":false,"pageIcon":"","pageCover":"","pageCoverThumbnail":"","ext":{},"tagItems":[{"name":"分布式系统","color":"gray"}],"href":"/post/mit6824-lab1-mapreduce","target":"_self","password":""}]},"__N_SSG":true},"page":"/[prefix]/[slug]","query":{"prefix":"post","slug":"longhorn"},"buildId":"bzll3595dvYzC4mzTRuY5","runtimeConfig":{"NODE_ENV_API":"prod","THEMES":["autumn","commerce","example","fukasawa","game","gitbook","heo","hexo","landing","matery","medium","movie","nav","next","nobelium","plog","simple","starter"]},"isFallback":false,"dynamicIds":[10635,31794,46767],"gsp":true,"scriptLoader":[]}</script></body></html>